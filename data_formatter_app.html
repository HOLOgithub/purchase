<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ã‚¹ãƒãƒ¼ãƒˆèª¿é”åˆ†æã‚·ã‚¹ãƒ†ãƒ ï¼ˆSPASï¼‰</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
        }
        .fade-in {
            animation: fadeIn 0.3s ease-in;
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        /* ãƒ‰ãƒ©ãƒƒã‚°ï¼†ãƒ‰ãƒ­ãƒƒãƒ—ç”¨ã‚¹ã‚¿ã‚¤ãƒ« */
        .drag-over {
            border: 2px dashed #3b82f6 !important;
            background-color: #eff6ff !important;
        }
        .drop-hint {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background-color: rgba(59, 130, 246, 0.9);
            color: white;
            padding: 8px 16px;
            border-radius: 6px;
            font-size: 14px;
            pointer-events: none;
            z-index: 10;
        }
        .textarea-wrapper {
            position: relative;
        }
    </style>
</head>
<body class="bg-gray-50">
    <div class="flex flex-col min-h-screen p-4">
        <header class="mb-6">
            <div class="flex justify-between items-start">
                <div>
                    <h1 class="text-2xl font-bold text-blue-700">ã‚¹ãƒãƒ¼ãƒˆèª¿é”åˆ†æã‚·ã‚¹ãƒ†ãƒ ï¼ˆSPASï¼‰</h1>
                    <p class="text-gray-600 mt-1">Smart Procurement Analysis System - èª¿é”ãƒ‡ãƒ¼ã‚¿ã®é«˜åº¦åˆ†æãƒ»æ¤œè¨¼ãƒ—ãƒ©ãƒƒãƒˆãƒ•ã‚©ãƒ¼ãƒ </p>
                </div>
                <div class="text-right">
                    <div class="inline-flex items-center bg-green-100 text-green-700 px-3 py-1 rounded-full text-sm font-medium">
                        <span class="mr-1">âœ¨</span>
                        <span id="appVersion">v2.6.3</span>
                    </div>
                    <button id="versionInfoBtn" class="mt-1 text-xs text-green-600 hover:text-green-800 underline">
                        æ›´æ–°å±¥æ­´ã‚’è¡¨ç¤º
                    </button>
                </div>
            </div>
        </header>
        
        <!-- å…¥åŠ›ã‚»ã‚¯ã‚·ãƒ§ãƒ³ -->
        <section class="mb-4">
            <div class="bg-white p-6 rounded-lg shadow border">
                <h2 class="text-lg font-semibold mb-4 text-gray-800">ãƒ‡ãƒ¼ã‚¿å…¥åŠ›</h2>
                
                <div class="space-y-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">
                            ç”Ÿãƒ‡ãƒ¼ã‚¿ <span class="text-xs text-gray-500 ml-2">ï¼ˆExcelãƒ•ã‚¡ã‚¤ãƒ«ã‚’ãƒ‰ãƒ©ãƒƒã‚°ï¼†ãƒ‰ãƒ­ãƒƒãƒ—å¯èƒ½ï¼‰</span>
                        </label>
                        <div class="textarea-wrapper" id="inputDataWrapper">
                            <textarea
                                id="inputData"
                                class="w-full h-32 p-3 border rounded-md shadow-sm focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-colors"
                                placeholder="è¤‡æ•°æ¡ˆä»¶ã®ç”Ÿãƒ‡ãƒ¼ã‚¿ã‚’è²¼ã‚Šä»˜ã‘ï¼ˆæ¡ˆä»¶ã”ã¨ã«æ”¹è¡ŒåŒºåˆ‡ã‚Šï¼‰&#10;ã¾ãŸã¯ Excelãƒ•ã‚¡ã‚¤ãƒ«(.xlsx/.xls)ã‚’ãƒ‰ãƒ©ãƒƒã‚°ï¼†ãƒ‰ãƒ­ãƒƒãƒ—"
                            ></textarea>
                            <div class="drop-hint" id="dropHint" style="display: none;">Excelãƒ•ã‚¡ã‚¤ãƒ«ã‚’ãƒ‰ãƒ­ãƒƒãƒ—</div>
                        </div>
                    </div>

                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">
                            ç”³è«‹å˜ä¾¡ãƒ»æ³¨æ–‡æ•°ãƒ‡ãƒ¼ã‚¿
                        </label>
                        <textarea
                            id="applicationData"
                            class="w-full h-24 p-3 border rounded-md shadow-sm focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-colors"
                            placeholder="ç”³è«‹å˜ä¾¡ã¨æ³¨æ–‡æ•°ã‚’è²¼ã‚Šä»˜ã‘ï¼ˆä¾‹ï¼š0.75sqx2Cï¼š@14600å††/13å€‹ï¼‰"
                        ></textarea>
                    </div>
                    
                    <div class="flex gap-3">
                        <button
                            id="processDataBtn"
                            class="px-6 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500 transition-colors disabled:opacity-50 disabled:cursor-not-allowed"
                        >
                            ãƒ‡ãƒ¼ã‚¿å‡¦ç†
                        </button>
                        <button
                            id="clearBtn"
                            class="px-6 py-2 bg-gray-500 text-white rounded-md hover:bg-gray-600 focus:outline-none focus:ring-2 focus:ring-gray-500 transition-colors"
                        >
                            ã‚¯ãƒªã‚¢
                        </button>
                    </div>
                </div>
            </div>
        </section>

        <!-- æ¡ˆä»¶ä¸€è¦§ã‚»ã‚¯ã‚·ãƒ§ãƒ³ -->
        <section id="projectsSection" class="bg-white rounded-lg shadow border fade-in" style="display: none;">
            <div class="p-6">
                <div class="mb-6">
                    <h2 class="text-xl font-semibold text-gray-800">
                        æ¡ˆä»¶ä¸€è¦§ï¼ˆ<span id="projectCount" class="text-blue-600">0</span>ä»¶ï¼‰
                    </h2>
                </div>
                
                <!-- æ¡ˆä»¶ãƒªã‚¹ãƒˆ -->
                <div id="projectsList" class="space-y-6">
                    <!-- æ¡ˆä»¶ãŒå‹•çš„ã«ç”Ÿæˆã•ã‚Œã‚‹ -->
                </div>
                
                <!-- ä¸€æ‹¬æ¤œè¨¼ãƒœã‚¿ãƒ³ -->
                <div class="mt-8 flex justify-center">
                    <button
                        id="validateAllBtn"
                        class="px-8 py-3 bg-green-600 text-white rounded-lg hover:bg-green-700 focus:outline-none focus:ring-2 focus:ring-green-500 transition-colors font-medium text-lg shadow-md"
                    >
                        ğŸ” ä¸€æ‹¬æ¤œè¨¼å®Ÿè¡Œ
                    </button>
                </div>
                
                <!-- å…¨ä½“çµæœè¡¨ç¤º -->
                <div id="overallResults" class="mt-8 fade-in" style="display: none;">
                    <h3 class="text-lg font-semibold mb-4 text-gray-800 border-b pb-2">æ¤œè¨¼çµæœä¸€è¦§</h3>
                    <div id="overallResultsContent"></div>
                    
                    <!-- ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆæ¸ˆã¿ãƒ†ã‚­ã‚¹ãƒˆ -->
                    <div id="formattedTextSection" class="mt-8 fade-in" style="display: none;">
                        <h3 class="text-lg font-semibold mb-3 text-gray-800 border-b pb-2">ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆæ¸ˆã¿ãƒ†ã‚­ã‚¹ãƒˆ</h3>
                        <div id="formattedText" class="bg-gray-100 p-4 rounded-lg whitespace-pre-line text-sm font-mono border"></div>
                        <button
                            id="copyBtn"
                            class="mt-3 px-6 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500 transition-colors"
                        >
                            ğŸ“‹ ã‚¯ãƒªãƒƒãƒ—ãƒœãƒ¼ãƒ‰ã«ã‚³ãƒ”ãƒ¼
                        </button>
                    </div>
                </div>
            </div>
        </section>
        
        <!-- ãƒãƒ¼ã‚¸ãƒ§ãƒ³æƒ…å ±ãƒ¢ãƒ¼ãƒ€ãƒ« -->
        <div id="versionModal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50" style="display: none;">
            <div class="bg-white rounded-lg p-6 max-w-2xl w-full mx-4 max-h-[80vh] overflow-y-auto">
                <div class="flex justify-between items-center mb-4">
                    <h3 class="text-xl font-bold text-gray-800">ãƒãƒ¼ã‚¸ãƒ§ãƒ³æƒ…å ±ãƒ»æ›´æ–°å±¥æ­´</h3>
                    <button id="closeVersionModal" class="text-gray-500 hover:text-gray-700 text-xl">Ã—</button>
                </div>
                
                <div class="space-y-4">
                    <!-- Current Version -->
                    <div class="bg-green-50 border border-green-200 rounded-lg p-4">
                        <div class="flex items-center mb-2">
                            <span class="bg-green-600 text-white px-2 py-1 rounded text-sm font-medium mr-2">LATEST</span>
                            <span class="font-bold text-green-700">v2.4.4</span>
                            <span class="text-gray-600 ml-2">- 2024å¹´12æœˆï¼ˆåŠ å·¥è²»æ¯”è¼ƒæ©Ÿèƒ½è¿½åŠ ç‰ˆï¼‰</span>
                        </div>
                        <h4 class="font-semibold text-gray-800 mb-2">ğŸ”§ åŠ å·¥è²»æ¯”è¼ƒæ©Ÿèƒ½å®Ÿè£…</h4>
                        <ul class="text-sm text-gray-700 space-y-1">
                            <li>â€¢ <strong>åŠ å·¥è²»æ¯”è¼ƒãƒã‚§ãƒƒã‚¯ãƒœãƒƒã‚¯ã‚¹:</strong> ãƒã‚§ãƒƒã‚¯ã‚’ä»˜ã‘ã‚‹ã“ã¨ã§åŠ å·¥è²»ã®æ¯”è¼ƒãŒã§ãã‚‹æ©Ÿèƒ½</li>
                            <li>â€¢ <strong>å‰å›åŠ å·¥è²»ã¨ã®æ¯”è¼ƒ:</strong> åŸºæœ¬æƒ…å ±ã®å‰å›æ³¨æ–‡åŠ å·¥è²»ã¨ä»Šå›ã®åŠ å·¥è²»ã‚’è‡ªå‹•æ¯”è¼ƒ</li>
                            <li>â€¢ <strong>åŠ å·¥è²»ä¸Šæ˜‡æ™‚ã®ç†ç”±è¨˜è¼‰:</strong> åŠ å·¥è²»ãŒä¸Šæ˜‡ã—ãŸå ´åˆã®ç‰¹åˆ¥äº‹æƒ…å…¥åŠ›æ©Ÿèƒ½</li>
                            <li>â€¢ <strong>ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ æ¤œè¨¼å¯¾å¿œ:</strong> åŠ å·¥è²»ãƒã‚§ãƒƒã‚¯çµæœã®ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ è¡¨ç¤º</li>
                        </ul>
                        
                        <div class="mt-3 p-2 bg-green-100 border border-green-300 rounded text-sm">
                            <div class="flex items-center">
                                <span class="text-green-600 mr-2">ğŸ”§</span>
                                <strong class="text-green-800">åŠ å·¥è²»ç®¡ç†å¼·åŒ–</strong>
                                <span class="text-green-700 ml-2">= ã‚³ã‚¹ãƒˆç®¡ç†ã®ç²¾åº¦å‘ä¸Š</span>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Version History -->
                    <div class="space-y-3">
                        <div class="border border-gray-200 rounded-lg p-4">
                            <div class="flex items-center mb-2">
                                <span class="font-bold text-gray-700">v2.3.3</span>
                                <span class="text-gray-600 ml-2">- 2024å¹´12æœˆï¼ˆå›³ç•ªãƒã‚§ãƒƒã‚¯æ©Ÿèƒ½è¿½åŠ ç‰ˆï¼‰</span>
                            </div>
                            <h4 class="font-semibold text-gray-800 mb-2">ğŸ“ å›³ç•ªãƒã‚§ãƒƒã‚¯æ©Ÿèƒ½å®Ÿè£…</h4>
                            <ul class="text-sm text-gray-700 space-y-1">
                                <li>â€¢ å›³ç•ªãƒã‚§ãƒƒã‚¯æ©Ÿèƒ½è¿½åŠ </li>
                                <li>â€¢ å›³ç•ªãªã—ã‚ªãƒ—ã‚·ãƒ§ãƒ³å¯¾å¿œ</li>
                                <li>â€¢ å›³ç•ªä¸ä¸€è‡´å¯¾å¿œ</li>
                                <li>â€¢ ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆå‡ºåŠ›æ”¹å–„</li>
                            </ul>
                        </div>
                        
                        <div class="border border-gray-200 rounded-lg p-4">
                            <div class="flex items-center mb-2">
                                <span class="font-bold text-gray-700">v2.3.0</span>
                                <span class="text-gray-600 ml-2">- 2024å¹´12æœˆ</span>
                            </div>
                            <h4 class="font-semibold text-gray-800 mb-2">âœï¸ åŸºæœ¬æƒ…å ±ç·¨é›†æ©Ÿèƒ½å®Ÿè£…</h4>
                            <ul class="text-sm text-gray-700 space-y-1">
                                <li>â€¢ åŸºæœ¬æƒ…å ±ã®ç›´æ¥ç·¨é›†æ©Ÿèƒ½</li>
                                <li>â€¢ ã‚¤ãƒ³ãƒ©ã‚¤ãƒ³ç·¨é›†UI</li>
                                <li>â€¢ ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ æ¤œè¨¼é€£æº</li>
                                <li>â€¢ ãƒ‡ãƒ¼ã‚¿å“è³ªå‘ä¸Š</li>
                            </ul>
                        </div>
                        
                        <div class="border border-gray-200 rounded-lg p-4">
                            <div class="flex items-center mb-2">
                                <span class="font-bold text-gray-700">v2.2.0</span>
                                <span class="text-gray-600 ml-2">- 2024å¹´12æœˆ</span>
                            </div>
                            <h4 class="font-semibold text-gray-800 mb-2">âš¡ ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ æ¤œè¨¼æ©Ÿèƒ½å®Ÿè£…</h4>
                            <ul class="text-sm text-gray-700 space-y-1">
                                <li>â€¢ ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ æ¤œè¨¼ã‚¨ãƒ³ã‚¸ãƒ³</li>
                                <li>â€¢ ãƒ‡ãƒã‚¦ãƒ³ã‚¹æ©Ÿèƒ½ã«ã‚ˆã‚‹è² è·è»½æ¸›</li>
                                <li>â€¢ ãƒ“ã‚¸ãƒ¥ã‚¢ãƒ«ãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯</li>
                                <li>â€¢ ã‚¤ãƒ³ãƒ†ãƒªã‚¸ã‚§ãƒ³ãƒˆãƒ’ãƒ³ãƒˆè¡¨ç¤º</li>
                            </ul>
                        </div>
                        
                        <div class="border border-gray-200 rounded-lg p-4">
                            <div class="flex items-center mb-2">
                                <span class="font-bold text-gray-700">v2.1.1</span>
                                <span class="text-gray-600 ml-2">- 2024å¹´12æœˆ</span>
                            </div>
                            <h4 class="font-semibold text-gray-800 mb-2">ğŸ“‹ åŸºæœ¬æƒ…å ±è¡¨ç¤ºã®ä»•æ§˜å¤‰æ›´</h4>
                            <ul class="text-sm text-gray-700 space-y-1">
                                <li>â€¢ é¡Œç›®è¡¨ç¤ºãƒ«ãƒ¼ãƒ«å¤‰æ›´</li>
                                <li>â€¢ åŸºæœ¬æƒ…å ±ã®é †ç•ªå¤‰æ›´</li>
                                <li>â€¢ åœ¨åº«æ•°ã€å‰å›æ³¨æ–‡åŠ å·¥è²»è¿½åŠ </li>
                                <li>â€¢ ãƒ‡ãƒ¼ã‚¿å“è³ªè©•ä¾¡åŸºæº–èª¿æ•´</li>
                            </ul>
                        </div>
                        
                        <div class="border border-gray-200 rounded-lg p-4">
                            <div class="flex items-center mb-2">
                                <span class="font-bold text-gray-700">v2.1.0</span>
                                <span class="text-gray-600 ml-2">- 2024å¹´12æœˆ</span>
                            </div>
                            <h4 class="font-semibold text-gray-800 mb-2">ğŸ¯ ãƒ‡ãƒ¼ã‚¿è¡¨ç¤ºãƒ»è§£ææ©Ÿèƒ½å¼·åŒ–</h4>
                            <ul class="text-sm text-gray-700 space-y-1">
                                <li>â€¢ ãƒ‡ãƒ¼ã‚¿è§£æã‚¨ãƒ³ã‚¸ãƒ³ã®å®Œå…¨åˆ·æ–°</li>
                                <li>â€¢ ã€Œä¸æ˜ã€è¡¨ç¤ºã®æ’²æ»…</li>
                                <li>â€¢ ãƒ‡ãƒ¼ã‚¿å“è³ªã‚¤ãƒ³ã‚¸ã‚±ãƒ¼ã‚¿ãƒ¼è¿½åŠ </li>
                                <li>â€¢ ç”³è«‹ãƒ‡ãƒ¼ã‚¿ãƒãƒƒãƒãƒ³ã‚°å¼·åŒ–</li>
                            </ul>
                        </div>
                        
                        <div class="border border-gray-200 rounded-lg p-4">
                            <div class="flex items-center mb-2">
                                <span class="font-bold text-gray-700">v2.0.0</span>
                                <span class="text-gray-600 ml-2">- 2024å¹´12æœˆ</span>
                            </div>
                            <h4 class="font-semibold text-gray-800 mb-2">ğŸš€ Major Update - å®Œå…¨ãƒªãƒ•ã‚¡ã‚¯ã‚¿ãƒªãƒ³ã‚°</h4>
                            <ul class="text-sm text-gray-700 space-y-1">
                                <li>â€¢ ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£æ”¹å–„ã¨ã‚¯ãƒ©ã‚¹åŒ–</li>
                                <li>â€¢ ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°å¼·åŒ–</li>
                                <li>â€¢ ç¨è¾¼/ç¨æŠœè¨ˆç®—æ©Ÿèƒ½è¿½åŠ </li>
                                <li>â€¢ UI/UXå¤§å¹…æ”¹å–„</li>
                            </ul>
                        </div>
                        
                        <div class="border border-gray-200 rounded-lg p-4">
                            <div class="flex items-center mb-2">
                                <span class="font-bold text-gray-700">v1.2.1</span>
                                <span class="text-gray-600 ml-2">- 2024å¹´11æœˆ</span>
                            </div>
                            <h4 class="font-semibold text-gray-800 mb-2">ğŸ”§ Bug Fixes & Improvements</h4>
                            <ul class="text-sm text-gray-700 space-y-1">
                                <li>â€¢ å‹ç•ªæ¤œè¨¼ãƒ­ã‚¸ãƒƒã‚¯ã®ä¿®æ­£</li>
                                <li>â€¢ ä¾¡æ ¼è¨ˆç®—ã®ç²¾åº¦å‘ä¸Š</li>
                                <li>â€¢ UIãƒ¬ã‚¹ãƒãƒ³ã‚·ãƒ–å¯¾å¿œã®æ”¹å–„</li>
                            </ul>
                        </div>
                        
                        <div class="border border-gray-200 rounded-lg p-4">
                            <div class="flex items-center mb-2">
                                <span class="font-bold text-gray-700">v1.2.0</span>
                                <span class="text-gray-600 ml-2">- 2024å¹´10æœˆ</span>
                            </div>
                            <h4 class="font-semibold text-gray-800 mb-2">âœ¨ Feature Updates</h4>
                            <ul class="text-sm text-gray-700 space-y-1">
                                <li>â€¢ ä¸€æ‹¬æ¤œè¨¼æ©Ÿèƒ½ã®è¿½åŠ </li>
                                <li>â€¢ ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆæ¸ˆã¿ãƒ†ã‚­ã‚¹ãƒˆå‡ºåŠ›æ©Ÿèƒ½</li>
                                <li>â€¢ ã‚¯ãƒªãƒƒãƒ—ãƒœãƒ¼ãƒ‰ã‚³ãƒ”ãƒ¼æ©Ÿèƒ½</li>
                            </ul>
                        </div>
                        
                        <div class="border border-gray-200 rounded-lg p-4">
                            <div class="flex items-center mb-2">
                                <span class="font-bold text-gray-700">v1.1.0</span>
                                <span class="text-gray-600 ml-2">- 2024å¹´9æœˆ</span>
                            </div>
                            <h4 class="font-semibold text-gray-800 mb-2">ğŸ¯ Core Features</h4>
                            <ul class="text-sm text-gray-700 space-y-1">
                                <li>â€¢ è¤‡æ•°æ¡ˆä»¶å¯¾å¿œã®å®Ÿè£…</li>
                                <li>â€¢ ç”³è«‹ãƒ‡ãƒ¼ã‚¿è‡ªå‹•ãƒãƒƒãƒãƒ³ã‚°</li>
                                <li>â€¢ ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ è¨ˆç®—æ©Ÿèƒ½</li>
                            </ul>
                        </div>
                        
                        <div class="border border-gray-200 rounded-lg p-4">
                            <div class="flex items-center mb-2">
                                <span class="font-bold text-gray-700">v1.0.0</span>
                                <span class="text-gray-600 ml-2">- 2024å¹´8æœˆ</span>
                            </div>
                            <h4 class="font-semibold text-gray-800 mb-2">ğŸ‰ Initial Release</h4>
                            <ul class="text-sm text-gray-700 space-y-1">
                                <li>â€¢ åŸºæœ¬çš„ãªãƒ‡ãƒ¼ã‚¿æ•´å½¢æ©Ÿèƒ½</li>
                                <li>â€¢ å˜ä¸€æ¡ˆä»¶å¯¾å¿œ</li>
                                <li>â€¢ åŸºæœ¬çš„ãªæ¤œè¨¼æ©Ÿèƒ½</li>
                            </ul>
                        </div>
                    </div>
                    
                    <!-- Technical Info -->
                    <div class="bg-gray-50 border border-gray-200 rounded-lg p-4">
                        <h4 class="font-semibold text-gray-800 mb-2">ğŸ”§ æŠ€è¡“æƒ…å ±</h4>
                        <div class="grid grid-cols-2 gap-4 text-sm">
                            <div>
                                <strong>ãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯:</strong> Vanilla JavaScript
                            </div>
                            <div>
                                <strong>ã‚¹ã‚¿ã‚¤ãƒªãƒ³ã‚°:</strong> Tailwind CSS
                            </div>
                            <div>
                                <strong>ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£:</strong> Class-based Modular
                            </div>
                            <div>
                                <strong>ãƒ–ãƒ©ã‚¦ã‚¶å¯¾å¿œ:</strong> Modern Browsers
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- ã‚¨ãƒ©ãƒ¼è¡¨ç¤º -->
        <div id="errorMessage" class="fixed top-4 right-4 bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded shadow-lg" style="display: none;">
            <div class="flex justify-between items-center">
                <span id="errorText"></span>
                <button onclick="this.parentElement.parentElement.style.display='none'" class="ml-2 text-red-500 hover:text-red-700">Ã—</button>
            </div>
        </div>
        
        <!-- æˆåŠŸãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ -->
        <div id="successMessage" class="fixed top-4 right-4 bg-green-100 border border-green-400 text-green-700 px-4 py-3 rounded shadow-lg" style="display: none;">
            <div class="flex justify-between items-center">
                <span id="successText"></span>
                <button onclick="this.parentElement.parentElement.style.display='none'" class="ml-2 text-green-500 hover:text-green-700">Ã—</button>
            </div>
        </div>
    </div>

    <script>
        // ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ãƒ¡ã‚¤ãƒ³ã‚¯ãƒ©ã‚¹
        class DataFormatterApp {
            constructor() {
                this.version = '2.6.3';
                this.projects = [];
                this.applicationDataMap = new Map();
                this.elements = this.initializeElements();
                this.dataParser = new DataParser();
                this.validator = new ProjectValidator();
                this.uiGenerator = new UIGenerator();
                this.notificationManager = new NotificationManager();
                this.versionManager = new VersionManager(this.version);
                
                this.bindEvents();
                this.initialize();
            }
            
            initializeElements() {
                const elementIds = [
                    'inputData', 'applicationData', 'processDataBtn', 'clearBtn',
                    'projectsSection', 'projectCount', 'validateAllBtn', 'projectsList',
                    'overallResults', 'overallResultsContent', 'formattedTextSection',
                    'formattedText', 'copyBtn', 'versionInfoBtn', 'versionModal', 'closeVersionModal'
                ];
                
                return elementIds.reduce((acc, id) => {
                    const element = document.getElementById(id);
                    if (!element) {
                        console.warn(`Element with id '${id}' not found`);
                    }
                    acc[id] = element;
                    return acc;
                }, {});
            }
            
            bindEvents() {
                this.elements.processDataBtn?.addEventListener('click', () => this.handleProcessData());
                this.elements.clearBtn?.addEventListener('click', () => this.clearAll());
                this.elements.validateAllBtn?.addEventListener('click', () => this.handleValidateAll());
                this.elements.copyBtn?.addEventListener('click', () => this.copyToClipboard());
                this.elements.versionInfoBtn?.addEventListener('click', () => this.versionManager.showVersionModal());
                this.elements.closeVersionModal?.addEventListener('click', () => this.versionManager.hideVersionModal());
                
                // ãƒ¢ãƒ¼ãƒ€ãƒ«èƒŒæ™¯ã‚¯ãƒªãƒƒã‚¯ã§é–‰ã˜ã‚‹
                this.elements.versionModal?.addEventListener('click', (e) => {
                    if (e.target === this.elements.versionModal) {
                        this.versionManager.hideVersionModal();
                    }
                });
            }
            
            initialize() {
                this.elements.inputData?.focus();
                this.versionManager.displayVersion();
                this.versionManager.logVersionInfo();
            }
            
            async handleProcessData() {
                try {
                    this.toggleProcessingState(true);
                    
                    const rawData = this.elements.inputData?.value?.trim();
                    const applicationDataText = this.elements.applicationData?.value?.trim();
                    
                    if (!rawData) {
                        throw new Error('ç”Ÿãƒ‡ãƒ¼ã‚¿ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„');
                    }
                    
                    console.group('ğŸ“Š ãƒ‡ãƒ¼ã‚¿å‡¦ç†é–‹å§‹');
                    
                    // ãƒ‡ãƒ¼ã‚¿è§£æ
                    this.projects = this.dataParser.parseRawData(rawData);
                    this.applicationDataMap = this.dataParser.parseApplicationData(applicationDataText);
                    
                    if (this.projects.length === 0) {
                        throw new Error('è§£æã§ãã‚‹æ¡ˆä»¶ãƒ‡ãƒ¼ã‚¿ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ã§ã—ãŸã€‚ãƒ‡ãƒ¼ã‚¿å½¢å¼ã‚’ç¢ºèªã—ã¦ãã ã•ã„ã€‚');
                    }
                    
                    // ãƒ‡ãƒ¼ã‚¿å“è³ªãƒ¬ãƒãƒ¼ãƒˆ
                    const qualityReport = this.generateDataQualityReport();
                    console.log('ğŸ“ˆ ãƒ‡ãƒ¼ã‚¿å“è³ªãƒ¬ãƒãƒ¼ãƒˆ:', qualityReport);
                    
                    // UIæ›´æ–°
                    this.updateProjectsUI();
                    
                    // è©³ç´°ãªæˆåŠŸãƒ¡ãƒƒã‚»ãƒ¼ã‚¸
                    const matchCount = this.countSuccessfulMatches();
                    this.notificationManager.showSuccess(
                        `âœ… ${this.projects.length}ä»¶ã®æ¡ˆä»¶ã‚’å‡¦ç†ã—ã¾ã—ãŸ | ç”³è«‹ãƒ‡ãƒ¼ã‚¿ãƒãƒƒãƒãƒ³ã‚°: ${matchCount}/${this.projects.length}ä»¶`
                    );
                    
                    console.groupEnd();
                    
                } catch (error) {
                    this.notificationManager.showError(error.message);
                    console.error('âŒ ãƒ‡ãƒ¼ã‚¿å‡¦ç†ã‚¨ãƒ©ãƒ¼:', error);
                    console.groupEnd();
                } finally {
                    this.toggleProcessingState(false);
                }
            }
            
            generateDataQualityReport() {
                let totalFields = 0;
                let filledFields = 0;
                const missingData = [];
                
                this.projects.forEach((project, index) => {
                    const basicInfo = project.basicInfo;
                    const requiredFields = ['ä»•æ§˜', 'å‹ç•ª', 'åœ¨åº«æ•°', 'å¹´é–“ä½¿ç”¨æ•°', 'å‰å›ã®æ³¨æ–‡å˜ä¾¡'];
                    
                    requiredFields.forEach(field => {
                        totalFields++;
                        const value = basicInfo[field];
                        if (value && value !== 'æœªæŒ‡å®š' && value !== '0' && !value.includes('æ¡ˆä»¶') && !value.includes('TYPE-') && !value.includes('ç‰©å“')) {
                            filledFields++;
                        } else {
                            const fieldLabel = field === 'ä»•æ§˜' ? 'ç‰©å“å' : field;
                            missingData.push(`æ¡ˆä»¶${index + 1}: ${fieldLabel}`);
                        }
                    });
                });
                
                return {
                    completeness: Math.round((filledFields / totalFields) * 100),
                    filledFields,
                    totalFields,
                    missingData: missingData.slice(0, 5) // æœ€åˆã®5ä»¶ã®ã¿è¡¨ç¤º
                };
            }
            
            countSuccessfulMatches() {
                return this.projects.filter(project => 
                    this.uiGenerator.findMatchingApplication(project.basicInfo, this.applicationDataMap) !== null
                ).length;
            }
            
            updateProjectsUI() {
                if (this.elements.projectCount) {
                    this.elements.projectCount.textContent = this.projects.length;
                }
                
                if (this.elements.projectsSection) {
                    this.elements.projectsSection.style.display = 'block';
                }
                
                if (this.elements.projectsList) {
                    this.elements.projectsList.innerHTML = this.projects
                        .map((project, index) => this.uiGenerator.generateProjectHTML(project, index, this.applicationDataMap))
                        .join('');
                    
                    this.setupProjectEventListeners();
                }
            }
            
            setupProjectEventListeners() {
                const projectElements = this.elements.projectsList?.querySelectorAll('[data-project-index]');

                projectElements?.forEach(projectElement => {
                    const eventHandler = new ProjectEventHandler(projectElement, this.validator);
                    eventHandler.setup();

                    // ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ æ©Ÿèƒ½ã®ç®¡ç†
                    projectElement.eventHandler = eventHandler;
                });

                // ç›¸è¦‹ç©ã‚‚ã‚Šãƒ‡ãƒ¼ã‚¿ã‚’æ³¨å…¥
                this.injectQuotationData();

                // ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ æ©Ÿèƒ½ã®ã‚°ãƒ­ãƒ¼ãƒãƒ«åˆ¶å¾¡ã‚’è¿½åŠ 
                this.addRealTimeControls();
            }

            // ç›¸è¦‹ç©ã‚‚ã‚Šãƒ‡ãƒ¼ã‚¿ã‚’ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã‚«ãƒ¼ãƒ‰ã«æ³¨å…¥
            injectQuotationData() {
                const excelImporter = window.ExcelImporter;
                if (!excelImporter || !excelImporter.quotationDataList || excelImporter.quotationDataList.length === 0) {
                    return;
                }

                this.projects.forEach((project, index) => {
                    const placeholder = document.querySelector(`.quotation-result-placeholder[data-project-index="${index}"]`);
                    if (!placeholder) return;

                    const quotationData = excelImporter.findQuotationForProject(index, project.basicInfo);
                    if (quotationData) {
                        placeholder.innerHTML = excelImporter.generateQuotationHTML(quotationData, index);
                    }
                });

                // æŠ˜ã‚ŠãŸãŸã¿ãƒœã‚¿ãƒ³ã®ã‚¤ãƒ™ãƒ³ãƒˆãƒãƒ³ãƒ‰ãƒ©ã‚’è¨­å®š
                this.setupQuotationToggleHandlers();
            }

            // ç›¸è¦‹ç©ã‚‚ã‚ŠæŠ˜ã‚ŠãŸãŸã¿ãƒœã‚¿ãƒ³ã®ã‚¤ãƒ™ãƒ³ãƒˆãƒãƒ³ãƒ‰ãƒ©ã‚’è¨­å®š
            setupQuotationToggleHandlers() {
                const toggleBtns = document.querySelectorAll('.quotation-toggle-btn');
                toggleBtns.forEach(btn => {
                    btn.addEventListener('click', (e) => {
                        const projectIndex = btn.dataset.projectIndex;
                        const content = document.querySelector(`.quotation-content[data-project-index="${projectIndex}"]`);
                        const icon = btn.querySelector('.toggle-icon');

                        if (content) {
                            content.classList.toggle('hidden');
                            if (icon) {
                                icon.textContent = content.classList.contains('hidden') ? 'â–¶' : 'â–¼';
                            }
                        }
                    });
                });
            }
            
            addRealTimeControls() {
                // ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ æ©Ÿèƒ½ã®åˆ¶å¾¡ãƒœã‚¿ãƒ³ã‚’è¿½åŠ 
                const controlsContainer = this.elements.projectsList?.parentElement;
                if (!controlsContainer) return;
                
                const existingControls = controlsContainer.querySelector('.realtime-controls');
                if (existingControls) existingControls.remove();
                
                const controlsDiv = document.createElement('div');
                controlsDiv.className = 'realtime-controls mb-4 p-3 bg-blue-50 border border-blue-200 rounded-lg';
                controlsDiv.innerHTML = `
                    <div class="flex items-center justify-between">
                        <div class="flex items-center">
                            <span class="mr-3 text-sm font-medium text-blue-700">âš¡ ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ æ¤œè¨¼</span>
                            <label class="inline-flex items-center">
                                <input type="checkbox" id="realtimeToggle" class="rounded text-blue-600 focus:ring-blue-500" checked />
                                <span class="ml-2 text-sm text-blue-700">æœ‰åŠ¹</span>
                            </label>
                        </div>
                        <div class="flex items-center space-x-2">
                            <button id="clearCacheBtn" class="px-3 py-1 text-xs bg-white border border-blue-300 text-blue-700 rounded hover:bg-blue-50">
                                ğŸ—‘ï¸ ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã‚¯ãƒªã‚¢
                            </button>
                            <button id="validateAllRealTimeBtn" class="px-3 py-1 text-xs bg-blue-600 text-white rounded hover:bg-blue-700">
                                ğŸ”„ å…¨ä»¶å†æ¤œè¨¼
                            </button>
                        </div>
                    </div>
                    <div class="mt-2 text-xs text-blue-600">
                        ğŸ’¡ å…¥åŠ›å€¤ã‚’å¤‰æ›´ã™ã‚‹ã¨è‡ªå‹•çš„ã«æ¤œè¨¼ãŒå®Ÿè¡Œã•ã‚Œã¾ã™ï¼ˆ500msé…å»¶ï¼‰
                    </div>
                `;
                
                controlsContainer.insertBefore(controlsDiv, this.elements.projectsList);
                
                // ã‚¤ãƒ™ãƒ³ãƒˆãƒªã‚¹ãƒŠãƒ¼ã®è¨­å®š
                this.setupRealTimeControlEvents();
            }
            
            setupRealTimeControlEvents() {
                const realtimeToggle = document.getElementById('realtimeToggle');
                const clearCacheBtn = document.getElementById('clearCacheBtn');
                const validateAllRealTimeBtn = document.getElementById('validateAllRealTimeBtn');
                
                realtimeToggle?.addEventListener('change', (e) => {
                    const isEnabled = e.target.checked;
                    this.toggleRealTimeValidation(isEnabled);
                    
                    const statusMessage = isEnabled ? 'ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ æ¤œè¨¼ãŒæœ‰åŠ¹ã«ãªã‚Šã¾ã—ãŸ' : 'ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ æ¤œè¨¼ãŒç„¡åŠ¹ã«ãªã‚Šã¾ã—ãŸ';
                    this.notificationManager.showSuccess(statusMessage);
                });
                
                clearCacheBtn?.addEventListener('click', () => {
                    this.clearAllValidationCaches();
                    this.notificationManager.showSuccess('æ¤œè¨¼ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã‚’ã‚¯ãƒªã‚¢ã—ã¾ã—ãŸ');
                });
                
                validateAllRealTimeBtn?.addEventListener('click', () => {
                    this.forceRealTimeValidationAll();
                    this.notificationManager.showSuccess('å…¨æ¡ˆä»¶ã®ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ æ¤œè¨¼ã‚’å®Ÿè¡Œã—ã¾ã—ãŸ');
                });
            }
            
            toggleRealTimeValidation(enabled) {
                const projectElements = this.elements.projectsList?.querySelectorAll('[data-project-index]');
                projectElements?.forEach(element => {
                    element.eventHandler?.toggleRealTimeValidation(enabled);
                });
            }
            
            clearAllValidationCaches() {
                const projectElements = this.elements.projectsList?.querySelectorAll('[data-project-index]');
                projectElements?.forEach(element => {
                    element.eventHandler?.clearValidationCache();
                });
            }
            
            forceRealTimeValidationAll() {
                const projectElements = this.elements.projectsList?.querySelectorAll('[data-project-index]');
                projectElements?.forEach(element => {
                    element.eventHandler?.triggerRealTimeValidation(true);
                });
            }
            
            async handleValidateAll() {
                try {
                    // ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ æ¤œè¨¼ã‚’ä¸€æ™‚ç„¡åŠ¹åŒ–ï¼ˆãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹å‘ä¸Šï¼‰
                    this.toggleRealTimeValidation(false);
                    
                    const projectElements = this.elements.projectsList?.querySelectorAll('[data-project-index]');
                    const results = [];
                    
                    // ãƒ—ãƒ­ã‚°ãƒ¬ã‚¹è¡¨ç¤º
                    this.showValidationProgress(0, projectElements?.length || 0);
                    
                    // é †æ¬¡æ¤œè¨¼å®Ÿè¡Œ
                    for (let i = 0; i < (projectElements?.length || 0); i++) {
                        const projectElement = projectElements[i];
                        const result = this.validator.validateProject(projectElement, this.projects[i]);
                        results.push({
                            ...result,
                            projectData: this.projects[i],
                            index: i
                        });
                        
                        // ãƒ—ãƒ­ã‚°ãƒ¬ã‚¹æ›´æ–°
                        this.showValidationProgress(i + 1, projectElements.length);
                        
                        // UIã®ãƒ–ãƒ­ãƒƒã‚­ãƒ³ã‚°ã‚’é˜²ããŸã‚ã®å°ã•ãªé…å»¶
                        if (i % 5 === 4) {
                            await new Promise(resolve => setTimeout(resolve, 10));
                        }
                    }
                    
                    this.displayOverallResults(results);
                    this.generateFormattedText(results);
                    
                    const okCount = results.filter(r => r.overallCheck).length;
                    this.notificationManager.showSuccess(`âœ… ä¸€æ‹¬æ¤œè¨¼å®Œäº†: ${okCount}/${results.length}ä»¶ãŒOK`);
                    
                    // ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ æ¤œè¨¼ã‚’å†æœ‰åŠ¹åŒ–
                    setTimeout(() => {
                        this.toggleRealTimeValidation(true);
                        this.forceRealTimeValidationAll();
                    }, 500);
                    
                } catch (error) {
                    this.notificationManager.showError('æ¤œè¨¼å‡¦ç†ä¸­ã«ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ');
                    console.error('âŒ æ¤œè¨¼ã‚¨ãƒ©ãƒ¼:', error);
                } finally {
                    this.hideValidationProgress();
                }
            }
            
            showValidationProgress(current, total) {
                const progressContainer = this.elements.projectsList?.parentElement;
                if (!progressContainer) return;
                
                let progressDiv = progressContainer.querySelector('.validation-progress');
                if (!progressDiv) {
                    progressDiv = document.createElement('div');
                    progressDiv.className = 'validation-progress fixed top-4 left-1/2 transform -translate-x-1/2 bg-white border border-blue-300 rounded-lg p-4 shadow-lg z-50';
                    progressContainer.appendChild(progressDiv);
                }
                
                const percentage = total > 0 ? Math.round((current / total) * 100) : 0;
                
                progressDiv.innerHTML = `
                    <div class="flex items-center space-x-3">
                        <div class="animate-spin rounded-full h-6 w-6 border-b-2 border-blue-600"></div>
                        <div>
                            <div class="text-sm font-medium text-blue-700">æ¤œè¨¼å®Ÿè¡Œä¸­...</div>
                            <div class="text-xs text-gray-600">${current}/${total}ä»¶ (${percentage}%)</div>
                        </div>
                    </div>
                    <div class="mt-2 bg-gray-200 rounded-full h-2">
                        <div class="bg-blue-600 h-2 rounded-full transition-all duration-300" style="width: ${percentage}%"></div>
                    </div>
                `;
                
                progressDiv.style.display = 'block';
            }
            
            hideValidationProgress() {
                const progressDiv = document.querySelector('.validation-progress');
                if (progressDiv) {
                    progressDiv.style.display = 'none';
                }
            }
            
            displayOverallResults(results) {
                const okCount = results.filter(r => r.overallCheck).length;
                const totalCount = results.length;
                
                const html = `
                    <div class="mb-6 p-4 rounded-lg ${okCount === totalCount ? 'bg-green-50 border border-green-200' : 'bg-yellow-50 border border-yellow-200'}">
                        <h4 class="font-semibold text-lg mb-2">æ¤œè¨¼ã‚µãƒãƒªãƒ¼</h4>
                        <p class="text-gray-700">å…¨${totalCount}ä»¶ä¸­ <span class="font-semibold text-green-600">${okCount}ä»¶OK</span>ã€<span class="font-semibold text-red-600">${totalCount - okCount}ä»¶NG</span></p>
                        <div class="mt-2 bg-gray-200 rounded-full h-2">
                            <div class="bg-green-500 h-2 rounded-full transition-all duration-300" style="width: ${(okCount/totalCount)*100}%"></div>
                        </div>
                    </div>
                    
                    <div class="space-y-3">
                        ${results.map((result, index) => {
                            const spec = result.projectData.basicInfo['ä»•æ§˜'] || 'ä¸æ˜';
                            return `
                                <div class="flex justify-between items-center p-3 rounded-lg border ${result.overallCheck ? 'bg-green-50 border-green-200' : 'bg-red-50 border-red-200'}">
                                    <span class="font-medium">${index + 1}. ${spec}</span>
                                    <span class="px-3 py-1 rounded-full text-sm font-medium ${result.overallCheck ? 'bg-green-100 text-green-800' : 'bg-red-100 text-red-800'}">
                                        ${result.overallCheck ? 'âœ“ OK' : 'âœ— NG'}
                                    </span>
                                </div>
                            `;
                        }).join('')}
                    </div>
                `;
                
                if (this.elements.overallResultsContent) {
                    this.elements.overallResultsContent.innerHTML = html;
                }
                
                if (this.elements.overallResults) {
                    this.elements.overallResults.style.display = 'block';
                }
            }
            
            generateFormattedText(results) {
                const formatter = new TextFormatter();
                const formattedText = formatter.generateFormattedText(results);
                
                if (this.elements.formattedText) {
                    this.elements.formattedText.textContent = formattedText;
                }
                
                if (this.elements.formattedTextSection) {
                    this.elements.formattedTextSection.style.display = 'block';
                }
            }
            
            async copyToClipboard() {
                try {
                    const textToCopy = this.elements.formattedText?.textContent;
                    if (!textToCopy) {
                        throw new Error('ã‚³ãƒ”ãƒ¼ã™ã‚‹ãƒ†ã‚­ã‚¹ãƒˆãŒã‚ã‚Šã¾ã›ã‚“');
                    }
                    
                    await navigator.clipboard.writeText(textToCopy);
                    this.notificationManager.showSuccess('ã‚¯ãƒªãƒƒãƒ—ãƒœãƒ¼ãƒ‰ã«ã‚³ãƒ”ãƒ¼ã—ã¾ã—ãŸ');
                } catch (error) {
                    this.notificationManager.showError('ã‚¯ãƒªãƒƒãƒ—ãƒœãƒ¼ãƒ‰ã¸ã®ã‚³ãƒ”ãƒ¼ã«å¤±æ•—ã—ã¾ã—ãŸ');
                    console.error('ã‚³ãƒ”ãƒ¼ã‚¨ãƒ©ãƒ¼:', error);
                }
            }
            
            toggleProcessingState(isProcessing) {
                if (this.elements.processDataBtn) {
                    this.elements.processDataBtn.disabled = isProcessing;
                    this.elements.processDataBtn.textContent = isProcessing ? 'å‡¦ç†ä¸­...' : 'ãƒ‡ãƒ¼ã‚¿å‡¦ç†';
                }
            }
            
            clearAll() {
                Object.values(this.elements).forEach(element => {
                    if (element?.tagName === 'TEXTAREA' || element?.tagName === 'INPUT') {
                        element.value = '';
                    }
                });
                
                this.projects = [];
                this.applicationDataMap.clear();
                
                ['projectsSection', 'overallResults', 'formattedTextSection'].forEach(id => {
                    if (this.elements[id]) {
                        this.elements[id].style.display = 'none';
                    }
                });
                
                this.elements.inputData?.focus();
                this.notificationManager.showSuccess('å…¨ã¦ã®ãƒ‡ãƒ¼ã‚¿ã‚’ã‚¯ãƒªã‚¢ã—ã¾ã—ãŸ');
            }
        }
        
        // ãƒ‡ãƒ¼ã‚¿è§£æã‚¯ãƒ©ã‚¹
        class DataParser {
            parseRawData(text) {
                const sections = text.split(/\n\s*\n/).filter(section => section.trim() !== '');
                const projects = [];
                
                for (let i = 0; i < sections.length; i++) {
                    const section = sections[i];
                    const lines = section.split('\n').map(line => line.trim()).filter(line => line !== '');
                    const basicInfo = this.parseDataSection(lines, i + 1);
                    
                    // ã‚ˆã‚ŠæŸ”è»Ÿãªæ¡ä»¶ã§æ¡ˆä»¶ã‚’åˆ¤å®š
                    if (this.isValidProject(basicInfo)) {
                        projects.push({ basicInfo });
                        console.log(`ğŸ“‹ æ¡ˆä»¶${projects.length}ã®è§£æçµæœ:`, basicInfo);
                    } else {
                        console.warn(`âš ï¸ æ¡ˆä»¶${i + 1}ã®ãƒ‡ãƒ¼ã‚¿ãŒä¸å®Œå…¨ã§ã™:`, basicInfo);
                    }
                }
                
                return projects;
            }
            
            parseDataSection(lines, projectIndex) {
                const basicInfo = {};
                
                for (const line of lines) {
                    const parsedData = this.parseDataLine(line);
                    if (parsedData) {
                        Object.assign(basicInfo, parsedData);
                    }
                }
                
                // ãƒ‡ãƒ¼ã‚¿å“è³ªãƒã‚§ãƒƒã‚¯ã¨ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯å‡¦ç†
                return this.applyDataFallbacks(basicInfo, projectIndex);
            }
            
            parseDataLine(line) {
                // è¤‡æ•°ã®åŒºåˆ‡ã‚Šæ–‡å­—ãƒ‘ã‚¿ãƒ¼ãƒ³ã«å¯¾å¿œ
                const separators = [
                    /\t+/,           // ã‚¿ãƒ–åŒºåˆ‡ã‚Š
                    /\s{2,}/,        // è¤‡æ•°ã‚¹ãƒšãƒ¼ã‚¹
                    /[:ï¼š]\s*/,      // ã‚³ãƒ­ãƒ³åŒºåˆ‡ã‚Š
                    /[ã€€\s]+/        // å…¨è§’ãƒ»åŠè§’ã‚¹ãƒšãƒ¼ã‚¹æ··åœ¨
                ];
                
                for (const separator of separators) {
                    const parts = line.split(separator);
                    if (parts.length >= 2) {
                        const key = parts[0].trim();
                        const value = parts.slice(1).join(' ').trim(); // æ®‹ã‚Šå…¨éƒ¨ã‚’çµåˆ
                        
                        if (key && value && key !== value) {
                            return { [key]: value };
                        }
                    }
                }
                
                // ç‰¹æ®Šãƒ‘ã‚¿ãƒ¼ãƒ³ã®è§£æï¼ˆé …ç›®åãŒå«ã¾ã‚Œã¦ã„ãªã„å ´åˆï¼‰
                return this.parseSpecialPatterns(line);
            }
            
            parseSpecialPatterns(line) {
                // å‹ç•ªã‚‰ã—ã„ãƒ‘ã‚¿ãƒ¼ãƒ³ï¼ˆè‹±æ•°å­—ã¨ãƒã‚¤ãƒ•ãƒ³ç­‰ï¼‰
                if (/^[A-Za-z0-9\-_.]+$/.test(line) && line.length > 3) {
                    return { 'å‹ç•ª': line };
                }

                // ä¾¡æ ¼ãƒ‘ã‚¿ãƒ¼ãƒ³ï¼ˆåŠ å·¥è²»ã‚’å«ã‚€ï¼‰
                if (/Â¥?\d+(\.\d+)?å††?/.test(line)) {
                    // åŠ å·¥è²»ã®ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ãŒã‚ã‚‹å ´åˆ
                    if (/åŠ å·¥è²»|åŠ å·¥æ–™|å·¥è³ƒ|å‰å›ã®æ³¨æ–‡åŠ å·¥è²»/.test(line)) {
                        return { 'å‰å›ã®æ³¨æ–‡åŠ å·¥è²»': line.replace(/.*?(\Â¥?\d+(\.\d+)?å††?).*/, '$1') };
                    }
                    // ãã‚Œä»¥å¤–ã¯å˜ä¾¡
                    return { 'å‰å›ã®æ³¨æ–‡å˜ä¾¡': line };
                }

                // æ•°é‡ãƒ‘ã‚¿ãƒ¼ãƒ³
                if (/^\d+å€‹?$/.test(line)) {
                    const quantity = line.replace(/å€‹?$/, '');
                    return { 'å¹´é–“ä½¿ç”¨æ•°': quantity };
                }

                return null;
            }
            
            applyDataFallbacks(basicInfo, projectIndex) {
                // ã‚­ãƒ¼ãƒãƒƒãƒ”ãƒ³ã‚°ï¼šç”Ÿãƒ‡ãƒ¼ã‚¿ã®ã‚­ãƒ¼ â†’ å†…éƒ¨ã‚­ãƒ¼
                const keyMapping = {
                    'å‰å›ã®æ³¨æ–‡åŠ å·¥è²»': 'å‰å›æ³¨æ–‡åŠ å·¥è²»',
                    'å‰å›æ³¨æ–‡åŠ å·¥è²»': 'å‰å›æ³¨æ–‡åŠ å·¥è²»',
                    'åŠ å·¥è²»': 'å‰å›æ³¨æ–‡åŠ å·¥è²»',
                    'ä»•è¨³ç§‘ç›®': 'ç§‘ç›®',
                    'ç§‘ç›®': 'ç§‘ç›®'
                };

                // ãƒãƒƒãƒ”ãƒ³ã‚°ã•ã‚ŒãŸãƒ‡ãƒ¼ã‚¿ã§åŸºæœ¬æƒ…å ±ã‚’æ›´æ–°
                const mappedInfo = { ...basicInfo };
                Object.keys(keyMapping).forEach(sourceKey => {
                    if (basicInfo[sourceKey]) {
                        const targetKey = keyMapping[sourceKey];
                        mappedInfo[targetKey] = basicInfo[sourceKey];
                        console.log(`ğŸ”„ ã‚­ãƒ¼ãƒãƒƒãƒ”ãƒ³ã‚°: "${sourceKey}" â†’ "${targetKey}" (å€¤: ${basicInfo[sourceKey]})`);
                        // å…ƒã®ã‚­ãƒ¼ãŒç•°ãªã‚‹å ´åˆã¯å‰Šé™¤
                        if (sourceKey !== targetKey) {
                            delete mappedInfo[sourceKey];
                        }
                    }
                });

                const fallbacks = {
                    'ä»•æ§˜': this.generateSpecFallback(mappedInfo, projectIndex),
                    'å‹ç•ª': mappedInfo['å‹ç•ª'] || `TYPE-${projectIndex}`,
                    'åœ¨åº«æ•°': mappedInfo['åœ¨åº«æ•°'] || '0',
                    'å¹´é–“ä½¿ç”¨æ•°': mappedInfo['å¹´é–“ä½¿ç”¨æ•°'] || '0',
                    'è³¼è²·å…ˆ': mappedInfo['è³¼è²·å…ˆ'] || 'æœªæŒ‡å®š',
                    'å‰å›ã®æ³¨æ–‡å˜ä¾¡': mappedInfo['å‰å›ã®æ³¨æ–‡å˜ä¾¡'] || 'Â¥0',
                    'å‰å›æ³¨æ–‡åŠ å·¥è²»': mappedInfo['å‰å›æ³¨æ–‡åŠ å·¥è²»'] || 'Â¥0',
                    'ç§‘ç›®': mappedInfo['ç§‘ç›®'] || 'æœªæŒ‡å®š'
                };

                // æ—¢å­˜ãƒ‡ãƒ¼ã‚¿ã‚’å„ªå…ˆã—ã€ä¸è¶³åˆ†ã‚’ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯ã§è£œå®Œ
                return { ...fallbacks, ...mappedInfo };
            }
            
            generateSpecFallback(basicInfo, projectIndex) {
                // æ—¢å­˜ã®ä»•æ§˜ï¼ˆç‰©å“åï¼‰ãŒã‚ã‚Œã°ãã‚Œã‚’ä½¿ç”¨
                if (basicInfo['ä»•æ§˜']) {
                    return basicInfo['ä»•æ§˜'];
                }
                
                // å‹ç•ªã‹ã‚‰ç‰©å“åã‚’æ¨å®š
                if (basicInfo['å‹ç•ª'] && !basicInfo['å‹ç•ª'].includes('TYPE-')) {
                    return `${basicInfo['å‹ç•ª']}`;
                }
                
                // ä»–ã®ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã‹ã‚‰æ¨å®š
                const candidates = [
                    basicInfo['å•†å“å'],
                    basicInfo['å“å'],
                    basicInfo['è£½å“å'],
                    basicInfo['éƒ¨å“å'],
                    basicInfo['ç‰©å“å']
                ];
                
                for (const candidate of candidates) {
                    if (candidate) {
                        return candidate;
                    }
                }
                
                // æœ€çµ‚ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯
                return `ç‰©å“${projectIndex}`;
            }
            
            isValidProject(basicInfo) {
                // ã‚ˆã‚ŠæŸ”è»Ÿãªåˆ¤å®šæ¡ä»¶
                const hasEssentialData = 
                    basicInfo['ä»•æ§˜'] || 
                    basicInfo['å‹ç•ª'] || 
                    basicInfo['å¹´é–“ä½¿ç”¨æ•°'] ||
                    basicInfo['å•†å“å'] ||
                    basicInfo['å“å'] ||
                    basicInfo['ç‰©å“å'] ||
                    basicInfo['åœ¨åº«æ•°'];
                
                // å°‘ãªãã¨ã‚‚1ã¤ã®é‡è¦ãƒ‡ãƒ¼ã‚¿ãŒã‚ã‚Œã°æœ‰åŠ¹
                return hasEssentialData;
            }
            
            parseApplicationData(text) {
                const lines = text.split('\n').map(line => line.trim()).filter(line => line !== '');
                const applicationMap = new Map();

                for (const line of lines) {
                    if (line.startsWith('http')) continue;

                    // ç§‘ç›®ã‚’å«ã‚€ãƒ‘ã‚¿ãƒ¼ãƒ³ãƒãƒƒãƒãƒ³ã‚°
                    // ãƒ‘ã‚¿ãƒ¼ãƒ³: ç§‘ç›®:ä»•æ§˜:å˜ä¾¡/æ•°é‡ ã¾ãŸã¯ ä»•æ§˜:å˜ä¾¡/æ•°é‡
                    const patternsWithSubject = [
                        /^(.+?)[:ï¼š](.+?)[:ï¼š]\s*@?([\d,.]+)å††?\s*\/\s*(\d+)å€‹?/,  // ç§‘ç›®:ä»•æ§˜:å˜ä¾¡/æ•°é‡
                        /^(.+?)[:ï¼š](.+?)\s+([\d,.]+)å††?\s*\/\s*(\d+)å€‹?/          // ç§‘ç›®:ä»•æ§˜ å˜ä¾¡/æ•°é‡
                    ];

                    let matched = false;
                    for (const pattern of patternsWithSubject) {
                        const match = line.match(pattern);
                        if (match) {
                            const [, subject, spec, price, quantity] = match;
                            const cleanSpec = spec.trim();
                            const cleanSubject = subject.trim();
                            applicationMap.set(cleanSpec, {
                                unitPrice: parseFloat(price.replace(/,/g, '')),
                                quantity: parseInt(quantity),
                                subject: cleanSubject
                            });
                            console.log(`ğŸ“Š ç”³è«‹ãƒ‡ãƒ¼ã‚¿è§£æ: ${cleanSubject}:${cleanSpec} -> å˜ä¾¡:${price}å††, æ•°é‡:${quantity}å€‹`);
                            matched = true;
                            break;
                        }
                    }

                    if (matched) continue;

                    // ã‚ˆã‚ŠæŸ”è»Ÿãªãƒ‘ã‚¿ãƒ¼ãƒ³ãƒãƒƒãƒãƒ³ã‚° - å°æ•°ç‚¹ã‚’å«ã‚€ä¾¡æ ¼ã«ã‚‚å¯¾å¿œï¼ˆç§‘ç›®ãªã—ï¼‰
                    const patterns = [
                        /^(.+?)[:ï¼š]\s*@?([\d,.]+)å††?\s*\/\s*(\d+)å€‹?/,  // åŸºæœ¬ãƒ‘ã‚¿ãƒ¼ãƒ³ï¼ˆå°æ•°ç‚¹å¯¾å¿œï¼‰
                        /^(.+?)\s+([\d,.]+)å††?\s*\/\s*(\d+)å€‹?/,        // ã‚¹ãƒšãƒ¼ã‚¹åŒºåˆ‡ã‚Šï¼ˆå°æ•°ç‚¹å¯¾å¿œï¼‰
                        /^(.+?)\s*@([\d,.]+)\/(\d+)/                    // @åŒºåˆ‡ã‚Šï¼ˆå°æ•°ç‚¹å¯¾å¿œï¼‰
                    ];

                    for (const pattern of patterns) {
                        const match = line.match(pattern);
                        if (match) {
                            const [, spec, price, quantity] = match;
                            const cleanSpec = spec.trim();
                            applicationMap.set(cleanSpec, {
                                unitPrice: parseFloat(price.replace(/,/g, '')),
                                quantity: parseInt(quantity),
                                subject: '' // ç§‘ç›®ãªã—
                            });
                            console.log(`ğŸ“Š ç”³è«‹ãƒ‡ãƒ¼ã‚¿è§£æ: ${cleanSpec} -> å˜ä¾¡:${price}å††, æ•°é‡:${quantity}å€‹`);
                            break;
                        }
                    }
                }

                console.log(`âœ… ç”³è«‹ãƒ‡ãƒ¼ã‚¿è§£æå®Œäº†: ${applicationMap.size}ä»¶`);
                return applicationMap;
            }
        }
        
        // ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆæ¤œè¨¼ã‚¯ãƒ©ã‚¹
        class ProjectValidator {
            validateProject(projectElement, projectData) {
                const formData = this.extractFormData(projectElement);
                const checks = this.performValidationChecks(formData, projectData);
                
                this.displayProjectValidationResult(projectElement, checks, projectData);
                return checks;
            }
            
            extractFormData(projectElement) {
                return {
                    orderQuantity: parseInt(projectElement.querySelector('.order-quantity')?.value) || 0,
                    applicationPrice: projectElement.querySelector('.application-price')?.value || '',
                    totalAmount: projectElement.querySelector('.total-amount')?.value || '',
                    taxIncluded: projectElement.querySelector('.tax-included')?.checked || false,
                    zaicoModel: projectElement.querySelector('.zaico-model')?.value?.trim() || '',
                    supplierModel: projectElement.querySelector('.supplier-model')?.value?.trim() || '',
                    zaicoDrawingNo: projectElement.querySelector('.zaico-drawing-no')?.value?.trim() || '',
                    supplierDrawingNo: projectElement.querySelector('.supplier-drawing-no')?.value?.trim() || '',
                    zaicoSubject: projectElement.querySelector('.zaico-subject')?.value?.trim() || '',
                    supplierSubject: projectElement.querySelector('.supplier-subject')?.value?.trim() || '',
                    isBestPrice: projectElement.querySelector('.best-price')?.checked || false,
                    hasOneYearOrder: projectElement.querySelector('.one-year-order')?.checked || false,
                    hasSpecialReason: projectElement.querySelector('.special-reason')?.checked || false,
                    specialReasonDetail: projectElement.querySelector('.special-reason-detail')?.value?.trim() || '',
                    hasSpecialAdoption: projectElement.querySelector('.special-adoption')?.checked || false,
                    specialAdoptionDetail: projectElement.querySelector('.special-adoption-detail')?.value?.trim() || '',
                    hasSpecMatchConfirmed: projectElement.querySelector('.spec-match-confirmed')?.checked || false,
                    hasModelException: projectElement.querySelector('.model-exception')?.checked || false,
                    modelExceptionDetail: projectElement.querySelector('.model-exception-detail')?.value?.trim() || '',
                    hasNoDrawingNumber: projectElement.querySelector('.no-drawing-number')?.checked || false,
                    hasDrawingException: projectElement.querySelector('.drawing-exception')?.checked || false,
                    drawingExceptionDetail: projectElement.querySelector('.drawing-exception-detail')?.value?.trim() || '',
                    hasSubjectException: projectElement.querySelector('.subject-exception')?.checked || false,
                    subjectExceptionDetail: projectElement.querySelector('.subject-exception-detail')?.value?.trim() || '',
                    hasProcessingFeeComparison: projectElement.querySelector('.processing-fee-comparison')?.checked || false,
                    hasProcessingFeeIncrease: projectElement.querySelector('.processing-fee-increase')?.checked || false,
                    processingFeeIncreaseDetail: projectElement.querySelector('.processing-fee-increase-detail')?.value?.trim() || ''
                };
            }
            
            performValidationChecks(formData, projectData) {
                const annualUsage = parseInt(projectData.basicInfo['å¹´é–“ä½¿ç”¨æ•°']) || 0;
                const previousPriceStr = projectData.basicInfo['å‰å›ã®æ³¨æ–‡å˜ä¾¡'] || 'Â¥0';
                const previousPrice = parseFloat(previousPriceStr.replace(/[Â¥,\s]/g, ''));

                // æ³¨æ–‡æ•°æ¤œè¨¼
                const isInNormalRange = formData.orderQuantity >= annualUsage / 2 && formData.orderQuantity <= annualUsage;
                const orderCheck = isInNormalRange || formData.hasOneYearOrder || (formData.hasSpecialReason && formData.specialReasonDetail !== '');

                // ä¾¡æ ¼æ¤œè¨¼
                const calculatedPrice = this.calculateUnitPrice(formData.totalAmount, formData.orderQuantity, formData.taxIncluded);
                const priceCheck = this.validatePrice(calculatedPrice, previousPrice, formData);

                // å‹ç•ªæ¤œè¨¼
                const modelCheck = this.validateModel(formData);

                // å›³ç•ªæ¤œè¨¼
                const drawingCheck = this.validateDrawing(formData);

                // ç§‘ç›®æ¤œè¨¼
                const subjectCheck = this.validateSubject(formData);

                // åŠ å·¥è²»æ¤œè¨¼
                const processingFeeCheck = this.validateProcessingFee(formData, projectData);

                // åŠ å·¥è²»æ¯”è¼ƒã®è©³ç´°æƒ…å ±ã‚’å–å¾—
                const processingFeeDetails = this.getProcessingFeeComparisonDetails(formData, projectData);

                // ç”³è«‹å˜ä¾¡ã¨ã®ä¸€è‡´ãƒã‚§ãƒƒã‚¯
                const appliedPrice = parseFloat(formData.applicationPrice.replace(/[Â¥,\s]/g, ''));
                const unitPriceMatch = Math.abs(appliedPrice - calculatedPrice) < 0.01;

                return {
                    orderCheck,
                    priceCheck,
                    modelCheck,
                    drawingCheck,
                    subjectCheck,
                    processingFeeCheck,
                    unitPriceMatch,
                    overallCheck: orderCheck && priceCheck && modelCheck && drawingCheck && subjectCheck && processingFeeCheck && unitPriceMatch,
                    calculatedPrice: calculatedPrice.toFixed(2),
                    processingFeeDetails,
                    ...formData
                };
            }
            
            calculateUnitPrice(totalAmount, quantity, taxIncluded = false) {
                if (!totalAmount || !quantity || quantity <= 0) return 0;
                
                const total = parseFloat(totalAmount.replace(/[Â¥,\s]/g, '')) || 0;
                let unitPrice = 0;
                
                if (taxIncluded) {
                    // ç¨è¾¼ã®å ´åˆ: ç¨è¾¼ - (ç¨è¾¼/11)ã€å°æ•°ç¬¬3ä½ã§åˆ‡ã‚Šæ¨ã¦
                    const taxAmount = total / 11;
                    const totalWithoutTax = total - taxAmount;
                    unitPrice = totalWithoutTax / quantity;
                    
                    // å°æ•°ç¬¬3ä½ã§åˆ‡ã‚Šæ¨ã¦ (Math.floor(value * 100) / 100)
                    unitPrice = Math.floor(unitPrice * 100) / 100;
                } else {
                    // ç¨æŠœã®å ´åˆ: é€šå¸¸ã®è¨ˆç®—
                    unitPrice = total / quantity;
                    unitPrice = Math.floor(unitPrice * 100) / 100;
                }
                
                return unitPrice;
            }
            
            validatePrice(calculatedPrice, previousPrice, formData) {
                if (calculatedPrice <= previousPrice) return true;
                if (calculatedPrice > previousPrice && formData.isBestPrice) return true;
                if (calculatedPrice > previousPrice && formData.hasSpecialAdoption && formData.specialAdoptionDetail !== '') return true;
                return false;
            }
            
            validateModel(formData) {
                // ä»•æ§˜ä¸€è‡´ç¢ºèªãŒãƒã‚§ãƒƒã‚¯æ¸ˆã¿ã®å ´åˆã¯OK
                if (formData.hasSpecMatchConfirmed) {
                    return true;
                }

                const modelsMatch = formData.zaicoModel !== '' && formData.supplierModel !== '' &&
                                 formData.zaicoModel.replace(/\s/g, '') === formData.supplierModel.replace(/\s/g, '');
                const hasException = formData.hasModelException && formData.modelExceptionDetail !== '';

                return modelsMatch || hasException;
            }
            
            validateDrawing(formData) {
                // å›³ç•ªãªã—ã®å ´åˆã¯OK
                if (formData.hasNoDrawingNumber) {
                    return true;
                }

                // å›³ç•ªãŒä¸€è‡´ã—ã¦ã„ã‚‹å ´åˆã¯OK
                const drawingsMatch = formData.zaicoDrawingNo !== '' && formData.supplierDrawingNo !== '' &&
                                    formData.zaicoDrawingNo.replace(/\s/g, '') === formData.supplierDrawingNo.replace(/\s/g, '');

                // å›³ç•ªä¸ä¸€è‡´ã®ç‰¹åˆ¥äº‹æƒ…ãŒã‚ã‚‹å ´åˆã¯OK
                const hasException = formData.hasDrawingException && formData.drawingExceptionDetail !== '';

                return drawingsMatch || hasException;
            }

            validateSubject(formData) {
                // ç§‘ç›®ãŒä¸€è‡´ã—ã¦ã„ã‚‹å ´åˆã¯OK
                const subjectsMatch = formData.zaicoSubject !== '' && formData.supplierSubject !== '' &&
                                     formData.zaicoSubject.replace(/\s/g, '') === formData.supplierSubject.replace(/\s/g, '');

                // ç§‘ç›®ä¸ä¸€è‡´ã®ç‰¹åˆ¥äº‹æƒ…ãŒã‚ã‚‹å ´åˆã¯OK
                const hasException = formData.hasSubjectException && formData.subjectExceptionDetail !== '';

                return subjectsMatch || hasException;
            }
            
            validateProcessingFee(formData, projectData) {
                // åŠ å·¥è²»æ¯”è¼ƒãƒã‚§ãƒƒã‚¯ãƒœãƒƒã‚¯ã‚¹ãŒãƒã‚§ãƒƒã‚¯ã•ã‚Œã¦ã„ãªã„å ´åˆã¯OKï¼ˆæ¯”è¼ƒã—ãªã„ï¼‰
                if (!formData.hasProcessingFeeComparison) {
                    return true;
                }

                // ç”³è«‹å˜ä¾¡ã‚’å–å¾—
                const applicationPrice = parseFloat(formData.applicationPrice.replace(/[Â¥,\s]/g, ''));
                if (!applicationPrice || applicationPrice === 0) {
                    return false;
                }

                // å‰å›æ³¨æ–‡åŠ å·¥è²»ã‚’å–å¾—
                const previousProcessingFeeStr = projectData.basicInfo['å‰å›æ³¨æ–‡åŠ å·¥è²»'] || 'Â¥0';
                const previousProcessingFee = parseFloat(previousProcessingFeeStr.replace(/[Â¥,\s]/g, ''));

                // ç”³è«‹å˜ä¾¡ãŒå‰å›æ³¨æ–‡åŠ å·¥è²»ä»¥ä¸‹ã®å ´åˆã¯OK
                if (applicationPrice <= previousProcessingFee) {
                    return true;
                }

                // ç”³è«‹å˜ä¾¡ãŒå‰å›æ³¨æ–‡åŠ å·¥è²»ã‚ˆã‚Šé«˜ã„å ´åˆã¯ã€ç‰¹åˆ¥äº‹æƒ…ã®è¨˜è¼‰ãŒã‚ã‚Œã°OK
                if (applicationPrice > previousProcessingFee && formData.hasProcessingFeeIncrease && formData.processingFeeIncreaseDetail !== '') {
                    return true;
                }

                // ãã‚Œä»¥å¤–ã¯NG
                return false;
            }

            // åŠ å·¥è²»æ¯”è¼ƒã®è©³ç´°æƒ…å ±ã‚’å–å¾—ã™ã‚‹æ–°ã—ã„ãƒ¡ã‚½ãƒƒãƒ‰ï¼ˆå‰å›æ³¨æ–‡åŠ å·¥è²» vs ç”³è«‹å˜ä¾¡ï¼‰
            getProcessingFeeComparisonDetails(formData, projectData) {
                if (!formData.hasProcessingFeeComparison) {
                    return null;
                }

                const previousProcessingFeeStr = projectData.basicInfo['å‰å›æ³¨æ–‡åŠ å·¥è²»'] || 'Â¥0';
                const previousProcessingFee = parseFloat(previousProcessingFeeStr.replace(/[Â¥,\s]/g, ''));
                const applicationPrice = parseFloat((formData.applicationPrice || '0').replace(/[Â¥,\s]/g, ''));

                const difference = applicationPrice - previousProcessingFee;
                const percentageChange = previousProcessingFee > 0 ? (difference / previousProcessingFee) * 100 : 0;

                return {
                    previousFee: previousProcessingFee,
                    currentFee: applicationPrice,
                    difference: difference,
                    percentageChange: percentageChange,
                    isIncrease: difference > 0,
                    isDecrease: difference < 0,
                    isSame: difference === 0,
                    hasIncreasedWithReason: difference > 0 && formData.hasProcessingFeeIncrease && formData.processingFeeIncreaseDetail
                };
            }
            
            displayProjectValidationResult(projectElement, result, projectData) {
                const resultDiv = projectElement.querySelector('.validation-result');
                const statusDiv = projectElement.querySelector('.validation-status');
                
                if (statusDiv) {
                    statusDiv.style.display = 'inline-block';
                    statusDiv.className = `validation-status px-3 py-1 rounded-full text-sm font-medium ${result.overallCheck ? 'bg-green-100 text-green-800' : 'bg-red-100 text-red-800'}`;
                    statusDiv.textContent = result.overallCheck ? 'âœ“ OK' : 'âœ— NG';
                }
                
                if (resultDiv) {
                    resultDiv.innerHTML = this.generateResultHTML(result, projectData);
                    resultDiv.style.display = 'block';
                }
            }
            
            generateResultHTML(result, projectData) {
                const taxLabel = result.taxIncluded ? 'ï¼ˆç¨è¾¼è¨ˆç®—ï¼‰' : 'ï¼ˆç¨æŠœè¨ˆç®—ï¼‰';
                const stockQuantity = projectData.basicInfo['åœ¨åº«æ•°'] || '0';
                
                return `
                    <div class="flex justify-between items-center mb-3">
                        <h5 class="font-semibold">æ¤œè¨¼çµæœè©³ç´°</h5>
                        <span class="px-3 py-1 rounded-full text-sm font-medium ${result.overallCheck ? 'bg-green-100 text-green-800' : 'bg-red-100 text-red-800'}">
                            ${result.overallCheck ? 'âœ“ OK' : 'âœ— NG'}
                        </span>
                    </div>
                    
                    <div class="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-6 gap-2 text-sm mb-3">
                        ${['orderCheck', 'priceCheck', 'modelCheck', 'drawingCheck', 'processingFeeCheck', 'unitPriceMatch'].map(check => {
                            const labels = {
                                orderCheck: 'æ³¨æ–‡æ•°',
                                priceCheck: 'ä¾¡æ ¼',
                                modelCheck: 'å‹ç•ª',
                                drawingCheck: 'å›³ç•ª',
                                processingFeeCheck: 'åŠ å·¥è²»',
                                unitPriceMatch: 'å˜ä¾¡ä¸€è‡´'
                            };
                            return `
                                <div class="flex items-center ${result[check] ? 'text-green-600' : 'text-red-600'}">
                                    <span class="mr-1">${result[check] ? 'âœ“' : 'âœ—'}</span>
                                    <strong>${labels[check]}</strong>
                                </div>
                            `;
                        }).join('')}
                    </div>
                    
                    <div class="text-sm text-gray-600 bg-gray-50 p-3 rounded">
                        <div class="flex items-center mb-1">
                            <span class="mr-2">${result.taxIncluded ? 'ğŸ’°' : 'ğŸ’¡'}</span>
                            <strong>è¨ˆç®—å˜ä¾¡: Â¥${result.calculatedPrice} ${taxLabel}</strong>
                        </div>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-2 mt-2">
                            <div>å‰å›æ³¨æ–‡å˜ä¾¡: ${projectData.basicInfo['å‰å›ã®æ³¨æ–‡å˜ä¾¡']}</div>
                            <div>æ³¨æ–‡æ•°: ${result.orderQuantity}å€‹</div>
                            <div>å¹´é–“ä½¿ç”¨æ•°: ${projectData.basicInfo['å¹´é–“ä½¿ç”¨æ•°']}å€‹</div>
                            <div>åœ¨åº«æ•°: ${stockQuantity}å€‹</div>
                            <div>å‰å›æ³¨æ–‡åŠ å·¥è²»: ${projectData.basicInfo['å‰å›æ³¨æ–‡åŠ å·¥è²»'] || 'Â¥0'}</div>
                        </div>
                        ${this.generateProcessingFeeComparisonHTML(result, projectData)}
                        ${result.taxIncluded ? '<div class="text-xs text-green-700 mt-2">â€» ç¨è¾¼é‡‘é¡ã‹ã‚‰ç¨æŠœå˜ä¾¡ã‚’è‡ªå‹•è¨ˆç®—ï¼ˆå°æ•°ç¬¬3ä½åˆ‡ã‚Šæ¨ã¦ï¼‰</div>' : ''}
                    </div>
                `;
            }

            // åŠ å·¥è²»æ¯”è¼ƒã®è©³ç´°è¡¨ç¤ºHTMLç”Ÿæˆ
            generateProcessingFeeComparisonHTML(result, projectData) {
                if (!result.processingFeeDetails) {
                    return '';
                }

                const details = result.processingFeeDetails;
                const formatPrice = (price) => `Â¥${price.toLocaleString()}`;

                let comparisonText = '';
                let comparisonColor = '';
                let icon = '';

                if (details.isSame) {
                    comparisonText = 'å‰å›ã¨åŒé¡';
                    comparisonColor = 'text-blue-600';
                    icon = 'ğŸŸ°';
                } else if (details.isDecrease) {
                    const saving = Math.abs(details.difference);
                    const savingPercent = Math.abs(details.percentageChange).toFixed(1);
                    comparisonText = `${formatPrice(saving)}å‰Šæ¸› (${savingPercent}%â†“)`;
                    comparisonColor = 'text-green-600';
                    icon = 'ğŸ“‰';
                } else if (details.isIncrease) {
                    const increase = details.difference;
                    const increasePercent = details.percentageChange.toFixed(1);
                    comparisonText = `${formatPrice(increase)}ä¸Šæ˜‡ (${increasePercent}%â†‘)`;
                    comparisonColor = details.hasIncreasedWithReason ? 'text-orange-600' : 'text-red-600';
                    icon = details.hasIncreasedWithReason ? 'ğŸ“ˆ' : 'âš ï¸';
                }

                return `
                    <div class="mt-3 p-2 border-t border-gray-200">
                        <div class="flex items-center justify-between">
                            <span class="text-xs text-gray-500">ğŸ”§ åŠ å·¥è²»æ¯”è¼ƒ</span>
                            <span class="${comparisonColor} text-xs font-medium">
                                ${icon} ${comparisonText}
                            </span>
                        </div>
                        <div class="grid grid-cols-2 gap-2 mt-1 text-xs">
                            <div>å‰å›æ³¨æ–‡åŠ å·¥è²»: ${formatPrice(details.previousFee)}</div>
                            <div>ç”³è«‹å˜ä¾¡: ${formatPrice(details.currentFee)}</div>
                        </div>
                        ${details.hasIncreasedWithReason ? `
                            <div class="mt-1 text-xs text-orange-600">
                                âœ“ ä¸Šæ˜‡ç†ç”±è¨˜è¼‰æ¸ˆã¿
                            </div>
                        ` : ''}
                    </div>
                `;
            }
        }
        
        // UIç”Ÿæˆã‚¯ãƒ©ã‚¹
        class UIGenerator {
            generateProjectHTML(project, index, applicationDataMap) {
                const basicInfo = project.basicInfo;
                const projectTitle = this.generateProjectTitle(basicInfo, index);
                const application = this.findMatchingApplication(basicInfo, applicationDataMap);
                
                return `
                    <div class="border rounded-lg p-6 bg-gray-50 hover:bg-gray-100 transition-colors" data-project-index="${index}">
                        <div class="flex justify-between items-start mb-4">
                            <div class="flex-1">
                                <h4 class="font-semibold text-lg text-gray-800 mb-1">${index + 1}. ${projectTitle.main}</h4>
                                ${projectTitle.sub ? `<p class="text-sm text-gray-600">${projectTitle.sub}</p>` : ''}
                            </div>
                            <div class="validation-status px-3 py-1 rounded-full text-sm font-medium" style="display: none;"></div>
                        </div>
                        
                        <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                            ${this.generateBasicInfoSection(basicInfo)}
                            ${this.generateValidationInputSection(application, basicInfo)}
                        </div>

                        <div class="validation-result mt-6 p-4 rounded-lg bg-white border" style="display: none;"></div>
                        <div class="quotation-result-placeholder" data-project-index="${index}"></div>
                    </div>
                `;
            }
            
            generateProjectTitle(basicInfo, index) {
                // é¡Œç›®ã®æ±ºå®šï¼šå‹ç•ª â†’ ç‰©å“åã®é †ã§å„ªå…ˆ
                let mainTitle = '';
                let subTitle = '';
                
                // å„ªå…ˆé †ä½ï¼šå‹ç•ª â†’ ç‰©å“åï¼ˆä»•æ§˜ï¼‰
                if (basicInfo['å‹ç•ª'] && basicInfo['å‹ç•ª'] !== 'æœªæŒ‡å®š' && !basicInfo['å‹ç•ª'].includes('TYPE-')) {
                    mainTitle = basicInfo['å‹ç•ª'];
                    // ã‚µãƒ–ã‚¿ã‚¤ãƒˆãƒ«ã«ç‰©å“åã‚’è¡¨ç¤º
                    if (basicInfo['ä»•æ§˜'] && basicInfo['ä»•æ§˜'] !== mainTitle && !basicInfo['ä»•æ§˜'].includes('æ¡ˆä»¶')) {
                        subTitle = `ç‰©å“å: ${basicInfo['ä»•æ§˜']}`;
                    }
                } else if (basicInfo['ä»•æ§˜'] && !basicInfo['ä»•æ§˜'].includes('æ¡ˆä»¶')) {
                    mainTitle = basicInfo['ä»•æ§˜'];
                    // ã‚µãƒ–ã‚¿ã‚¤ãƒˆãƒ«ã«è³¼è²·å…ˆã‚’è¡¨ç¤º
                    if (basicInfo['è³¼è²·å…ˆ'] && basicInfo['è³¼è²·å…ˆ'] !== 'æœªæŒ‡å®š') {
                        subTitle = `è³¼è²·å…ˆ: ${basicInfo['è³¼è²·å…ˆ']}`;
                    }
                } else {
                    // ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯
                    mainTitle = `æ¡ˆä»¶${index + 1}`;
                    if (basicInfo['è³¼è²·å…ˆ'] && basicInfo['è³¼è²·å…ˆ'] !== 'æœªæŒ‡å®š') {
                        subTitle = `è³¼è²·å…ˆ: ${basicInfo['è³¼è²·å…ˆ']}`;
                    }
                }
                
                return {
                    main: mainTitle,
                    sub: subTitle
                };
            }
            
            generateBasicInfoSection(basicInfo) {
                const fields = [
                    { label: 'ç‰©å“å', key: 'ä»•æ§˜', icon: 'ğŸ“¦', required: true },
                    { label: 'å‹ç•ª', key: 'å‹ç•ª', icon: 'ğŸ”¢', required: true },
                    { label: 'åœ¨åº«æ•°', key: 'åœ¨åº«æ•°', icon: 'ğŸ“Š', required: false, type: 'number' },
                    { label: 'å¹´é–“ä½¿ç”¨æ•°', key: 'å¹´é–“ä½¿ç”¨æ•°', icon: 'ğŸ“ˆ', required: true, type: 'number' },
                    { label: 'è³¼è²·å…ˆ', key: 'è³¼è²·å…ˆ', icon: 'ğŸ¢', required: false },
                    { label: 'å‰å›æ³¨æ–‡å˜ä¾¡', key: 'å‰å›ã®æ³¨æ–‡å˜ä¾¡', icon: 'ğŸ’°', required: true },
                    { label: 'å‰å›æ³¨æ–‡åŠ å·¥è²»', key: 'å‰å›æ³¨æ–‡åŠ å·¥è²»', icon: 'ğŸ”§', required: false }
                ];
                
                return `
                    <div class="space-y-3">
                        <div class="flex justify-between items-center border-b pb-2">
                            <h5 class="font-semibold text-gray-700">ğŸ“„ åŸºæœ¬æƒ…å ±</h5>
                            <button class="edit-basic-info-btn text-xs px-2 py-1 bg-blue-100 text-blue-700 rounded hover:bg-blue-200 transition-colors">
                                âœï¸ ç·¨é›†
                            </button>
                        </div>
                        
                        <div class="basic-info-display space-y-2">
                            ${fields.map(field => {
                                const value = this.formatFieldValue(basicInfo[field.key], field.key);
                                const isEmpty = !basicInfo[field.key] || basicInfo[field.key] === 'æœªæŒ‡å®š' || basicInfo[field.key] === '0';
                                const isAutoGenerated = basicInfo[field.key] && (basicInfo[field.key].includes('æ¡ˆä»¶') || basicInfo[field.key].includes('TYPE-') || basicInfo[field.key].includes('ç‰©å“'));
                                
                                return `
                                    <div class="flex items-start ${isEmpty || isAutoGenerated ? 'opacity-60' : ''}">
                                        <span class="mr-2">${field.icon}</span>
                                        <strong class="text-gray-600 min-w-[120px] text-sm ${field.required ? 'after:content-["*"] after:text-red-500' : ''}">${field.label}:</strong>
                                        <span class="text-gray-800 ml-2 text-sm flex-1 ${isEmpty ? 'italic' : ''} ${isAutoGenerated ? 'text-orange-600' : ''}">${value}</span>
                                        ${isAutoGenerated ? '<span class="ml-1 text-xs text-orange-500">è‡ªå‹•ç”Ÿæˆ</span>' : ''}
                                    </div>
                                `;
                            }).join('')}
                        </div>
                        
                        <div class="basic-info-edit space-y-3" style="display: none;">
                            ${fields.map(field => {
                                const value = basicInfo[field.key] || '';
                                const displayValue = (value === 'æœªæŒ‡å®š' || value.includes('æ¡ˆä»¶') || value.includes('TYPE-') || value.includes('ç‰©å“')) ? '' : value;
                                const cleanValue = displayValue.replace(/Â¥|å††|å€‹\/å¹´|å€‹/g, '');
                                
                                return `
                                    <div>
                                        <label class="block text-sm font-medium text-gray-700 mb-1">
                                            ${field.icon} ${field.label}${field.required ? ' <span class="text-red-500">*</span>' : ''}
                                        </label>
                                        <input
                                            type="${field.type || 'text'}"
                                            class="basic-info-input w-full p-2 border rounded-md focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-colors text-sm"
                                            data-field="${field.key}"
                                            value="${cleanValue}"
                                            placeholder="${this.getFieldPlaceholder(field.key)}"
                                            ${field.required ? 'required' : ''}
                                        />
                                        ${field.key === 'å¹´é–“ä½¿ç”¨æ•°' ? '<p class="text-xs text-gray-500 mt-1">åŠå¹´ã€œ1å¹´åˆ†ã®æ³¨æ–‡æ•°è¨ˆç®—ã«ä½¿ç”¨</p>' : ''}
                                        ${field.key === 'å‰å›ã®æ³¨æ–‡å˜ä¾¡' ? '<p class="text-xs text-gray-500 mt-1">ä¾¡æ ¼æ¯”è¼ƒã®åŸºæº–å€¤</p>' : ''}
                                    </div>
                                `;
                            }).join('')}
                            
                            <div class="flex space-x-2 pt-2 border-t">
                                <button class="save-basic-info-btn px-3 py-1 bg-green-600 text-white rounded text-sm hover:bg-green-700 transition-colors">
                                    ğŸ’¾ ä¿å­˜
                                </button>
                                <button class="cancel-basic-info-btn px-3 py-1 bg-gray-500 text-white rounded text-sm hover:bg-gray-600 transition-colors">
                                    âŒ ã‚­ãƒ£ãƒ³ã‚»ãƒ«
                                </button>
                                <button class="reset-basic-info-btn px-3 py-1 bg-orange-500 text-white rounded text-sm hover:bg-orange-600 transition-colors">
                                    ğŸ”„ å…ƒã«æˆ»ã™
                                </button>
                            </div>
                        </div>
                        
                        <!-- ãƒ‡ãƒ¼ã‚¿å“è³ªã‚¤ãƒ³ã‚¸ã‚±ãƒ¼ã‚¿ãƒ¼ -->
                        <div class="mt-3 pt-2 border-t">
                            ${this.generateDataQualityIndicator(basicInfo)}
                        </div>
                    </div>
                `;
            }
            
            getFieldPlaceholder(fieldKey) {
                const placeholders = {
                    'ä»•æ§˜': 'ç‰©å“åã‚’å…¥åŠ›ï¼ˆä¾‹ï¼šãƒœãƒ«ãƒˆã€ãƒŠãƒƒãƒˆç­‰ï¼‰',
                    'å‹ç•ª': 'å‹ç•ªã‚’å…¥åŠ›ï¼ˆä¾‹ï¼šABC-123ï¼‰',
                    'åœ¨åº«æ•°': 'ç¾åœ¨ã®åœ¨åº«æ•°',
                    'å¹´é–“ä½¿ç”¨æ•°': 'å¹´é–“ã®ä½¿ç”¨å€‹æ•°',
                    'è³¼è²·å…ˆ': 'è³¼è²·å…ˆåã‚’å…¥åŠ›',
                    'å‰å›ã®æ³¨æ–‡å˜ä¾¡': 'å‰å›ã®å˜ä¾¡ï¼ˆä¾‹ï¼š1500ï¼‰',
                    'å‰å›æ³¨æ–‡åŠ å·¥è²»': 'å‰å›ã®åŠ å·¥è²»ï¼ˆä¾‹ï¼š500ï¼‰'
                };
                return placeholders[fieldKey] || '';
            }
            
            formatFieldValue(value, fieldKey) {
                if (!value || value === 'æœªæŒ‡å®š') {
                    switch (fieldKey) {
                        case 'ä»•æ§˜':
                            return 'ç‰©å“åæœªè¨­å®š';
                        case 'å‹ç•ª':
                            return 'å‹ç•ªæœªç™»éŒ²';
                        case 'åœ¨åº«æ•°':
                            return 'åœ¨åº«æ•°æœªè¨­å®š';
                        case 'å¹´é–“ä½¿ç”¨æ•°':
                            return 'ä½¿ç”¨æ•°æœªè¨­å®š';
                        case 'è³¼è²·å…ˆ':
                            return 'è³¼è²·å…ˆæœªæŒ‡å®š';
                        case 'å‰å›ã®æ³¨æ–‡å˜ä¾¡':
                            return 'å˜ä¾¡æƒ…å ±ãªã—';
                        case 'å‰å›æ³¨æ–‡åŠ å·¥è²»':
                            return 'åŠ å·¥è²»æƒ…å ±ãªã—';
                        default:
                            return 'æƒ…å ±ãªã—';
                    }
                }
                
                // æ•°å€¤ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã®å ´åˆã®ç‰¹åˆ¥å‡¦ç†
                if (fieldKey === 'å¹´é–“ä½¿ç”¨æ•°' && value !== '0') {
                    return `${value}å€‹/å¹´`;
                }
                
                if (fieldKey === 'åœ¨åº«æ•°' && value !== '0') {
                    return `${value}å€‹`;
                }
                
                return value;
            }
            
            generateDataQualityIndicator(basicInfo) {
                const requiredFields = ['ä»•æ§˜', 'å‹ç•ª', 'åœ¨åº«æ•°', 'å¹´é–“ä½¿ç”¨æ•°', 'å‰å›ã®æ³¨æ–‡å˜ä¾¡'];
                const filledFields = requiredFields.filter(field => 
                    basicInfo[field] && 
                    basicInfo[field] !== 'æœªæŒ‡å®š' && 
                    basicInfo[field] !== '0' && 
                    !basicInfo[field].includes('æ¡ˆä»¶') &&
                    !basicInfo[field].includes('TYPE-')
                );
                
                const completeness = (filledFields.length / requiredFields.length) * 100;
                
                let indicator = '';
                let bgColor = '';
                
                if (completeness >= 80) {
                    indicator = 'ğŸŸ¢ ãƒ‡ãƒ¼ã‚¿å……å®Ÿ';
                    bgColor = 'bg-green-50 border-green-200 text-green-700';
                } else if (completeness >= 60) {
                    indicator = 'ğŸŸ¡ ãƒ‡ãƒ¼ã‚¿ä¸è¶³';
                    bgColor = 'bg-yellow-50 border-yellow-200 text-yellow-700';
                } else {
                    indicator = 'ğŸ”´ ãƒ‡ãƒ¼ã‚¿ä¸å‚™';
                    bgColor = 'bg-red-50 border-red-200 text-red-700';
                }
                
                return `
                    <div class="text-xs p-2 rounded border ${bgColor}">
                        <div class="flex justify-between items-center">
                            <span>${indicator}</span>
                            <span>${filledFields.length}/${requiredFields.length}é …ç›®</span>
                        </div>
                        <div class="mt-1 bg-gray-200 rounded-full h-1">
                            <div class="h-1 rounded-full transition-all duration-300" style="width: ${completeness}%; background-color: ${completeness >= 80 ? '#10b981' : completeness >= 60 ? '#f59e0b' : '#ef4444'}"></div>
                        </div>
                    </div>
                `;
            }
            
            generateValidationInputSection(application, basicInfo) {
                return `
                    <div class="space-y-4">
                        <h5 class="font-semibold text-gray-700 border-b pb-2">æ¤œè¨¼ãƒ‡ãƒ¼ã‚¿å…¥åŠ›</h5>

                        ${this.generateOrderQuantitySection(application)}
                        ${this.generatePriceSection(application, basicInfo)}
                        ${this.generateModelSection(basicInfo)}
                    </div>
                `;
            }
            
            generateOrderQuantitySection(application) {
                return `
                    <div class="bg-blue-50 p-4 rounded-lg border border-blue-200">
                        ${this.generateInputField('æ³¨æ–‡æ•°', 'number', 'order-quantity', application?.quantity || '', 'å¹´é–“ä½¿ç”¨æ•°ã®åŠå¹´ï½1å¹´åˆ†')}

                        <!-- æ³¨æ–‡æ•°é–¢é€£ãƒã‚§ãƒƒã‚¯ãƒœãƒƒã‚¯ã‚¹ -->
                        <div class="mt-3 space-y-2">
                            <label class="inline-flex items-center">
                                <input type="checkbox" class="one-year-order rounded text-blue-600 focus:ring-blue-500" />
                                <span class="ml-2 text-sm text-gray-700">æ³¨æ–‡æ•°ç´„1å¹´åˆ†</span>
                            </label>

                            <div>
                                <label class="inline-flex items-center">
                                    <input type="checkbox" class="special-reason rounded text-blue-600 focus:ring-blue-500" />
                                    <span class="ml-2 text-sm text-gray-700">ç‰¹åˆ¥ãªç†ç”±ï¼ˆæ³¨æ–‡æ•°ãŒç¯„å›²å¤–ã®å ´åˆï¼‰</span>
                                </label>

                                <div class="special-reason-text mt-2" style="display: none;">
                                    <textarea
                                        class="special-reason-detail w-full p-2 border rounded-md focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-colors text-sm"
                                        rows="2"
                                        placeholder="æ³¨æ–‡æ•°ãŒå¹´é–“ä½¿ç”¨æ•°ã®ç¯„å›²å¤–ã§ã‚ã‚‹ç‰¹åˆ¥ãªç†ç”±ã‚’è¨˜è¼‰ã—ã¦ãã ã•ã„"
                                    ></textarea>
                                </div>
                            </div>
                        </div>
                    </div>
                `;
            }
            
            generatePriceSection(application, basicInfo = {}) {
                // ç§‘ç›®ãŒã€Œä»•æ›å“ã€ã®å ´åˆã¯åŠ å·¥è²»æ¯”è¼ƒã‚’ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã§ãƒã‚§ãƒƒã‚¯
                const subject = basicInfo['ç§‘ç›®'] || '';
                const isProcessingFeeChecked = subject === 'ä»•æ›å“';
                const processingFeeDisplayStyle = isProcessingFeeChecked ? 'block' : 'none';

                return `
                    <div class="bg-green-50 p-4 rounded-lg border border-green-200">
                        ${this.generateInputField('ç”³è«‹å˜ä¾¡', 'text', 'application-price', application ? 'Â¥' + application.unitPrice : '', '')}

                        <div class="space-y-3">
                            ${this.generateInputField('å•†å“ç·é¡', 'text', 'total-amount', application ? 'Â¥' + (application.unitPrice * application.quantity) : '', '')}

                            <!-- ç¨è¾¼/ç¨æŠœãƒã‚§ãƒƒã‚¯ãƒœãƒƒã‚¯ã‚¹ -->
                            <div class="bg-white p-3 rounded border border-green-300">
                                <label class="inline-flex items-center">
                                    <input type="checkbox" class="tax-included rounded text-green-600 focus:ring-green-500" />
                                    <span class="ml-2 text-sm font-medium text-gray-700">ğŸ’° å•†å“ç·é¡ã¯ç¨è¾¼é‡‘é¡</span>
                                </label>
                                <p class="text-xs text-gray-600 mt-1 ml-6">
                                    âœ“ ãƒã‚§ãƒƒã‚¯æ™‚: ç¨è¾¼é‡‘é¡ã‹ã‚‰ç¨æŠœå˜ä¾¡ã‚’è¨ˆç®—<br>
                                    âœ— æœªãƒã‚§ãƒƒã‚¯: ç¨æŠœé‡‘é¡ã¨ã—ã¦å˜ä¾¡ã‚’è¨ˆç®—
                                </p>
                            </div>
                        </div>

                        <div class="calculation-display mt-3 text-sm bg-white p-3 rounded border border-green-300" style="display: none;"></div>

                        <!-- ä¾¡æ ¼é–¢é€£ãƒã‚§ãƒƒã‚¯ãƒœãƒƒã‚¯ã‚¹ -->
                        <div class="mt-4 space-y-2">
                            <label class="inline-flex items-center">
                                <input type="checkbox" class="best-price rounded text-green-600 focus:ring-green-500" />
                                <span class="ml-2 text-sm text-gray-700">ğŸ“Š ç›¸è¦‹ç©ã‚‚ã‚Šã§æœ€å®‰å€¤</span>
                            </label>

                            <label class="inline-flex items-center">
                                <input type="checkbox" class="special-adoption rounded text-green-600 focus:ring-green-500" />
                                <span class="ml-2 text-sm text-gray-700">âš ï¸ ç‰¹åˆ¥æ¡ç”¨ï¼ˆä¾¡æ ¼ä¸Šæ˜‡ã®ç‰¹åˆ¥äº‹æƒ…ï¼‰</span>
                            </label>

                            <div class="special-adoption-text mt-2" style="display: none;">
                                <textarea
                                    class="special-adoption-detail w-full p-2 border rounded-md focus:ring-2 focus:ring-green-500 focus:border-green-500 transition-colors text-sm"
                                    rows="2"
                                    placeholder="ä¾¡æ ¼ä¸Šæ˜‡ã®ç‰¹åˆ¥äº‹æƒ…ãƒ»ç†ç”±ã‚’è©³ã—ãè¨˜è¼‰ã—ã¦ãã ã•ã„"
                                ></textarea>
                            </div>

                            <!-- åŠ å·¥è²»æ¯”è¼ƒãƒã‚§ãƒƒã‚¯ãƒœãƒƒã‚¯ã‚¹ -->
                            <div class="border border-green-200 rounded-lg p-3 bg-green-50">
                                <label class="inline-flex items-center cursor-pointer">
                                    <input type="checkbox" class="processing-fee-comparison rounded text-green-600 focus:ring-green-500" ${isProcessingFeeChecked ? 'checked' : ''} />
                                    <span class="ml-2 text-sm font-medium text-green-700">ğŸ”§ åŠ å·¥è²»æ¯”è¼ƒã‚’æœ‰åŠ¹ã«ã™ã‚‹</span>
                                </label>
                                <p class="text-xs text-green-600 mt-1 ml-6">
                                    å‰å›æ³¨æ–‡åŠ å·¥è²»ã¨ç”³è«‹å˜ä¾¡ã‚’è‡ªå‹•æ¯”è¼ƒã—ã€ç”³è«‹å˜ä¾¡ãŒä¸Šæ˜‡æ™‚ã¯ç†ç”±è¨˜è¼‰ãŒå¿…è¦ã§ã™
                                    ${isProcessingFeeChecked ? '<br><strong>â€» ç§‘ç›®ãŒã€Œä»•æ›å“ã€ã®ãŸã‚è‡ªå‹•çš„ã«ãƒã‚§ãƒƒã‚¯ã•ã‚Œã¦ã„ã¾ã™</strong>' : ''}
                                </p>
                            </div>

                            <div class="processing-fee-section mt-2" style="display: ${processingFeeDisplayStyle};">
                                <div class="bg-white p-3 rounded border border-green-300">
                                    <div class="mb-3">
                                        <div class="grid grid-cols-2 gap-3">
                                            <div>
                                                <label class="block text-sm font-medium text-gray-700 mb-1">å‰å›æ³¨æ–‡åŠ å·¥è²»</label>
                                                <div class="p-2 bg-gray-100 border rounded-md text-sm text-gray-600 processing-fee-previous">
                                                    ãƒ‡ãƒ¼ã‚¿ã‹ã‚‰è‡ªå‹•å–å¾—
                                                </div>
                                            </div>
                                            <div>
                                                <label class="block text-sm font-medium text-gray-700 mb-1">ç”³è«‹å˜ä¾¡</label>
                                                <div class="p-2 bg-blue-100 border rounded-md text-sm text-blue-700 application-price-display">
                                                    ç”³è«‹å˜ä¾¡ã‚’è‡ªå‹•ä½¿ç”¨
                                                </div>
                                            </div>
                                        </div>
                                        <p class="text-xs text-gray-500 mt-2">
                                            â€» ç”³è«‹å˜ä¾¡ï¼ˆä¸Šè¨˜å…¥åŠ›æ¸ˆã¿ï¼‰ã¨å‰å›æ³¨æ–‡åŠ å·¥è²»ã‚’è‡ªå‹•æ¯”è¼ƒã—ã¾ã™
                                        </p>
                                    </div>
                                    
                                    <div class="mt-2">
                                        <label class="inline-flex items-center">
                                            <input type="checkbox" class="processing-fee-increase rounded text-green-600 focus:ring-green-500" />
                                            <span class="ml-2 text-sm text-gray-700">ç”³è«‹å˜ä¾¡ä¸Šæ˜‡ã®ç‰¹åˆ¥äº‹æƒ…</span>
                                        </label>
                                        
                                        <div class="processing-fee-increase-text mt-2" style="display: none;">
                                            <textarea
                                                class="processing-fee-increase-detail w-full p-2 border rounded-md focus:ring-2 focus:ring-green-500 focus:border-green-500 transition-colors text-sm"
                                                rows="2"
                                                placeholder="ç”³è«‹å˜ä¾¡ãŒå‰å›æ³¨æ–‡åŠ å·¥è²»ã‚ˆã‚Šä¸Šæ˜‡ã—ãŸç†ç”±ã‚’è©³ã—ãè¨˜è¼‰ã—ã¦ãã ã•ã„"
                                            ></textarea>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                `;
            }
            
            generateModelSection(basicInfo = {}) {
                const zaicoModel = basicInfo['å‹ç•ª'] || '';
                const zaicoSubject = basicInfo['ç§‘ç›®'] || '';

                return `
                    <div class="bg-purple-50 p-4 rounded-lg border border-purple-200">
                        <!-- å‹ç•ªãƒã‚§ãƒƒã‚¯ -->
                        <div>
                            <h6 class="font-medium text-purple-700 mb-3">ğŸ”¢ å‹ç•ªãƒã‚§ãƒƒã‚¯</h6>
                            <div class="grid grid-cols-2 gap-3 mb-3">
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-1">ZAICOå‹ç•ª</label>
                                    <input
                                        type="text"
                                        class="zaico-model w-full p-3 border rounded-md focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-colors"
                                        placeholder="ZAICOå‹ç•ª"
                                        value="${zaicoModel}"
                                    />
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-1">è³¼è²·å…ˆå‹ç•ª</label>
                                    <input
                                        type="text"
                                        class="supplier-model w-full p-3 border rounded-md focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-colors"
                                        placeholder="è³¼è²·å…ˆå‹ç•ª"
                                        value=""
                                    />
                                </div>
                            </div>
                            
                            <!-- å‹ç•ªé–¢é€£ãƒã‚§ãƒƒã‚¯ãƒœãƒƒã‚¯ã‚¹ -->
                            <div class="space-y-2">
                                <label class="inline-flex items-center">
                                    <input type="checkbox" class="spec-match-confirmed rounded text-purple-600 focus:ring-purple-500" />
                                    <span class="ml-2 text-sm text-gray-700">ä»•æ§˜ä¸€è‡´ç¢ºèªæ¸ˆã¿</span>
                                </label>

                                <div>
                                    <label class="inline-flex items-center">
                                        <input type="checkbox" class="model-exception rounded text-purple-600 focus:ring-purple-500" />
                                        <span class="ml-2 text-sm text-gray-700">å‹ç•ªä¸ä¸€è‡´ã®ç‰¹åˆ¥äº‹æƒ…</span>
                                    </label>

                                    <div class="model-exception-text mt-2" style="display: none;">
                                        <textarea
                                            class="model-exception-detail w-full p-2 border rounded-md focus:ring-2 focus:ring-purple-500 focus:border-purple-500 transition-colors text-sm"
                                            rows="2"
                                            placeholder="å‹ç•ªãŒä¸ä¸€è‡´ã§ã‚ã‚‹ç†ç”±ã‚’è©³ã—ãè¨˜è¼‰ã—ã¦ãã ã•ã„"
                                        ></textarea>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- å›³ç•ªãƒã‚§ãƒƒã‚¯ -->
                        <div class="mt-6 pt-4 border-t border-purple-200">
                            <h6 class="font-medium text-purple-700 mb-3">ğŸ“ å›³ç•ªãƒã‚§ãƒƒã‚¯</h6>
                            <div class="grid grid-cols-2 gap-3 mb-3">
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-1">ZAICOå›³ç•ª</label>
                                    <input
                                        type="text"
                                        class="zaico-drawing-no w-full p-3 border rounded-md focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-colors"
                                        placeholder="ZAICOå›³ç•ª"
                                        value=""
                                    />
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-1">è³¼è²·å…ˆå›³ç•ª</label>
                                    <input
                                        type="text"
                                        class="supplier-drawing-no w-full p-3 border rounded-md focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-colors"
                                        placeholder="è³¼è²·å…ˆå›³ç•ª"
                                        value=""
                                    />
                                </div>
                            </div>

                            <!-- å›³ç•ªé–¢é€£ãƒã‚§ãƒƒã‚¯ãƒœãƒƒã‚¯ã‚¹ -->
                            <div class="space-y-2">
                                <div>
                                    <label class="inline-flex items-center">
                                        <input type="checkbox" class="no-drawing-number rounded text-purple-600 focus:ring-purple-500" />
                                        <span class="ml-2 text-sm text-gray-700">ğŸ“ å›³ç•ªãªã—</span>
                                    </label>
                                </div>

                                <div>
                                    <label class="inline-flex items-center">
                                        <input type="checkbox" class="drawing-exception rounded text-purple-600 focus:ring-purple-500" />
                                        <span class="ml-2 text-sm text-gray-700">å›³ç•ªä¸ä¸€è‡´ã®ç‰¹åˆ¥äº‹æƒ…</span>
                                    </label>

                                    <div class="drawing-exception-text mt-2" style="display: none;">
                                        <textarea
                                            class="drawing-exception-detail w-full p-2 border rounded-md focus:ring-2 focus:ring-purple-500 focus:border-purple-500 transition-colors text-sm"
                                            rows="2"
                                            placeholder="å›³ç•ªãŒä¸ä¸€è‡´ã§ã‚ã‚‹ç†ç”±ã‚’è©³ã—ãè¨˜è¼‰ã—ã¦ãã ã•ã„"
                                        ></textarea>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- ç§‘ç›®ãƒã‚§ãƒƒã‚¯ -->
                        <div class="mt-6 pt-4 border-t border-purple-200">
                            <h6 class="font-medium text-purple-700 mb-3">ğŸ“‹ ç§‘ç›®ãƒã‚§ãƒƒã‚¯</h6>
                            <div class="grid grid-cols-2 gap-3 mb-3">
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-1">ZAICOç§‘ç›®</label>
                                    <input
                                        type="text"
                                        class="zaico-subject w-full p-3 border rounded-md focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-colors"
                                        placeholder="ZAICOç§‘ç›®"
                                        value="${zaicoSubject}"
                                    />
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-1">ä»•è¨³ç§‘ç›®</label>
                                    <select
                                        class="supplier-subject w-full p-3 border rounded-md focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-colors bg-white"
                                    >
                                        <option value="">é¸æŠã—ã¦ãã ã•ã„</option>
                                        <option value="åŸææ–™">åŸææ–™</option>
                                        <option value="ä»•æ›å“">ä»•æ›å“</option>
                                        <option value="è²¯è”µå“">è²¯è”µå“</option>
                                        <option value="ç ”ç©¶é–‹ç™ºè²»">ç ”ç©¶é–‹ç™ºè²»</option>
                                        <option value="æŠ€è¡“ãƒ»è£½é€ ">æŠ€è¡“ãƒ»è£½é€ </option>
                                    </select>
                                </div>
                            </div>

                            <!-- ç§‘ç›®é–¢é€£ãƒã‚§ãƒƒã‚¯ãƒœãƒƒã‚¯ã‚¹ -->
                            <div class="space-y-2">
                                <div>
                                    <label class="inline-flex items-center">
                                        <input type="checkbox" class="subject-exception rounded text-purple-600 focus:ring-purple-500" />
                                        <span class="ml-2 text-sm text-gray-700">ç§‘ç›®ä¸ä¸€è‡´ã®ç‰¹åˆ¥äº‹æƒ…</span>
                                    </label>

                                    <div class="subject-exception-text mt-2" style="display: none;">
                                        <textarea
                                            class="subject-exception-detail w-full p-2 border rounded-md focus:ring-2 focus:ring-purple-500 focus:border-purple-500 transition-colors text-sm"
                                            rows="2"
                                            placeholder="ç§‘ç›®ãŒä¸ä¸€è‡´ã§ã‚ã‚‹ç†ç”±ã‚’è©³ã—ãè¨˜è¼‰ã—ã¦ãã ã•ã„"
                                        ></textarea>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                `;
            }
            
            generateInputField(label, type, className, value, hint) {
                return `
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">${label}</label>
                        <input
                            type="${type}"
                            class="${className} w-full p-3 border rounded-md focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-colors"
                            placeholder="${label}"
                            value="${value}"
                        />
                        ${hint ? `<p class="text-xs text-gray-500 mt-1">${hint}</p>` : ''}
                    </div>
                `;
            }
            
            findMatchingApplication(basicInfo, applicationDataMap) {
                // æ¤œç´¢ã‚­ãƒ¼ã®å„ªå…ˆé †ä½ï¼šå‹ç•ª â†’ ç‰©å“åï¼ˆä»•æ§˜ï¼‰ â†’ ãã®ä»–
                const searchKeys = [
                    basicInfo['å‹ç•ª'],
                    basicInfo['ä»•æ§˜'],  // ç‰©å“å
                    basicInfo['å•†å“å'],
                    basicInfo['å“å'],
                    basicInfo['è£½å“å'],
                    basicInfo['ç‰©å“å']
                ].filter(key => key && key !== 'æœªæŒ‡å®š' && !key.includes('æ¡ˆä»¶') && !key.includes('TYPE-') && !key.includes('ç‰©å“'));
                
                // ç›´æ¥ãƒãƒƒãƒãƒ³ã‚°
                for (const key of searchKeys) {
                    if (applicationDataMap.has(key)) {
                        console.log(`ğŸ¯ ç›´æ¥ãƒãƒƒãƒãƒ³ã‚°æˆåŠŸ: ${key}`);
                        return applicationDataMap.get(key);
                    }
                }
                
                // æ­£è¦åŒ–ãƒãƒƒãƒãƒ³ã‚°
                const normalizeSpec = (specStr) => {
                    return specStr.toLowerCase()
                        .replace(/sq/g, '')
                        .replace(/\s+/g, '')
                        .replace(/\([^)]*\)/g, '')  // æ‹¬å¼§å†…ã‚’å‰Šé™¤
                        .replace(/[ã€€\s]/g, '')     // å…¨è§’ã‚¹ãƒšãƒ¼ã‚¹ã‚‚å‰Šé™¤
                        .replace(/[-.]/g, '');      // ãƒã‚¤ãƒ•ãƒ³ã€ãƒ‰ãƒƒãƒˆå‰Šé™¤
                };
                
                for (const searchKey of searchKeys) {
                    const normalizedSearchKey = normalizeSpec(searchKey);
                    
                    for (const [appKey, appValue] of applicationDataMap) {
                        const normalizedAppKey = normalizeSpec(appKey);
                        if (normalizedSearchKey === normalizedAppKey) {
                            console.log(`ğŸ¯ æ­£è¦åŒ–ãƒãƒƒãƒãƒ³ã‚°æˆåŠŸ: "${searchKey}" â‰ˆ "${appKey}"`);
                            return appValue;
                        }
                    }
                }
                
                // éƒ¨åˆ†ãƒãƒƒãƒãƒ³ã‚°ï¼ˆå‹ç•ªã¨ç‰©å“åã®ã¿ï¼‰
                const primaryKeys = [basicInfo['å‹ç•ª'], basicInfo['ä»•æ§˜']].filter(key => 
                    key && key !== 'æœªæŒ‡å®š' && !key.includes('æ¡ˆä»¶') && !key.includes('TYPE-') && !key.includes('ç‰©å“')
                );
                
                for (const searchKey of primaryKeys) {
                    for (const [appKey, appValue] of applicationDataMap) {
                        if (searchKey.includes(appKey) || appKey.includes(searchKey)) {
                            console.log(`ğŸ¯ éƒ¨åˆ†ãƒãƒƒãƒãƒ³ã‚°æˆåŠŸ: "${searchKey}" âˆ‹âˆˆ "${appKey}"`);
                            return appValue;
                        }
                    }
                }
                
                console.log(`âŒ ãƒãƒƒãƒãƒ³ã‚°å¤±æ•—: æ¤œç´¢ã‚­ãƒ¼[${searchKeys.join(', ')}]`);
                return null;
            }
        }
        
        // ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã‚¤ãƒ™ãƒ³ãƒˆãƒãƒ³ãƒ‰ãƒ©ãƒ¼ã‚¯ãƒ©ã‚¹
        class ProjectEventHandler {
            constructor(projectElement, validator) {
                this.projectElement = projectElement;
                this.validator = validator;
                this.debounceTimer = null;
                this.validationCache = new Map();
                this.isRealTimeEnabled = true;
            }
            
            setup() {
                this.setupPriceFormatting();
                this.setupCalculationUpdates();
                this.setupTaxIncludedToggle();
                this.setupCheckboxToggles();
                this.setupRealTimeValidation();
                this.setupVisualFeedback();
                this.setupBasicInfoEditing();
            }
            
            setupBasicInfoEditing() {
                const editBtn = this.projectElement.querySelector('.edit-basic-info-btn');
                const saveBtn = this.projectElement.querySelector('.save-basic-info-btn');
                const cancelBtn = this.projectElement.querySelector('.cancel-basic-info-btn');
                const resetBtn = this.projectElement.querySelector('.reset-basic-info-btn');
                
                const displaySection = this.projectElement.querySelector('.basic-info-display');
                const editSection = this.projectElement.querySelector('.basic-info-edit');
                
                // å…ƒã®ãƒ‡ãƒ¼ã‚¿ã‚’ä¿å­˜
                let originalData = this.getCurrentBasicInfo();
                
                editBtn?.addEventListener('click', () => {
                    originalData = this.getCurrentBasicInfo(); // ç·¨é›†é–‹å§‹æ™‚ã®çŠ¶æ…‹ã‚’ä¿å­˜
                    this.showEditMode(displaySection, editSection, editBtn);
                });
                
                saveBtn?.addEventListener('click', () => {
                    if (this.saveBasicInfo()) {
                        this.showDisplayMode(displaySection, editSection, editBtn);
                        this.triggerRealTimeValidation(true); // ä¿å­˜å¾Œã«æ¤œè¨¼å®Ÿè¡Œ
                        this.updateProjectTitle(); // ã‚¿ã‚¤ãƒˆãƒ«æ›´æ–°
                        this.showNotification('åŸºæœ¬æƒ…å ±ã‚’ä¿å­˜ã—ã¾ã—ãŸ', 'success');
                    }
                });
                
                cancelBtn?.addEventListener('click', () => {
                    this.restoreBasicInfo(originalData);
                    this.showDisplayMode(displaySection, editSection, editBtn);
                });
                
                resetBtn?.addEventListener('click', () => {
                    if (confirm('å…ƒã®ãƒ‡ãƒ¼ã‚¿ã«æˆ»ã—ã¾ã™ã‹ï¼Ÿç·¨é›†å†…å®¹ã¯å¤±ã‚ã‚Œã¾ã™ã€‚')) {
                        this.resetToOriginalData();
                        this.showDisplayMode(displaySection, editSection, editBtn);
                        this.triggerRealTimeValidation(true);
                        this.updateProjectTitle();
                        this.showNotification('å…ƒã®ãƒ‡ãƒ¼ã‚¿ã«æˆ»ã—ã¾ã—ãŸ', 'info');
                    }
                });
                
                // åŸºæœ¬æƒ…å ±ã®å…¥åŠ›ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã‚‚ç›£è¦–å¯¾è±¡ã«è¿½åŠ 
                const basicInfoInputs = this.projectElement.querySelectorAll('.basic-info-input');
                basicInfoInputs.forEach(input => {
                    input.addEventListener('input', () => {
                        this.validateBasicInfoInput(input);
                        this.updateDataQualityIndicator();
                    });
                    
                    input.addEventListener('blur', () => {
                        this.formatBasicInfoInput(input);
                    });
                });
            }
            
            getCurrentBasicInfo() {
                const projectIndex = parseInt(this.projectElement.dataset.projectIndex);
                return window.DataFormatterApp?.projects?.[projectIndex]?.basicInfo || {};
            }
            
            showEditMode(displaySection, editSection, editBtn) {
                displaySection.style.display = 'none';
                editSection.style.display = 'block';
                editBtn.textContent = 'ğŸ“ ç·¨é›†ä¸­';
                editBtn.disabled = true;
                editBtn.classList.add('opacity-50', 'cursor-not-allowed');
                
                // ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆå…¨ä½“ã«ç·¨é›†ä¸­ã®è¦–è¦šçš„ãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯
                this.projectElement.classList.add('ring-2', 'ring-blue-300', 'bg-blue-50');
            }
            
            showDisplayMode(displaySection, editSection, editBtn) {
                displaySection.style.display = 'block';
                editSection.style.display = 'none';
                editBtn.textContent = 'âœï¸ ç·¨é›†';
                editBtn.disabled = false;
                editBtn.classList.remove('opacity-50', 'cursor-not-allowed');
                
                // ç·¨é›†ä¸­ã®è¦–è¦šçš„ãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯ã‚’å‰Šé™¤
                this.projectElement.classList.remove('ring-2', 'ring-blue-300', 'bg-blue-50');
                
                // è¡¨ç¤ºéƒ¨åˆ†ã‚’æ›´æ–°
                this.updateDisplaySection();
            }
            
            saveBasicInfo() {
                const inputs = this.projectElement.querySelectorAll('.basic-info-input');
                const newData = {};
                let hasErrors = false;
                
                inputs.forEach(input => {
                    const field = input.dataset.field;
                    let value = input.value.trim();
                    
                    // å¿…é ˆãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã®æ¤œè¨¼
                    if (input.required && !value) {
                        this.showInputError(input, 'å¿…é ˆé …ç›®ã§ã™');
                        hasErrors = true;
                        return;
                    }
                    
                    // å€¤ã®ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆ
                    value = this.formatInputValue(field, value);
                    newData[field] = value;
                    
                    // ã‚¨ãƒ©ãƒ¼è¡¨ç¤ºã‚’ã‚¯ãƒªã‚¢
                    this.clearInputError(input);
                });
                
                if (hasErrors) {
                    this.showNotification('å…¥åŠ›å†…å®¹ã«ä¸å‚™ãŒã‚ã‚Šã¾ã™', 'error');
                    return false;
                }
                
                // ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆãƒ‡ãƒ¼ã‚¿ã‚’æ›´æ–°
                const projectIndex = parseInt(this.projectElement.dataset.projectIndex);
                if (window.DataFormatterApp?.projects?.[projectIndex]) {
                    Object.assign(window.DataFormatterApp.projects[projectIndex].basicInfo, newData);
                }
                
                return true;
            }
            
            restoreBasicInfo(originalData) {
                const inputs = this.projectElement.querySelectorAll('.basic-info-input');
                inputs.forEach(input => {
                    const field = input.dataset.field;
                    const value = originalData[field] || '';
                    const cleanValue = value.replace(/Â¥|å††|å€‹\/å¹´|å€‹/g, '');
                    input.value = cleanValue;
                    this.clearInputError(input);
                });
            }
            
            resetToOriginalData() {
                const projectIndex = parseInt(this.projectElement.dataset.projectIndex);
                const app = window.DataFormatterApp;
                
                if (app?.projects?.[projectIndex]) {
                    // å…ƒã®è§£æãƒ‡ãƒ¼ã‚¿ã«æˆ»ã™ï¼ˆdataParserã§å†è§£æï¼‰
                    const originalProject = app.projects[projectIndex];
                    const fallbackData = app.dataParser.applyDataFallbacks({}, projectIndex + 1);
                    
                    // å…ƒã®ãƒ‡ãƒ¼ã‚¿ã‚’å¾©å…ƒ
                    Object.assign(originalProject.basicInfo, fallbackData);
                    
                    // å…¥åŠ›ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã‚’æ›´æ–°
                    const inputs = this.projectElement.querySelectorAll('.basic-info-input');
                    inputs.forEach(input => {
                        const field = input.dataset.field;
                        const value = fallbackData[field] || '';
                        const cleanValue = value.replace(/Â¥|å††|å€‹\/å¹´|å€‹/g, '');
                        input.value = cleanValue;
                        this.clearInputError(input);
                    });
                }
            }
            
            formatInputValue(field, value) {
                if (!value) return value;
                
                switch (field) {
                    case 'å‰å›ã®æ³¨æ–‡å˜ä¾¡':
                    case 'å‰å›æ³¨æ–‡åŠ å·¥è²»':
                        // æ•°å€¤ã®ã¿æŠ½å‡ºã—ã¦Â¥ã‚’ä»˜åŠ 
                        const numValue = value.replace(/[^\d.]/g, '');
                        return numValue ? `Â¥${numValue}` : value;
                        
                    case 'å¹´é–“ä½¿ç”¨æ•°':
                    case 'åœ¨åº«æ•°':
                        // æ•°å€¤ã®ã¿æŠ½å‡º
                        return value.replace(/[^\d]/g, '') || '0';
                        
                    default:
                        return value;
                }
            }
            
            validateBasicInfoInput(input) {
                const field = input.dataset.field;
                const value = input.value.trim();
                
                // å¿…é ˆãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã®æ¤œè¨¼
                if (input.required && !value) {
                    this.showInputError(input, 'å¿…é ˆé …ç›®ã§ã™');
                    return false;
                }
                
                // æ•°å€¤ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã®æ¤œè¨¼
                if ((field === 'å¹´é–“ä½¿ç”¨æ•°' || field === 'åœ¨åº«æ•°') && value) {
                    if (!/^\d+$/.test(value)) {
                        this.showInputError(input, 'æ•°å€¤ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„');
                        return false;
                    }
                    if (parseInt(value) < 0) {
                        this.showInputError(input, '0ä»¥ä¸Šã®å€¤ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„');
                        return false;
                    }
                }
                
                // ä¾¡æ ¼ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã®æ¤œè¨¼
                if ((field === 'å‰å›ã®æ³¨æ–‡å˜ä¾¡' || field === 'å‰å›æ³¨æ–‡åŠ å·¥è²»') && value) {
                    const numValue = value.replace(/[^\d.]/g, '');
                    if (numValue && (isNaN(parseFloat(numValue)) || parseFloat(numValue) < 0)) {
                        this.showInputError(input, 'æ­£ã—ã„é‡‘é¡ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„');
                        return false;
                    }
                }
                
                this.clearInputError(input);
                return true;
            }
            
            formatBasicInfoInput(input) {
                const field = input.dataset.field;
                input.value = this.formatInputValue(field, input.value);
            }
            
            showInputError(input, message) {
                input.classList.add('border-red-500', 'bg-red-50');
                
                // æ—¢å­˜ã®ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’å‰Šé™¤
                const existingError = input.parentElement.querySelector('.input-error');
                if (existingError) {
                    existingError.remove();
                }
                
                // ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’è¿½åŠ 
                const errorDiv = document.createElement('div');
                errorDiv.className = 'input-error text-xs text-red-600 mt-1';
                errorDiv.textContent = message;
                input.parentElement.appendChild(errorDiv);
            }
            
            clearInputError(input) {
                input.classList.remove('border-red-500', 'bg-red-50');
                const errorDiv = input.parentElement.querySelector('.input-error');
                if (errorDiv) {
                    errorDiv.remove();
                }
            }
            
            updateDisplaySection() {
                const projectIndex = parseInt(this.projectElement.dataset.projectIndex);
                const projectData = window.DataFormatterApp?.projects?.[projectIndex];
                
                if (!projectData) return;
                
                // è¡¨ç¤ºã‚»ã‚¯ã‚·ãƒ§ãƒ³ã®HTMLã‚’å†ç”Ÿæˆ
                const basicInfoSection = this.projectElement.querySelector('.basic-info-display');
                if (basicInfoSection && window.DataFormatterApp?.uiGenerator) {
                    const newDisplayHTML = window.DataFormatterApp.uiGenerator.generateBasicInfoDisplayContent(projectData.basicInfo);
                    basicInfoSection.innerHTML = newDisplayHTML;
                }
            }
            
            updateProjectTitle() {
                const projectIndex = parseInt(this.projectElement.dataset.projectIndex);
                const projectData = window.DataFormatterApp?.projects?.[projectIndex];
                
                if (!projectData || !window.DataFormatterApp?.uiGenerator) return;
                
                const titleInfo = window.DataFormatterApp.uiGenerator.generateProjectTitle(projectData.basicInfo, projectIndex);
                const titleElement = this.projectElement.querySelector('h4');
                const subTitleElement = this.projectElement.querySelector('p');
                
                if (titleElement) {
                    titleElement.textContent = `${projectIndex + 1}. ${titleInfo.main}`;
                }
                
                if (subTitleElement && titleInfo.sub) {
                    subTitleElement.textContent = titleInfo.sub;
                } else if (subTitleElement) {
                    subTitleElement.textContent = '';
                }
            }
            
            updateDataQualityIndicator() {
                const projectIndex = parseInt(this.projectElement.dataset.projectIndex);
                const projectData = window.DataFormatterApp?.projects?.[projectIndex];
                
                if (!projectData || !window.DataFormatterApp?.uiGenerator) return;
                
                const qualityIndicator = this.projectElement.querySelector('.mt-3.pt-2.border-t');
                if (qualityIndicator) {
                    const newIndicatorHTML = window.DataFormatterApp.uiGenerator.generateDataQualityIndicator(projectData.basicInfo);
                    qualityIndicator.innerHTML = newIndicatorHTML;
                }
            }
            
            showNotification(message, type = 'info') {
                if (window.DataFormatterApp?.notificationManager) {
                    if (type === 'success') {
                        window.DataFormatterApp.notificationManager.showSuccess(message);
                    } else if (type === 'error') {
                        window.DataFormatterApp.notificationManager.showError(message);
                    } else {
                        window.DataFormatterApp.notificationManager.showSuccess(message);
                    }
                }
            }
            
            setupPriceFormatting() {
                const priceInputs = this.projectElement.querySelectorAll('.application-price, .total-amount');
                priceInputs.forEach(input => {
                    input.addEventListener('input', (e) => {
                        e.target.value = this.formatPrice(e.target.value);
                        this.updateCalculationDisplay();
                        this.triggerRealTimeValidation();
                    });
                    
                    input.addEventListener('blur', (e) => {
                        this.triggerRealTimeValidation(true); // å¼·åˆ¶å®Ÿè¡Œ
                    });
                });
            }
            
            setupCalculationUpdates() {
                const quantityInput = this.projectElement.querySelector('.order-quantity');
                quantityInput?.addEventListener('input', () => {
                    this.updateCalculationDisplay();
                    this.triggerRealTimeValidation();
                });
                
                quantityInput?.addEventListener('blur', () => {
                    this.triggerRealTimeValidation(true);
                });
            }
            
            setupTaxIncludedToggle() {
                const taxIncludedCheckbox = this.projectElement.querySelector('.tax-included');
                taxIncludedCheckbox?.addEventListener('change', () => {
                    this.updateCalculationDisplay();
                    this.triggerRealTimeValidation(true);
                    
                    // ç¨è¾¼ãƒã‚§ãƒƒã‚¯æ™‚ã®ãƒ“ã‚¸ãƒ¥ã‚¢ãƒ«ãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯
                    const priceSection = this.projectElement.querySelector('.bg-green-50');
                    if (taxIncludedCheckbox.checked) {
                        priceSection?.classList.add('ring-2', 'ring-green-300');
                    } else {
                        priceSection?.classList.remove('ring-2', 'ring-green-300');
                    }
                });
            }
            
            setupRealTimeValidation() {
                // å…¨ã¦ã®å…¥åŠ›ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã‚’ç›£è¦–
                const watchedInputs = this.projectElement.querySelectorAll(
                    '.order-quantity, .application-price, .total-amount, .zaico-model, .supplier-model, .zaico-drawing-no, .supplier-drawing-no, .zaico-subject, .supplier-subject'
                );

                watchedInputs.forEach(input => {
                    input.addEventListener('input', () => {
                        this.addInputValidationStyle(input);
                        this.triggerRealTimeValidation();

                        // ZAICOç§‘ç›®ãŒã€Œä»•æ›å“ã€ã«å¤‰æ›´ã•ã‚ŒãŸå ´åˆã€åŠ å·¥è²»æ¯”è¼ƒã‚’è‡ªå‹•ãƒã‚§ãƒƒã‚¯
                        if (input.classList.contains('zaico-subject')) {
                            this.handleSubjectChange(input.value);
                        }
                    });

                    input.addEventListener('focus', () => {
                        this.addFocusStyle(input);
                    });

                    input.addEventListener('blur', () => {
                        this.removeFocusStyle(input);
                        this.triggerRealTimeValidation(true);
                    });
                });

                // ãƒã‚§ãƒƒã‚¯ãƒœãƒƒã‚¯ã‚¹ã‚‚ç›£è¦–
                const checkboxes = this.projectElement.querySelectorAll(
                    '.best-price, .special-reason, .special-adoption, .model-exception, .no-drawing-number, .drawing-exception, .processing-fee-comparison, .processing-fee-increase'
                );

                checkboxes.forEach(checkbox => {
                    checkbox.addEventListener('change', () => {
                        this.triggerRealTimeValidation(true);
                    });
                });

                // ãƒ†ã‚­ã‚¹ãƒˆã‚¨ãƒªã‚¢ã‚‚ç›£è¦–
                const textareas = this.projectElement.querySelectorAll('textarea');
                textareas.forEach(textarea => {
                    textarea.addEventListener('input', () => {
                        this.triggerRealTimeValidation();
                    });
                });
            }
            
            setupVisualFeedback() {
                // ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ æ¤œè¨¼çµæœè¡¨ç¤ºã‚¨ãƒªã‚¢ã‚’ä½œæˆ
                const existingResult = this.projectElement.querySelector('.validation-result');
                if (existingResult) {
                    const realtimeIndicator = document.createElement('div');
                    realtimeIndicator.className = 'realtime-validation mt-3 p-2 rounded text-sm';
                    realtimeIndicator.style.display = 'none';
                    existingResult.parentNode.insertBefore(realtimeIndicator, existingResult);
                }
            }
            
            triggerRealTimeValidation(forceValidation = false) {
                if (!this.isRealTimeEnabled && !forceValidation) return;
                
                // ãƒ‡ãƒã‚¦ãƒ³ã‚¹å‡¦ç†ï¼ˆ500msï¼‰
                clearTimeout(this.debounceTimer);
                this.debounceTimer = setTimeout(() => {
                    this.performRealTimeValidation();
                }, forceValidation ? 0 : 500);
            }
            
            performRealTimeValidation() {
                try {
                    const projectIndex = parseInt(this.projectElement.dataset.projectIndex);
                    const projectData = window.DataFormatterApp?.projects?.[projectIndex];
                    
                    if (!projectData) return;
                    
                    // ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã‚­ãƒ¼ã®ç”Ÿæˆ
                    const cacheKey = this.generateCacheKey();
                    
                    // ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã‹ã‚‰çµæœã‚’å–å¾—
                    if (this.validationCache.has(cacheKey)) {
                        const cachedResult = this.validationCache.get(cacheKey);
                        this.displayRealTimeResult(cachedResult, projectData);
                        return;
                    }
                    
                    // æ¤œè¨¼å®Ÿè¡Œ
                    const result = this.validator.validateProject(this.projectElement, projectData);
                    
                    // çµæœã‚’ã‚­ãƒ£ãƒƒã‚·ãƒ¥
                    this.validationCache.set(cacheKey, result);
                    
                    // ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ çµæœè¡¨ç¤º
                    this.displayRealTimeResult(result, projectData);
                    
                    // å…¥åŠ›ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã®çŠ¶æ…‹æ›´æ–°
                    this.updateInputStates(result);
                    
                } catch (error) {
                    console.warn('ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ æ¤œè¨¼ã‚¨ãƒ©ãƒ¼:', error);
                }
            }
            
            generateCacheKey() {
                const inputs = this.projectElement.querySelectorAll('input, textarea, select');
                const values = Array.from(inputs).map(input => {
                    if (input.type === 'checkbox') {
                        return input.checked ? '1' : '0';
                    }
                    return input.value || '';
                });
                return values.join('|');
            }
            
            displayRealTimeResult(result, projectData) {
                const realtimeIndicator = this.projectElement.querySelector('.realtime-validation');
                if (!realtimeIndicator) return;
                
                const completionRate = this.calculateCompletionRate(result);
                const statusColor = result.overallCheck ? 'green' : 
                                  completionRate >= 70 ? 'yellow' : 'red';
                
                realtimeIndicator.innerHTML = `
                    <div class="flex items-center justify-between">
                        <div class="flex items-center">
                            <span class="mr-2">${result.overallCheck ? 'âœ…' : 'âš ï¸'}</span>
                            <span class="font-medium text-${statusColor}-700">
                                ${result.overallCheck ? 'ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ æ¤œè¨¼: å…¨é …ç›®OK' : `ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ æ¤œè¨¼: ${completionRate}% å®Œäº†`}
                            </span>
                        </div>
                        <div class="text-xs text-gray-500">
                            ${this.getTimeStamp()}
                        </div>
                    </div>
                    
                    <div class="mt-2 grid grid-cols-2 md:grid-cols-3 lg:grid-cols-6 gap-1 text-xs">
                        ${this.generateQuickStatusBadges(result)}
                    </div>
                    
                    ${this.generateRealTimeHints(result, projectData)}
                `;
                
                realtimeIndicator.className = `realtime-validation mt-3 p-2 rounded text-sm bg-${statusColor}-50 border border-${statusColor}-200`;
                realtimeIndicator.style.display = 'block';
            }
            
            calculateCompletionRate(result) {
                const checks = [result.orderCheck, result.priceCheck, result.modelCheck, result.drawingCheck, result.processingFeeCheck, result.unitPriceMatch];
                const passedChecks = checks.filter(check => check).length;
                return Math.round((passedChecks / checks.length) * 100);
            }
            
            generateQuickStatusBadges(result) {
                const badges = [
                    { key: 'orderCheck', label: 'æ³¨æ–‡æ•°', value: result.orderCheck },
                    { key: 'priceCheck', label: 'ä¾¡æ ¼', value: result.priceCheck },
                    { key: 'modelCheck', label: 'å‹ç•ª', value: result.modelCheck },
                    { key: 'drawingCheck', label: 'å›³ç•ª', value: result.drawingCheck },
                    { key: 'processingFeeCheck', label: 'åŠ å·¥è²»', value: result.processingFeeCheck },
                    { key: 'unitPriceMatch', label: 'å˜ä¾¡', value: result.unitPriceMatch }
                ];
                
                return badges.map(badge => {
                    const bgColor = badge.value ? 'bg-green-100 text-green-700' : 'bg-red-100 text-red-700';
                    const icon = badge.value ? 'âœ“' : 'âœ—';
                    return `<span class="px-2 py-1 rounded ${bgColor}">${icon} ${badge.label}</span>`;
                }).join('');
            }
            
            generateRealTimeHints(result, projectData) {
                const hints = [];
                
                if (!result.orderCheck) {
                    const annualUsage = parseInt(projectData.basicInfo['å¹´é–“ä½¿ç”¨æ•°']) || 0;
                    if (annualUsage > 0) {
                        const suggestedMin = Math.ceil(annualUsage / 2);
                        const suggestedMax = annualUsage;
                        hints.push(`ğŸ’¡ æ¨å¥¨æ³¨æ–‡æ•°: ${suggestedMin}ã€œ${suggestedMax}å€‹`);
                    }
                }
                
                if (!result.priceCheck && result.calculatedPrice) {
                    const previousPriceStr = projectData.basicInfo['å‰å›ã®æ³¨æ–‡å˜ä¾¡'] || 'Â¥0';
                    const previousPrice = parseFloat(previousPriceStr.replace(/[Â¥,\s]/g, ''));
                    if (parseFloat(result.calculatedPrice) > previousPrice) {
                        hints.push(`ğŸ’° å‰å›æ³¨æ–‡å˜ä¾¡ã‚ˆã‚Šé«˜é¡ã§ã™ã€‚ç›¸è¦‹ç©ã‚‚ã‚Šã¾ãŸã¯ç‰¹åˆ¥æ¡ç”¨ã®ç†ç”±ãŒå¿…è¦`);
                    }
                }
                
                if (!result.modelCheck) {
                    hints.push(`ğŸ”¢ ZAICOå‹ç•ªã¨è³¼è²·å…ˆå‹ç•ªã‚’å…¥åŠ›ã™ã‚‹ã‹ã€å‹ç•ªä¸ä¸€è‡´ã®ç†ç”±ã‚’è¨˜è¼‰ã—ã¦ãã ã•ã„`);
                }
                
                if (!result.drawingCheck) {
                    hints.push(`ğŸ“ ZAICOå›³ç•ªã¨è³¼è²·å…ˆå›³ç•ªã‚’å…¥åŠ›ã™ã‚‹ã‹ã€å›³ç•ªãªã—ãƒ»å›³ç•ªä¸ä¸€è‡´ã®ç†ç”±ã‚’è¨˜è¼‰ã—ã¦ãã ã•ã„`);
                }
                
                if (!result.processingFeeCheck && result.hasProcessingFeeComparison) {
                    const previousProcessingFeeStr = projectData.basicInfo['å‰å›æ³¨æ–‡åŠ å·¥è²»'] || 'Â¥0';
                    const previousProcessingFee = parseFloat(previousProcessingFeeStr.replace(/[Â¥,\s]/g, ''));
                    const currentProcessingFee = parseFloat((result.currentProcessingFee || '0').replace(/[Â¥,\s]/g, ''));
                    
                    if (!result.currentProcessingFee) {
                        hints.push(`ğŸ”§ ä»Šå›ã®åŠ å·¥è²»ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„`);
                    } else if (currentProcessingFee > previousProcessingFee) {
                        hints.push(`ğŸ”§ å‰å›åŠ å·¥è²»ã‚ˆã‚Šé«˜é¡ã§ã™ã€‚åŠ å·¥è²»ä¸Šæ˜‡ã®ç†ç”±ã‚’è¨˜è¼‰ã—ã¦ãã ã•ã„`);
                    }
                }
                
                if (!result.unitPriceMatch && result.calculatedPrice && result.applicationPrice) {
                    hints.push(`ğŸ“Š ç”³è«‹å˜ä¾¡ã¨è¨ˆç®—å˜ä¾¡ãŒä¸€è‡´ã—ã¾ã›ã‚“ã€‚ç·é¡ã¾ãŸã¯æ³¨æ–‡æ•°ã‚’ç¢ºèªã—ã¦ãã ã•ã„`);
                }
                
                return hints.length > 0 ? `
                    <div class="mt-2 pt-2 border-t border-gray-200">
                        <div class="text-xs text-gray-600">
                            ${hints.slice(0, 2).map(hint => `<div class="mb-1">${hint}</div>`).join('')}
                        </div>
                    </div>
                ` : '';
            }
            
            updateInputStates(result) {
                // æ³¨æ–‡æ•°ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã®çŠ¶æ…‹æ›´æ–°
                const orderQuantityInput = this.projectElement.querySelector('.order-quantity');
                this.updateInputValidationState(orderQuantityInput, result.orderCheck);

                // ç”³è«‹å˜ä¾¡ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã®çŠ¶æ…‹æ›´æ–°
                const applicationPriceInput = this.projectElement.querySelector('.application-price');
                this.updateInputValidationState(applicationPriceInput, result.unitPriceMatch);

                // å•†å“ç·é¡ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã®çŠ¶æ…‹æ›´æ–°
                const totalAmountInput = this.projectElement.querySelector('.total-amount');
                this.updateInputValidationState(totalAmountInput, result.unitPriceMatch);

                // å‹ç•ªãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã®çŠ¶æ…‹æ›´æ–°
                const zaicoModelInput = this.projectElement.querySelector('.zaico-model');
                const supplierModelInput = this.projectElement.querySelector('.supplier-model');
                this.updateInputValidationState(zaicoModelInput, result.modelCheck);
                this.updateInputValidationState(supplierModelInput, result.modelCheck);

                // ç§‘ç›®ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã®çŠ¶æ…‹æ›´æ–°
                const zaicoSubjectInput = this.projectElement.querySelector('.zaico-subject');
                const supplierSubjectInput = this.projectElement.querySelector('.supplier-subject');
                this.updateInputValidationState(zaicoSubjectInput, result.subjectCheck);
                this.updateInputValidationState(supplierSubjectInput, result.subjectCheck);
            }
            
            updateInputValidationState(input, isValid) {
                if (!input) return;
                
                // æ—¢å­˜ã®ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ã‚¯ãƒ©ã‚¹ã‚’å‰Šé™¤
                input.classList.remove('border-green-500', 'border-red-500', 'border-yellow-500');
                
                // å€¤ãŒå…¥åŠ›ã•ã‚Œã¦ã„ã‚‹å ´åˆã®ã¿è‰²ä»˜ã‘
                if (input.value.trim() !== '') {
                    if (isValid) {
                        input.classList.add('border-green-500');
                    } else {
                        input.classList.add('border-red-500');
                    }
                }
            }
            
            addInputValidationStyle(input) {
                input.classList.add('border-blue-500');
                setTimeout(() => {
                    input.classList.remove('border-blue-500');
                }, 300);
            }
            
            addFocusStyle(input) {
                input.parentElement?.classList.add('ring-2', 'ring-blue-500');
            }
            
            removeFocusStyle(input) {
                input.parentElement?.classList.remove('ring-2', 'ring-blue-500');
            }
            
            getTimeStamp() {
                return new Date().toLocaleTimeString('ja-JP', { 
                    hour: '2-digit', 
                    minute: '2-digit', 
                    second: '2-digit' 
                });
            }
            
            toggleRealTimeValidation(enabled) {
                this.isRealTimeEnabled = enabled;
                const realtimeIndicator = this.projectElement.querySelector('.realtime-validation');
                if (!enabled && realtimeIndicator) {
                    realtimeIndicator.style.display = 'none';
                }
            }
            
            clearValidationCache() {
                this.validationCache.clear();
            }

            handleSubjectChange(subjectValue) {
                const processingFeeCheckbox = this.projectElement.querySelector('.processing-fee-comparison');
                const processingFeeSection = this.projectElement.querySelector('.processing-fee-section');

                if (!processingFeeCheckbox || !processingFeeSection) return;

                // ç§‘ç›®ãŒã€Œä»•æ›å“ã€ã®å ´åˆã€åŠ å·¥è²»æ¯”è¼ƒã‚’è‡ªå‹•ãƒã‚§ãƒƒã‚¯
                if (subjectValue.trim() === 'ä»•æ›å“') {
                    processingFeeCheckbox.checked = true;
                    processingFeeSection.style.display = 'block';

                    // å‰å›åŠ å·¥è²»ã‚’è¡¨ç¤º
                    const projectIndex = parseInt(this.projectElement.dataset.projectIndex);
                    const projectData = window.DataFormatterApp?.projects?.[projectIndex];

                    if (projectData) {
                        const previousFeeDisplay = processingFeeSection.querySelector('.processing-fee-previous');
                        const applicationPriceDisplay = processingFeeSection.querySelector('.application-price-display');

                        if (previousFeeDisplay) {
                            const previousFee = projectData.basicInfo['å‰å›æ³¨æ–‡åŠ å·¥è²»'] || 'Â¥0';
                            previousFeeDisplay.textContent = previousFee;
                            previousFeeDisplay.className = previousFeeDisplay.className.replace('text-gray-600', 'text-green-700 font-medium');
                        }

                        if (applicationPriceDisplay) {
                            const applicationPriceInput = this.projectElement.querySelector('.application-price');
                            const currentPrice = applicationPriceInput?.value || 'æœªå…¥åŠ›';
                            applicationPriceDisplay.textContent = currentPrice === 'æœªå…¥åŠ›' ? 'ç”³è«‹å˜ä¾¡ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„' : currentPrice;
                        }
                    }
                }
            }

            setupCheckboxToggles() {
                const checkboxConfigs = [
                    {
                        checkbox: '.special-reason',
                        textArea: '.special-reason-text',
                        description: 'æ³¨æ–‡æ•°ã®ç‰¹åˆ¥ç†ç”±'
                    },
                    {
                        checkbox: '.special-adoption',
                        textArea: '.special-adoption-text',
                        description: 'ä¾¡æ ¼ä¸Šæ˜‡ã®ç‰¹åˆ¥äº‹æƒ…'
                    },
                    {
                        checkbox: '.model-exception',
                        textArea: '.model-exception-text',
                        description: 'å‹ç•ªä¸ä¸€è‡´ã®ç‰¹åˆ¥äº‹æƒ…'
                    },
                    {
                        checkbox: '.drawing-exception',
                        textArea: '.drawing-exception-text',
                        description: 'å›³ç•ªä¸ä¸€è‡´ã®ç‰¹åˆ¥äº‹æƒ…'
                    },
                    {
                        checkbox: '.subject-exception',
                        textArea: '.subject-exception-text',
                        description: 'ç§‘ç›®ä¸ä¸€è‡´ã®ç‰¹åˆ¥äº‹æƒ…'
                    },
                    {
                        checkbox: '.processing-fee-increase',
                        textArea: '.processing-fee-increase-text',
                        description: 'åŠ å·¥è²»ä¸Šæ˜‡ã®ç‰¹åˆ¥äº‹æƒ…'
                    }
                ];
                
                checkboxConfigs.forEach(({ checkbox, textArea, description }) => {
                    const checkboxElement = this.projectElement.querySelector(checkbox);
                    const textAreaElement = this.projectElement.querySelector(textArea);
                    
                    checkboxElement?.addEventListener('change', function() {
                        if (textAreaElement) {
                            textAreaElement.style.display = this.checked ? 'block' : 'none';
                            
                            // ãƒã‚§ãƒƒã‚¯æ™‚ã«ãƒ†ã‚­ã‚¹ãƒˆã‚¨ãƒªã‚¢ã«ãƒ•ã‚©ãƒ¼ã‚«ã‚¹
                            if (this.checked) {
                                const textarea = textAreaElement.querySelector('textarea');
                                setTimeout(() => textarea?.focus(), 100);
                            }
                        }
                    });
                });
                
                // å›³ç•ªãªã—ãƒã‚§ãƒƒã‚¯ãƒœãƒƒã‚¯ã‚¹ã®ç‰¹åˆ¥å‡¦ç†
                const noDrawingCheckbox = this.projectElement.querySelector('.no-drawing-number');
                const drawingInputs = this.projectElement.querySelectorAll('.zaico-drawing-no, .supplier-drawing-no');
                
                noDrawingCheckbox?.addEventListener('change', function() {
                    drawingInputs.forEach(input => {
                        if (this.checked) {
                            input.disabled = true;
                            input.style.backgroundColor = '#f3f4f6';
                            input.value = '';
                        } else {
                            input.disabled = false;
                            input.style.backgroundColor = '';
                        }
                    });
                });
                
                // åŠ å·¥è²»æ¯”è¼ƒãƒã‚§ãƒƒã‚¯ãƒœãƒƒã‚¯ã‚¹ã®ç‰¹åˆ¥å‡¦ç†
                const processingFeeComparisonCheckbox = this.projectElement.querySelector('.processing-fee-comparison');
                const processingFeeSection = this.projectElement.querySelector('.processing-fee-section');
                
                processingFeeComparisonCheckbox?.addEventListener('change', function() {
                    if (processingFeeSection) {
                        processingFeeSection.style.display = this.checked ? 'block' : 'none';

                        // ãƒã‚§ãƒƒã‚¯æ™‚ã«å‰å›åŠ å·¥è²»ã‚’è¡¨ç¤ºã—ã€å…¥åŠ›ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã«ãƒ•ã‚©ãƒ¼ã‚«ã‚¹
                        if (this.checked) {
                            // å‰å›åŠ å·¥è²»ã‚’å–å¾—ã—ã¦è¡¨ç¤º
                            const projectElement = this.closest('[data-project-index]');
                            const projectIndex = parseInt(projectElement.dataset.projectIndex);
                            const projectData = window.DataFormatterApp?.projects?.[projectIndex];

                            const previousFeeDisplay = processingFeeSection.querySelector('.processing-fee-previous');
                            const applicationPriceDisplay = processingFeeSection.querySelector('.application-price-display');

                            if (previousFeeDisplay && projectData) {
                                const previousFee = projectData.basicInfo['å‰å›æ³¨æ–‡åŠ å·¥è²»'] || 'Â¥0';
                                previousFeeDisplay.textContent = previousFee;
                                previousFeeDisplay.className = previousFeeDisplay.className.replace('text-gray-600', 'text-green-700 font-medium');
                            }

                            if (applicationPriceDisplay) {
                                const applicationPriceInput = this.closest('[data-project-index]').querySelector('.application-price');
                                const currentPrice = applicationPriceInput?.value || 'æœªå…¥åŠ›';
                                applicationPriceDisplay.textContent = currentPrice === 'æœªå…¥åŠ›' ? 'ç”³è«‹å˜ä¾¡ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„' : currentPrice;
                            }

                            // ç”³è«‹å˜ä¾¡ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã«ãƒ•ã‚©ãƒ¼ã‚«ã‚¹ï¼ˆå‚è€ƒç”¨ï¼‰
                            const applicationPriceInput = this.closest('[data-project-index]').querySelector('.application-price');
                            if (applicationPriceInput && !applicationPriceInput.value) {
                                setTimeout(() => applicationPriceInput?.focus(), 100);
                            }
                        }
                    }
                });
            }
            
            formatPrice(value) {
                value = value.replace(/[^\d.]/g, '');
                return value ? `Â¥${value}` : value;
            }
            
            updateCalculationDisplay() {
                const totalAmount = this.projectElement.querySelector('.total-amount')?.value;
                const orderQuantity = parseInt(this.projectElement.querySelector('.order-quantity')?.value);
                const taxIncluded = this.projectElement.querySelector('.tax-included')?.checked || false;
                const calculationDisplay = this.projectElement.querySelector('.calculation-display');
                
                if (totalAmount && orderQuantity > 0 && calculationDisplay) {
                    const calculatedPrice = this.validator.calculateUnitPrice(totalAmount, orderQuantity, taxIncluded);
                    const totalAmountNum = parseFloat(totalAmount.replace(/[Â¥,\s]/g, '')) || 0;
                    
                    let calculationDetails = '';
                    if (taxIncluded) {
                        const taxAmount = totalAmountNum / 11;
                        const totalWithoutTax = totalAmountNum - taxAmount;
                        calculationDetails = `
                            <div class="text-xs text-gray-600 mt-1">
                                ğŸ“Š è©³ç´°è¨ˆç®—: ç¨è¾¼${totalAmountNum.toLocaleString()}å†† - ç¨é¡${Math.floor(taxAmount).toLocaleString()}å†† = ç¨æŠœ${Math.floor(totalWithoutTax).toLocaleString()}å††<br>
                                å˜ä¾¡è¨ˆç®—: ${Math.floor(totalWithoutTax).toLocaleString()}å†† Ã· ${orderQuantity}å€‹ = ${calculatedPrice.toFixed(2)}å††ï¼ˆå°æ•°ç¬¬3ä½åˆ‡ã‚Šæ¨ã¦ï¼‰
                            </div>
                        `;
                    } else {
                        calculationDetails = `
                            <div class="text-xs text-gray-600 mt-1">
                                ğŸ“Š è©³ç´°è¨ˆç®—: ${totalAmountNum.toLocaleString()}å†† Ã· ${orderQuantity}å€‹ = ${calculatedPrice.toFixed(2)}å††
                            </div>
                        `;
                    }
                    
                    calculationDisplay.innerHTML = `
                        <div class="flex items-center text-blue-700">
                            <span class="mr-2">${taxIncluded ? 'ğŸ’°' : 'ğŸ’¡'}</span>
                            <strong>è¨ˆç®—å˜ä¾¡: Â¥${calculatedPrice.toFixed(2)}</strong>
                            <span class="ml-2 px-2 py-1 rounded text-xs ${taxIncluded ? 'bg-green-100 text-green-700' : 'bg-blue-100 text-blue-700'}">
                                ${taxIncluded ? 'ç¨è¾¼è¨ˆç®—' : 'ç¨æŠœè¨ˆç®—'}
                            </span>
                        </div>
                        ${calculationDetails}
                    `;
                    calculationDisplay.style.display = 'block';
                } else if (calculationDisplay) {
                    calculationDisplay.style.display = 'none';
                }
            }
        }
        
        // ãƒ†ã‚­ã‚¹ãƒˆãƒ•ã‚©ãƒ¼ãƒãƒƒã‚¿ãƒ¼ã‚¯ãƒ©ã‚¹
        class TextFormatter {
            generateFormattedText(results) {
                const formattedTexts = results.map((result, index) => this.formatSingleResult(result, index));
                const totalAmountText = this.calculateTotalAmount(results);
                
                return results.length > 1 ? 
                    `${formattedTexts.join('\n\n')}\n\n${totalAmountText}` : 
                    formattedTexts.join('\n\n');
            }
            
            formatSingleResult(result, index) {
                const { projectData } = result;
                const itemName = projectData.basicInfo['ä»•æ§˜'] || 'ä¸æ˜';
                const modelNumber = projectData.basicInfo['å‹ç•ª'] || '';
                const stockQuantity = projectData.basicInfo['åœ¨åº«æ•°'] || '0';
                const annualUsage = projectData.basicInfo['å¹´é–“ä½¿ç”¨æ•°'] || '0';
                const supplier = projectData.basicInfo['è³¼è²·å…ˆ'] || 'æœªæŒ‡å®š';
                const previousPrice = projectData.basicInfo['å‰å›ã®æ³¨æ–‡å˜ä¾¡'] || 'Â¥0';
                const previousProcessingFee = projectData.basicInfo['å‰å›æ³¨æ–‡åŠ å·¥è²»'] || 'Â¥0';

                const orderReason = this.generateOrderReason(result, annualUsage);
                const priceReason = this.generatePriceReason(result, previousPrice);
                const modelReason = this.generateModelReason(result);
                const subjectReason = this.generateSubjectReason(result);
                const modelDisplay = this.getModelDisplay(result, modelNumber, itemName);

                // åŠ å·¥è²»æ¯”è¼ƒã®è¡¨ç¤ºã‚’ç”Ÿæˆ
                const processingFeeDisplay = this.generateProcessingFeeDisplay(result, projectData, previousProcessingFee);

                return `ã€${modelDisplay}ã€‘
æ¤œè¨¼${result.overallCheck ? 'OK' : 'NG'}
æ³¨æ–‡æ•°${result.orderCheck ? 'OK' : 'NG'}
ã€€å¹´é–“ä½¿ç”¨æ•°ï¼š${annualUsage}å€‹
ã€€åœ¨åº«æ•°ï¼š${stockQuantity}å€‹
ã€€æ³¨æ–‡æ•°ï¼š${result.orderQuantity}å€‹
ã€€â‡’${orderReason}
${processingFeeDisplay}å‹ç•ª/ä»•æ§˜${result.modelCheck ? 'OK' : 'NG'}
ã€€ZAICOå‹ç•ªã€€ï¼š${result.zaicoModel}
ã€€è¦‹ç©/è³¼è²·å…ˆï¼š${result.supplierModel}
ã€€â‡’${modelReason}
ç§‘ç›®${result.subjectCheck ? 'OK' : 'NG'}
ã€€ZAICOç§‘ç›®ï¼š${result.zaicoSubject}
ã€€ä»•è¨³ç§‘ç›®ã€€ï¼š${result.supplierSubject}
ã€€â‡’${subjectReason}`;
            }

            generateProcessingFeeDisplay(result, projectData, previousProcessingFee) {
                // åŠ å·¥è²»æ¯”è¼ƒãŒONã®å ´åˆã¯åŠ å·¥è²»æƒ…å ±ã‚’è¡¨ç¤ºã€OFFã®å ´åˆã¯å˜ä¾¡æƒ…å ±ã‚’è¡¨ç¤º
                if (result.hasProcessingFeeComparison && result.processingFeeDetails) {
                    const details = result.processingFeeDetails;
                    const applicationPrice = details.currentFee;

                    return `åŠ å·¥è²»æ¯”è¼ƒ${result.processingFeeCheck ? 'OK' : 'NG'}
ã€€å‰å›æ³¨æ–‡åŠ å·¥è²»ï¼šÂ¥${details.previousFee}
ã€€ç”³è«‹å˜ä¾¡ï¼šÂ¥${applicationPrice}
ã€€â‡’${this.generateProcessingFeeReason(result, details)}
`;
                } else {
                    // å¾“æ¥ã®å˜ä¾¡æ¯”è¼ƒè¡¨ç¤º
                    const previousPrice = projectData.basicInfo['å‰å›ã®æ³¨æ–‡å˜ä¾¡'] || 'Â¥0';
                    const priceReason = this.generatePriceReason(result, previousPrice);

                    return `å˜ä¾¡${result.priceCheck ? 'OK' : 'NG'}
ã€€å‰å›æ³¨æ–‡å˜ä¾¡ï¼š${previousPrice}
ã€€ä»Šå›å˜ä¾¡ï¼šÂ¥${result.calculatedPrice}
${priceReason}`;
                }
            }

            generateProcessingFeeReason(result, details) {
                if (details.isDecrease || details.isSame) {
                    return 'å‰å›æ³¨æ–‡åŠ å·¥è²»ä»¥ä¸‹ã®ãŸã‚OK';
                } else if (details.isIncrease && result.hasProcessingFeeIncrease && result.processingFeeIncreaseDetail) {
                    return result.processingFeeIncreaseDetail;
                } else if (details.isIncrease) {
                    return 'ç”³è«‹å˜ä¾¡ãŒå‰å›æ³¨æ–‡åŠ å·¥è²»ã‚ˆã‚Šé«˜é¡ã§ã™ã€‚ç†ç”±ã®è¨˜è¼‰ãŒå¿…è¦';
                }
                return 'æ¯”è¼ƒçµæœä¸æ˜';
            }

            generateOrderReason(result, annualUsage) {
                const annualUsageNum = parseInt(annualUsage);
                const isInNormalRange = result.orderQuantity >= annualUsageNum / 2 && result.orderQuantity <= annualUsageNum;

                if (result.hasSpecialReason && result.specialReasonDetail) {
                    return result.specialReasonDetail;
                } else if (result.hasOneYearOrder) {
                    return 'æ³¨æ–‡æ•°ã¯ç´„1å¹´åˆ†ã®ãŸã‚OK';
                } else if (isInNormalRange) {
                    return 'åŠå¹´ã‹ã‚‰1å¹´åˆ†ã®æ³¨æ–‡æ•°ã®ãŸã‚OK';
                } else {
                    return 'æ³¨æ–‡æ•°ãŒå¹´é–“ä½¿ç”¨æ•°ã®åŠåˆ†æœªæº€ã¾ãŸã¯å¹´é–“ä½¿ç”¨æ•°ã‚’è¶…ãˆã¦ã„ã¾ã™';
                }
            }
            
            generatePriceReason(result, previousPrice) {
                const calculatedPrice = parseFloat(result.calculatedPrice);
                const previousPriceNum = parseFloat(previousPrice.replace(/[Â¥,\s]/g, ''));
                
                if (calculatedPrice <= previousPriceNum) {
                    return 'ã€€â‡’å‰å›æ³¨æ–‡å˜ä¾¡ä»¥ä¸‹ã®ãŸã‚OK\n';
                } else if (calculatedPrice > previousPriceNum && result.isBestPrice) {
                    return 'ã€€â‡’ç›¸è¦‹ç©ã‚‚ã‚Šã§æœ€å®‰å€¤ã®ãŸã‚OK\n';
                } else if (calculatedPrice > previousPriceNum && result.hasSpecialAdoption && result.specialAdoptionDetail) {
                    return `ã€€â‡’${result.specialAdoptionDetail}\n`;
                }
                return '';
            }
            
            generateModelReason(result) {
                if (result.modelCheck) {
                    if (result.hasModelException) {
                        return result.modelExceptionDetail;
                    }
                    return result.hasSpecMatchConfirmed ? 'ä»•æ§˜ã®ä¸€è‡´ç¢ºèª' : 'å‹ç•ªã®ä¸€è‡´ç¢ºèª';
                }
                return 'å‹ç•ªãŒä¸€è‡´ã—ã¦ã„ã¾ã›ã‚“';
            }

            generateSubjectReason(result) {
                if (result.subjectCheck) {
                    if (result.hasSubjectException) {
                        return result.subjectExceptionDetail;
                    }
                    return 'ç§‘ç›®ã®ä¸€è‡´ç¢ºèª';
                }
                return 'ç§‘ç›®ãŒä¸€è‡´ã—ã¦ã„ã¾ã›ã‚“';
            }
            
            getModelDisplay(result, modelNumber, itemName) {
                const modelsMatch = result.zaicoModel && result.supplierModel && 
                                 result.zaicoModel.replace(/\s/g, '') === result.supplierModel.replace(/\s/g, '');
                
                // å‹ç•ªãŒä¸€è‡´ã—ã¦ã„ã‚‹å ´åˆã¯ãã‚Œã‚’è¡¨ç¤º
                if (modelsMatch) {
                    return result.zaicoModel;
                }
                
                // å‹ç•ª â†’ ç‰©å“åã®å„ªå…ˆé †ä½
                if (modelNumber && !modelNumber.includes('TYPE-')) {
                    return modelNumber;
                }
                
                if (itemName && !itemName.includes('ç‰©å“')) {
                    return itemName;
                }
                
                return `æ¡ˆä»¶${result.index + 1}`;
            }
            
            calculateTotalAmount(results) {
                const totalAmountWithTax = results.reduce((total, result) => {
                    const totalAmount = parseFloat(result.totalAmount.replace(/[Â¥,\s]/g, '')) || 0;
                    return total + totalAmount;
                }, 0);

                return `ç¨æŠœç·é¡ï¼šÂ¥${totalAmountWithTax.toLocaleString()}`;
            }
        }

        // Excelã‚¤ãƒ³ãƒãƒ¼ãƒˆã‚¯ãƒ©ã‚¹
        class ExcelImporter {
            constructor(textareaId, notificationManager) {
                this.textarea = document.getElementById(textareaId);
                this.wrapper = document.getElementById(textareaId + 'Wrapper');
                this.dropHint = document.getElementById('dropHint');
                this.notificationManager = notificationManager;
                this.quotationDataList = []; // ç›¸è¦‹ç©ã‚‚ã‚Šãƒ‡ãƒ¼ã‚¿ãƒªã‚¹ãƒˆ

                // ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ãƒãƒƒãƒ”ãƒ³ã‚°å®šç¾©ï¼ˆExcelåˆ—å â†’ ç”Ÿãƒ‡ãƒ¼ã‚¿ã‚­ãƒ¼åï¼‰
                this.fieldMapping = {
                    'ç‰©å“å': 'ä»•æ§˜',
                    'å‹ç•ª': 'å‹ç•ª',
                    'è³¼è²·å…ˆ': 'è³¼è²·å…ˆ',
                    'å¹´é–“ä½¿ç”¨æ•°': 'å¹´é–“ä½¿ç”¨æ•°',
                    'åœ¨åº«æ•°': 'åœ¨åº«æ•°',
                    'å‰å›ã®æ³¨æ–‡å˜ä¾¡': 'å‰å›ã®æ³¨æ–‡å˜ä¾¡',
                    'å‰å›ã®æ³¨æ–‡åŠ å·¥è²»': 'å‰å›æ³¨æ–‡åŠ å·¥è²»',
                    'ç§‘ç›®': 'ç§‘ç›®',
                    'éƒ¨æCODE': 'éƒ¨æCODE',
                    'å˜ä¾¡': 'å˜ä¾¡',
                    'åŠ å·¥è²»': 'åŠ å·¥è²»'
                };

                this.setupDragAndDrop();
            }

            setupDragAndDrop() {
                if (!this.textarea || !this.wrapper) {
                    console.warn('ExcelImporter: ãƒ†ã‚­ã‚¹ãƒˆã‚¨ãƒªã‚¢ã¾ãŸã¯ãƒ©ãƒƒãƒ‘ãƒ¼ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“');
                    return;
                }

                // ãƒ‰ãƒ©ãƒƒã‚°ã‚ªãƒ¼ãƒãƒ¼æ™‚
                this.wrapper.addEventListener('dragover', (e) => {
                    e.preventDefault();
                    e.stopPropagation();
                    this.wrapper.classList.add('drag-over');
                    if (this.dropHint) this.dropHint.style.display = 'block';
                });

                // ãƒ‰ãƒ©ãƒƒã‚°é›¢è„±æ™‚
                this.wrapper.addEventListener('dragleave', (e) => {
                    e.preventDefault();
                    e.stopPropagation();
                    this.wrapper.classList.remove('drag-over');
                    if (this.dropHint) this.dropHint.style.display = 'none';
                });

                // ãƒ‰ãƒ­ãƒƒãƒ—æ™‚
                this.wrapper.addEventListener('drop', (e) => {
                    e.preventDefault();
                    e.stopPropagation();
                    this.wrapper.classList.remove('drag-over');
                    if (this.dropHint) this.dropHint.style.display = 'none';

                    const files = e.dataTransfer.files;
                    if (files.length > 0) {
                        this.handleFile(files[0]);
                    }
                });

                console.log('ğŸ“ Excelãƒ‰ãƒ©ãƒƒã‚°ï¼†ãƒ‰ãƒ­ãƒƒãƒ—æ©Ÿèƒ½ãŒæœ‰åŠ¹åŒ–ã•ã‚Œã¾ã—ãŸ');
            }

            handleFile(file) {
                const validExtensions = ['.xlsx', '.xls'];
                const fileName = file.name.toLowerCase();
                const isValidFile = validExtensions.some(ext => fileName.endsWith(ext));

                if (!isValidFile) {
                    this.notificationManager.showError('Excelãƒ•ã‚¡ã‚¤ãƒ«(.xlsx/.xls)ã®ã¿å¯¾å¿œã—ã¦ã„ã¾ã™');
                    return;
                }

                const reader = new FileReader();
                reader.onload = (e) => {
                    try {
                        const data = new Uint8Array(e.target.result);
                        const workbook = XLSX.read(data, { type: 'array' });

                        // å…¨ã‚·ãƒ¼ãƒˆã‚’èª­ã¿è¾¼ã¿
                        const allSheetData = [];
                        const sheetCount = workbook.SheetNames.length;

                        for (const sheetName of workbook.SheetNames) {
                            const worksheet = workbook.Sheets[sheetName];
                            const jsonData = XLSX.utils.sheet_to_json(worksheet, { header: 1 });

                            // ç©ºã®ã‚·ãƒ¼ãƒˆã¯ã‚¹ã‚­ãƒƒãƒ—
                            if (!jsonData || jsonData.length < 2) {
                                console.log(`ğŸ“„ ã‚·ãƒ¼ãƒˆã€Œ${sheetName}ã€ã¯ã‚¹ã‚­ãƒƒãƒ—ï¼ˆãƒ‡ãƒ¼ã‚¿ãªã—ï¼‰`);
                                continue;
                            }

                            const rawDataText = this.convertToRawData(jsonData);
                            if (rawDataText) {
                                allSheetData.push({
                                    sheetName: sheetName,
                                    data: rawDataText
                                });
                                console.log(`ğŸ“„ ã‚·ãƒ¼ãƒˆã€Œ${sheetName}ã€ã‚’èª­ã¿è¾¼ã¿ã¾ã—ãŸ`);
                            }
                        }

                        if (allSheetData.length > 0) {
                            // å„ã‚·ãƒ¼ãƒˆã®ãƒ‡ãƒ¼ã‚¿ã‚’ç©ºè¡Œã§åŒºåˆ‡ã£ã¦çµåˆ
                            const combinedData = allSheetData.map(sheet => sheet.data).join('\n\n');
                            this.textarea.value = combinedData;

                            const message = allSheetData.length === 1
                                ? `Excelãƒ•ã‚¡ã‚¤ãƒ«ã€Œ${file.name}ã€ã‚’èª­ã¿è¾¼ã¿ã¾ã—ãŸï¼ˆ1ã‚·ãƒ¼ãƒˆï¼‰`
                                : `Excelãƒ•ã‚¡ã‚¤ãƒ«ã€Œ${file.name}ã€ã‚’èª­ã¿è¾¼ã¿ã¾ã—ãŸï¼ˆ${allSheetData.length}ã‚·ãƒ¼ãƒˆï¼‰`;
                            this.notificationManager.showSuccess(message);
                            console.log(`ğŸ“Š Excelèª­ã¿è¾¼ã¿å®Œäº†: ${file.name} (${allSheetData.length}/${sheetCount}ã‚·ãƒ¼ãƒˆ)`);

                            // å…¨ã‚·ãƒ¼ãƒˆã‹ã‚‰ç›¸è¦‹ç©ã‚‚ã‚Šãƒ‡ãƒ¼ã‚¿ã‚’æŠ½å‡ºãƒ»ä¿å­˜
                            this.quotationDataList = [];
                            for (const sheetName of workbook.SheetNames) {
                                const worksheet = workbook.Sheets[sheetName];
                                const jsonData = XLSX.utils.sheet_to_json(worksheet, { header: 1 });
                                const quotationData = this.extractQuotationData(jsonData);
                                if (quotationData && quotationData.quotations.length > 0) {
                                    quotationData.sheetName = sheetName;
                                    this.quotationDataList.push(quotationData);
                                    console.log(`ğŸ“Š ç›¸è¦‹ç©ã‚‚ã‚Šãƒ‡ãƒ¼ã‚¿æŠ½å‡º: ã‚·ãƒ¼ãƒˆã€Œ${sheetName}ã€`, quotationData);
                                }
                            }
                            console.log(`ğŸ“Š ç›¸è¦‹ç©ã‚‚ã‚Šãƒ‡ãƒ¼ã‚¿ç·æ•°: ${this.quotationDataList.length}ä»¶`);
                        } else {
                            this.notificationManager.showError('ãƒ‡ãƒ¼ã‚¿ã®å¤‰æ›ã«å¤±æ•—ã—ã¾ã—ãŸã€‚Excelã®å½¢å¼ã‚’ç¢ºèªã—ã¦ãã ã•ã„ã€‚');
                        }
                    } catch (error) {
                        console.error('Excelèª­ã¿è¾¼ã¿ã‚¨ãƒ©ãƒ¼:', error);
                        this.notificationManager.showError('Excelãƒ•ã‚¡ã‚¤ãƒ«ã®èª­ã¿è¾¼ã¿ã«å¤±æ•—ã—ã¾ã—ãŸ: ' + error.message);
                    }
                };

                reader.onerror = () => {
                    this.notificationManager.showError('ãƒ•ã‚¡ã‚¤ãƒ«ã®èª­ã¿è¾¼ã¿ã«å¤±æ•—ã—ã¾ã—ãŸ');
                };

                reader.readAsArrayBuffer(file);
            }

            convertToRawData(jsonData) {
                if (!jsonData || jsonData.length < 2) {
                    return null;
                }

                // Excelã®æ§‹é€ ã‚’è§£æï¼ˆæ·»ä»˜ç”»åƒã®å½¢å¼ã«åŸºã¥ãï¼‰
                // åˆ—Aã«ãƒ©ãƒ™ãƒ«ã€åˆ—Bã«å€¤ã¨ã„ã†å½¢å¼
                const dataMap = {};

                for (let i = 0; i < jsonData.length; i++) {
                    const row = jsonData[i];
                    if (row && row.length >= 2) {
                        const key = String(row[0] || '').trim();
                        const value = row[1];
                        if (key) {
                            dataMap[key] = value !== undefined && value !== null ? String(value) : '';
                        }
                    }
                }

                // ç”Ÿãƒ‡ãƒ¼ã‚¿å½¢å¼ã®ãƒ†ã‚­ã‚¹ãƒˆã‚’ç”Ÿæˆ
                const outputLines = [];

                // å¿…è¦ãªãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã‚’é †ç•ªã«å‡ºåŠ›
                const outputFields = [
                    { excelKey: 'ç‰©å“å', outputKey: 'ä»•æ§˜' },
                    { excelKey: 'å‹ç•ª', outputKey: 'å‹ç•ª' },
                    { excelKey: 'è³¼è²·å…ˆ', outputKey: 'è³¼è²·å…ˆ' },
                    { excelKey: 'å¹´é–“ä½¿ç”¨æ•°', outputKey: 'å¹´é–“ä½¿ç”¨æ•°' },
                    { excelKey: 'åœ¨åº«æ•°', outputKey: 'åœ¨åº«æ•°' },
                    { excelKey: 'å‰å›ã®æ³¨æ–‡å˜ä¾¡', outputKey: 'å‰å›ã®æ³¨æ–‡å˜ä¾¡' },
                    { excelKey: 'å‰å›ã®æ³¨æ–‡åŠ å·¥è²»', outputKey: 'å‰å›æ³¨æ–‡åŠ å·¥è²»' },
                    { excelKey: 'ç§‘ç›®', outputKey: 'ç§‘ç›®' }
                ];

                for (const field of outputFields) {
                    let value = dataMap[field.excelKey];
                    if (value !== undefined && value !== '') {
                        // ä¾¡æ ¼ã‹ã‚‰å††è¨˜å·ã‚’é™¤å»ã—ã€æ•°å€¤ã®ã¿ã«
                        if (field.excelKey.includes('å˜ä¾¡') || field.excelKey.includes('åŠ å·¥è²»')) {
                            value = value.replace(/[Â¥ï¿¥,]/g, '');
                        }
                        outputLines.push(`${field.outputKey}ï¼š${value}`);
                    }
                }

                // æœ€ä½é™ã®ãƒ‡ãƒ¼ã‚¿ãŒã‚ã‚‹ã‹ç¢ºèª
                if (outputLines.length < 2) {
                    // ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯ï¼šãƒ˜ãƒƒãƒ€ãƒ¼è¡Œ+ãƒ‡ãƒ¼ã‚¿è¡Œã®å½¢å¼ã‚’è©¦ã™
                    return this.convertTableFormat(jsonData);
                }

                return outputLines.join('\n');
            }

            // ãƒ†ãƒ¼ãƒ–ãƒ«å½¢å¼ï¼ˆãƒ˜ãƒƒãƒ€ãƒ¼è¡Œ+ãƒ‡ãƒ¼ã‚¿è¡Œï¼‰ã®å ´åˆã®å¤‰æ›
            convertTableFormat(jsonData) {
                if (!jsonData || jsonData.length < 2) {
                    return null;
                }

                const headers = jsonData[0];
                const results = [];

                // 2è¡Œç›®ä»¥é™ã®ãƒ‡ãƒ¼ã‚¿ã‚’å‡¦ç†
                for (let i = 1; i < jsonData.length; i++) {
                    const row = jsonData[i];
                    if (!row || row.every(cell => cell === null || cell === undefined || cell === '')) {
                        continue;
                    }

                    const outputLines = [];

                    for (let j = 0; j < headers.length; j++) {
                        const header = String(headers[j] || '').trim();
                        let value = row[j];

                        if (!header || value === undefined || value === null || value === '') {
                            continue;
                        }

                        value = String(value);

                        // ãƒ˜ãƒƒãƒ€ãƒ¼ã‚’ãƒãƒƒãƒ”ãƒ³ã‚°
                        const mappedKey = this.fieldMapping[header] || header;

                        // ä¾¡æ ¼ã‹ã‚‰å††è¨˜å·ã‚’é™¤å»
                        if (header.includes('å˜ä¾¡') || header.includes('åŠ å·¥è²»')) {
                            value = value.replace(/[Â¥ï¿¥,]/g, '');
                        }

                        outputLines.push(`${mappedKey}ï¼š${value}`);
                    }

                    if (outputLines.length > 0) {
                        results.push(outputLines.join('\n'));
                    }
                }

                return results.join('\n\n');
            }

            // ç›¸è¦‹ç©ã‚‚ã‚Šãƒ‡ãƒ¼ã‚¿ã‚’æŠ½å‡º
            extractQuotationData(jsonData) {
                if (!jsonData || jsonData.length < 2) {
                    return null;
                }

                const dataMap = {};
                for (let i = 0; i < jsonData.length; i++) {
                    const row = jsonData[i];
                    if (row && row.length >= 2) {
                        const key = String(row[0] || '').trim();
                        const value = row[1];
                        if (key) {
                            dataMap[key] = value !== undefined && value !== null ? String(value) : '';
                        }
                    }
                }

                // ç‰©å“åã‚’å–å¾—
                const itemName = dataMap['ç‰©å“å'] || dataMap['ä»•æ§˜'] || '';
                const modelNumber = dataMap['å‹ç•ª'] || '';
                const previousUnitPrice = dataMap['å‰å›ã®æ³¨æ–‡å˜ä¾¡'] || '';

                // è³¼è²·å…ˆãƒ‡ãƒ¼ã‚¿ã‚’æŠ½å‡ºï¼ˆè³¼è²·å…ˆ1ã€è³¼è²·å…ˆ2ã€è³¼è²·å…ˆ3ï¼‰
                const quotations = [];

                for (let i = 1; i <= 5; i++) {
                    const supplierKey = `è³¼è²·å…ˆ${i}`;
                    const supplierName = dataMap[supplierKey];

                    if (supplierName) {
                        const quotation = {
                            supplier: supplierName,
                            unitPrice: this.parsePrice(dataMap[`å˜ä¾¡_${i}`] || dataMap['å˜ä¾¡'] || ''),
                            quantity: parseInt(dataMap[`ç™ºæ³¨æ•°_${i}`] || dataMap['ç™ºæ³¨æ•°'] || '0', 10) || 0,
                            shippingFee: this.parsePrice(dataMap['é€æ–™'] || '0'),
                            total: this.parsePrice(dataMap[`åˆè¨ˆ_${i}`] || ''),
                            unitPriceWithShipping: this.parsePrice(dataMap['é€æ–™è¾¼å˜ä¾¡'] || ''),
                            remarks: dataMap['å‚™è€ƒ'] || '',
                            url: dataMap['URL'] || ''
                        };

                        // è¡Œãƒ‡ãƒ¼ã‚¿ã‹ã‚‰ç›´æ¥æŠ½å‡ºã‚’è©¦ã¿ã‚‹ï¼ˆãƒ†ãƒ¼ãƒ–ãƒ«å½¢å¼ã®å ´åˆï¼‰
                        quotations.push(quotation);
                    }
                }

                // ãƒ†ãƒ¼ãƒ–ãƒ«å½¢å¼ã§è³¼è²·å…ˆãƒ‡ãƒ¼ã‚¿ã‚’æ¢ã™
                if (quotations.length === 0) {
                    quotations.push(...this.extractQuotationFromTable(jsonData));
                }

                if (quotations.length === 0) {
                    return null;
                }

                return {
                    itemName: itemName,
                    modelNumber: modelNumber,
                    previousUnitPrice: previousUnitPrice,
                    quotations: quotations
                };
            }

            // ãƒ†ãƒ¼ãƒ–ãƒ«å½¢å¼ã‹ã‚‰ç›¸è¦‹ç©ã‚‚ã‚Šãƒ‡ãƒ¼ã‚¿ã‚’æŠ½å‡º
            extractQuotationFromTable(jsonData) {
                const quotations = [];

                // è³¼è²·å…ˆã®è¡Œã‚’æ¢ã™
                for (let i = 0; i < jsonData.length; i++) {
                    const row = jsonData[i];
                    if (!row || row.length < 2) continue;

                    const firstCell = String(row[0] || '').trim();

                    // è³¼è²·å…ˆ1ã€è³¼è²·å…ˆ2ã€è³¼è²·å…ˆ3 ã®ãƒ‘ã‚¿ãƒ¼ãƒ³ã‚’æ¢ã™ï¼ˆã€Œè³¼è²·å…ˆã€å˜ä½“ã¯é™¤å¤–ï¼‰
                    if (firstCell.match(/^è³¼è²·å…ˆ[0-9]+$/)) {
                        // ã“ã®è¡ŒãŒãƒ˜ãƒƒãƒ€ãƒ¼è¡Œã€æ¬¡ã®è¡ŒãŒãƒ‡ãƒ¼ã‚¿è¡Œ
                        const headerRow = row;
                        const dataRow = jsonData[i + 1];

                        if (dataRow && dataRow.length >= 2) {
                            const supplierName = String(dataRow[0] || '').trim();
                            // è³¼è²·å…ˆåãŒç©ºã‚„æ•°å­—ã®ã¿ã®å ´åˆã¯ã‚¹ã‚­ãƒƒãƒ—
                            if (supplierName && !supplierName.match(/^[0-9.]+$/)) {
                                const quotation = {
                                    supplier: supplierName,
                                    unitPrice: 0,
                                    quantity: 0,
                                    shippingFee: 0,
                                    total: 0,
                                    unitPriceWithShipping: 0,
                                    remarks: '',
                                    url: ''
                                };

                                for (let j = 1; j < headerRow.length && j < dataRow.length; j++) {
                                    const header = String(headerRow[j] || '').trim();
                                    const value = dataRow[j];

                                    if (header.includes('å˜ä¾¡') && !header.includes('é€æ–™è¾¼')) {
                                        quotation.unitPrice = this.parsePrice(value);
                                    } else if (header.includes('ç™ºæ³¨æ•°')) {
                                        quotation.quantity = parseInt(value, 10) || 0;
                                    } else if (header === 'é€æ–™' || header.match(/^é€æ–™$/)) {
                                        quotation.shippingFee = this.parsePrice(value);
                                    } else if (header.includes('åˆè¨ˆ') && !header.includes('é€æ–™è¾¼')) {
                                        quotation.total = this.parsePrice(value);
                                    } else if (header.includes('é€æ–™è¾¼å˜ä¾¡') || header.includes('é€æ–™è¾¼')) {
                                        quotation.unitPriceWithShipping = this.parsePrice(value);
                                    } else if (header.includes('å‚™è€ƒ')) {
                                        quotation.remarks = String(value || '');
                                    } else if (header.includes('URL')) {
                                        quotation.url = String(value || '');
                                    }
                                }

                                // åˆè¨ˆãŒ0ã®å ´åˆã€è¨ˆç®—
                                if (quotation.total === 0 && quotation.unitPrice > 0 && quotation.quantity > 0) {
                                    quotation.total = quotation.unitPrice * quotation.quantity + quotation.shippingFee;
                                }

                                // é€æ–™è¾¼å˜ä¾¡ãŒ0ã®å ´åˆã€è¨ˆç®—
                                if (quotation.unitPriceWithShipping === 0 && quotation.unitPrice > 0) {
                                    quotation.unitPriceWithShipping = quotation.quantity > 0
                                        ? quotation.total / quotation.quantity
                                        : quotation.unitPrice;
                                }

                                quotations.push(quotation);
                                console.log(`ğŸ“¦ è³¼è²·å…ˆãƒ‡ãƒ¼ã‚¿æŠ½å‡º: ${supplierName}`, quotation);
                            }
                        }
                    }
                }

                return quotations;
            }

            // ä¾¡æ ¼æ–‡å­—åˆ—ã‚’ãƒ‘ãƒ¼ã‚¹
            parsePrice(value) {
                if (value === undefined || value === null || value === '') return 0;
                const str = String(value).replace(/[Â¥ï¿¥,\s]/g, '');
                return parseFloat(str) || 0;
            }

            // ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã«å¯¾å¿œã™ã‚‹ç›¸è¦‹ç©ã‚‚ã‚Šãƒ‡ãƒ¼ã‚¿ã‚’æ¤œç´¢
            findQuotationForProject(projectIndex, basicInfo) {
                if (!this.quotationDataList || this.quotationDataList.length === 0) {
                    return null;
                }

                // ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ã§ç›´æ¥ãƒãƒƒãƒãƒ³ã‚°ï¼ˆã‚·ãƒ¼ãƒˆã®é †åº = ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®é †åºã¨ä»®å®šï¼‰
                if (projectIndex < this.quotationDataList.length) {
                    return this.quotationDataList[projectIndex];
                }

                // å‹ç•ªã¾ãŸã¯ç‰©å“åã§ãƒãƒƒãƒãƒ³ã‚°
                const modelNumber = basicInfo['å‹ç•ª'] || '';
                const itemName = basicInfo['ä»•æ§˜'] || '';

                for (const quotation of this.quotationDataList) {
                    if (modelNumber && quotation.modelNumber && quotation.modelNumber === modelNumber) {
                        return quotation;
                    }
                    if (itemName && quotation.itemName && quotation.itemName === itemName) {
                        return quotation;
                    }
                }

                return null;
            }

            // ç›¸è¦‹ç©ã‚‚ã‚Šçµæœã®HTMLã‚’ç”Ÿæˆ
            generateQuotationHTML(quotationData, projectIndex) {
                if (!quotationData || !quotationData.quotations || quotationData.quotations.length === 0) {
                    return '';
                }

                // æœ€å®‰å€¤ã‚’è¨ˆç®—
                let minPrice = Infinity;
                let minSupplier = '';

                quotationData.quotations.forEach(q => {
                    const effectivePrice = q.unitPriceWithShipping || q.unitPrice;
                    if (effectivePrice > 0 && effectivePrice < minPrice) {
                        minPrice = effectivePrice;
                        minSupplier = q.supplier;
                    }
                });

                // ãƒ†ãƒ¼ãƒ–ãƒ«è¡Œã‚’ç”Ÿæˆ
                const rows = quotationData.quotations.map(q => {
                    const effectivePrice = q.unitPriceWithShipping || q.unitPrice;
                    const isLowest = effectivePrice === minPrice && minPrice !== Infinity;
                    const rowClass = isLowest ? 'bg-green-50' : '';

                    return `
                        <tr class="${rowClass} border-b hover:bg-gray-50">
                            <td class="px-2 py-1 font-medium text-xs ${isLowest ? 'text-green-700' : ''}">${q.supplier}${isLowest ? ' â­' : ''}</td>
                            <td class="px-2 py-1 text-right text-xs">Â¥${q.unitPrice.toLocaleString()}</td>
                            <td class="px-2 py-1 text-right text-xs">${q.quantity}</td>
                            <td class="px-2 py-1 text-right text-xs">Â¥${q.shippingFee.toLocaleString()}</td>
                            <td class="px-2 py-1 text-right text-xs">Â¥${q.total.toLocaleString()}</td>
                            <td class="px-2 py-1 text-right text-xs font-medium ${isLowest ? 'text-green-700' : ''}">Â¥${(q.unitPriceWithShipping || q.unitPrice).toLocaleString()}</td>
                            <td class="px-2 py-1 text-gray-600 text-xs">${q.remarks || ''}</td>
                        </tr>
                    `;
                }).join('');

                // æ¨å¥¨ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸
                let recommendation = '';
                if (minSupplier && minPrice !== Infinity) {
                    recommendation = `ğŸ’¡ æ¨å¥¨: <span class="text-green-800 font-bold">${minSupplier}</span>ï¼ˆé€æ–™è¾¼å˜ä¾¡ Â¥${minPrice.toLocaleString()} ã§æœ€å®‰ï¼‰`;

                    // å‰å›æ³¨æ–‡å˜ä¾¡ã¨ã®æ¯”è¼ƒ
                    if (quotationData.previousUnitPrice) {
                        const prevPrice = this.parsePrice(quotationData.previousUnitPrice);
                        if (prevPrice > 0) {
                            const diff = minPrice - prevPrice;
                            const diffPercent = ((diff / prevPrice) * 100).toFixed(1);
                            if (diff < 0) {
                                recommendation += `<br>ğŸ“‰ å‰å›å˜ä¾¡(Â¥${prevPrice.toLocaleString()})ã‚ˆã‚Š <span class="text-green-600">Â¥${Math.abs(diff).toLocaleString()} (${Math.abs(diffPercent)}%) å®‰ã„</span>`;
                            } else if (diff > 0) {
                                recommendation += `<br>ğŸ“ˆ å‰å›å˜ä¾¡(Â¥${prevPrice.toLocaleString()})ã‚ˆã‚Š <span class="text-orange-600">Â¥${diff.toLocaleString()} (${diffPercent}%) é«˜ã„</span>`;
                            }
                        }
                    }
                }

                return `
                    <div class="quotation-section mt-4 border-t pt-4">
                        <button class="quotation-toggle-btn flex items-center text-sm text-blue-600 hover:text-blue-800 mb-2" data-project-index="${projectIndex}">
                            <span class="toggle-icon mr-1">â–¶</span>
                            <span>ğŸ“Š ç›¸è¦‹ç©ã‚‚ã‚Šçµæœã‚’è¡¨ç¤ºï¼ˆ${quotationData.quotations.length}ä»¶ï¼‰</span>
                        </button>
                        <div class="quotation-content hidden" data-project-index="${projectIndex}">
                            <div class="bg-blue-50 border border-blue-200 rounded-lg p-3">
                                <div class="overflow-x-auto">
                                    <table class="min-w-full bg-white border border-blue-200 rounded-md text-xs">
                                        <thead>
                                            <tr class="bg-blue-100">
                                                <th class="px-2 py-1 text-left font-medium text-blue-800 border-b">è³¼è²·å…ˆ</th>
                                                <th class="px-2 py-1 text-right font-medium text-blue-800 border-b">å˜ä¾¡</th>
                                                <th class="px-2 py-1 text-right font-medium text-blue-800 border-b">ç™ºæ³¨æ•°</th>
                                                <th class="px-2 py-1 text-right font-medium text-blue-800 border-b">é€æ–™</th>
                                                <th class="px-2 py-1 text-right font-medium text-blue-800 border-b">åˆè¨ˆ</th>
                                                <th class="px-2 py-1 text-right font-medium text-blue-800 border-b">é€æ–™è¾¼å˜ä¾¡</th>
                                                <th class="px-2 py-1 text-left font-medium text-blue-800 border-b">å‚™è€ƒ</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            ${rows}
                                        </tbody>
                                    </table>
                                </div>
                                <div class="mt-2 text-xs text-green-700 font-medium">${recommendation}</div>
                            </div>
                        </div>
                    </div>
                `;
            }
        }

        // ãƒãƒ¼ã‚¸ãƒ§ãƒ³ç®¡ç†ã‚¯ãƒ©ã‚¹
        class VersionManager {
            constructor(version) {
                this.version = version;
                this.releaseDate = new Date().toLocaleDateString('ja-JP');
                this.versionHistory = this.getVersionHistory();
            }
            
            getVersionHistory() {
                return [
                    {
                        version: '2.6.3',
                        date: '2025å¹´1æœˆ',
                        type: 'patch',
                        title: 'ğŸ“Š ç›¸è¦‹ç©ã‚‚ã‚Šçµæœè¡¨ç¤ºã®æ”¹å–„',
                        changes: [
                            'ç›¸è¦‹ç©ã‚‚ã‚Šçµæœã‚’ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã”ã¨ã«è¡¨ç¤ºï¼ˆæŠ˜ã‚ŠãŸãŸã¿å¼ï¼‰',
                            'è¤‡æ•°ã‚·ãƒ¼ãƒˆã‹ã‚‰ã®ç›¸è¦‹ç©ã‚‚ã‚Šãƒ‡ãƒ¼ã‚¿æŠ½å‡ºã«å¯¾å¿œ',
                            'ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã¯éè¡¨ç¤ºã€ã‚¯ãƒªãƒƒã‚¯ã§å±•é–‹è¡¨ç¤º',
                            'å…¥åŠ›ã‚¨ãƒªã‚¢ã‹ã‚‰çµæœè¡¨ç¤ºã‚¨ãƒªã‚¢ã¸UIã‚’ç§»å‹•'
                        ]
                    },
                    {
                        version: '2.6.2',
                        date: '2025å¹´1æœˆ',
                        type: 'patch',
                        title: 'ğŸ“Š ç›¸è¦‹ç©ã‚‚ã‚Šçµæœè¡¨ç¤ºæ©Ÿèƒ½',
                        changes: [
                            'Excelã‹ã‚‰ç›¸è¦‹ç©ã‚‚ã‚Šãƒ‡ãƒ¼ã‚¿ã‚’è‡ªå‹•æŠ½å‡º',
                            'è³¼è²·å…ˆã”ã¨ã®å˜ä¾¡ãƒ»é€æ–™ãƒ»åˆè¨ˆã‚’ä¸€è¦§è¡¨ç¤º',
                            'æœ€å®‰å€¤ã®è³¼è²·å…ˆã‚’è‡ªå‹•åˆ¤å®šãƒ»ãƒã‚¤ãƒ©ã‚¤ãƒˆè¡¨ç¤º',
                            'å‰å›æ³¨æ–‡å˜ä¾¡ã¨ã®æ¯”è¼ƒè¡¨ç¤º'
                        ]
                    },
                    {
                        version: '2.6.1',
                        date: '2025å¹´1æœˆ',
                        type: 'patch',
                        title: 'ğŸ“„ Excelè¤‡æ•°ã‚·ãƒ¼ãƒˆå¯¾å¿œ',
                        changes: [
                            'Excelãƒ•ã‚¡ã‚¤ãƒ«ã®è¤‡æ•°ã‚·ãƒ¼ãƒˆèª­ã¿è¾¼ã¿ã«å¯¾å¿œ',
                            'å…¨ã‚·ãƒ¼ãƒˆã®ãƒ‡ãƒ¼ã‚¿ã‚’è‡ªå‹•çš„ã«çµåˆã—ã¦ç”Ÿãƒ‡ãƒ¼ã‚¿ã‚¨ãƒªã‚¢ã«å…¥åŠ›',
                            'ç©ºã®ã‚·ãƒ¼ãƒˆã¯è‡ªå‹•ã‚¹ã‚­ãƒƒãƒ—',
                            'èª­ã¿è¾¼ã‚“ã ã‚·ãƒ¼ãƒˆæ•°ã‚’é€šçŸ¥ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã«è¡¨ç¤º'
                        ]
                    },
                    {
                        version: '2.6.0',
                        date: '2025å¹´1æœˆ',
                        type: 'minor',
                        title: 'ğŸ“ Excelã‚¤ãƒ³ãƒãƒ¼ãƒˆæ©Ÿèƒ½',
                        changes: [
                            'Excelãƒ•ã‚¡ã‚¤ãƒ«(.xlsx/.xls)ã®ãƒ‰ãƒ©ãƒƒã‚°ï¼†ãƒ‰ãƒ­ãƒƒãƒ—èª­ã¿è¾¼ã¿æ©Ÿèƒ½ã‚’è¿½åŠ ',
                            'ç”Ÿãƒ‡ãƒ¼ã‚¿ã‚¨ãƒªã‚¢ã«ç›´æ¥Excelãƒ•ã‚¡ã‚¤ãƒ«ã‚’ãƒ‰ãƒ­ãƒƒãƒ—å¯èƒ½',
                            'SheetJS(xlsx)ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã‚’ä½¿ç”¨ã—ãŸã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã‚µã‚¤ãƒ‰å‡¦ç†',
                            'ãƒ‡ãƒ¼ã‚¿ã¯å¤–éƒ¨é€ä¿¡ã•ã‚Œãšã€ãƒ–ãƒ©ã‚¦ã‚¶å†…ã§ã®ã¿å‡¦ç†ï¼ˆã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ç¢ºä¿ï¼‰'
                        ]
                    },
                    {
                        version: '2.5.4',
                        date: '2024å¹´12æœˆ',
                        type: 'patch',
                        title: 'ğŸ¯ ä»•è¨³ç§‘ç›®ãƒ‰ãƒ­ãƒƒãƒ—ãƒ€ã‚¦ãƒ³ãƒªã‚¹ãƒˆåŒ–',
                        changes: [
                            'ä»•è¨³ç§‘ç›®ã‚’ãƒ‰ãƒ­ãƒƒãƒ—ãƒ€ã‚¦ãƒ³ãƒªã‚¹ãƒˆå½¢å¼ã«å¤‰æ›´',
                            'é¸æŠè‚¢ã‚’è¿½åŠ : åŸææ–™ã€ä»•æ›å“ã€è²¯è”µå“ã€ç ”ç©¶é–‹ç™ºè²»ã€æŠ€è¡“ãƒ»è£½é€ ',
                            'ãƒ¦ãƒ¼ã‚¶ãƒ“ãƒªãƒ†ã‚£å‘ä¸Š: å…¥åŠ›ãƒŸã‚¹ã‚’é˜²æ­¢ã—ã€å…¥åŠ›åŠ¹ç‡ã‚’å‘ä¸Š'
                        ]
                    },
                    {
                        version: '2.5.3',
                        date: '2024å¹´12æœˆ',
                        type: 'patch',
                        title: 'âš™ï¸ ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå€¤è¨­å®šã¨åŠ å·¥è²»æ¯”è¼ƒè‡ªå‹•åŒ–',
                        changes: [
                            'ZAICOå‹ç•ªã®ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå€¤è¨­å®š: ç”Ÿãƒ‡ãƒ¼ã‚¿ã‹ã‚‰è‡ªå‹•å…¥åŠ›',
                            'ZAICOç§‘ç›®ã®ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå€¤è¨­å®š: ç”Ÿãƒ‡ãƒ¼ã‚¿ã‹ã‚‰è‡ªå‹•å…¥åŠ›',
                            'åŠ å·¥è²»æ¯”è¼ƒè‡ªå‹•ãƒã‚§ãƒƒã‚¯: ç§‘ç›®ãŒã€Œä»•æ›å“ã€ã®å ´åˆã«è‡ªå‹•çš„ã«ãƒã‚§ãƒƒã‚¯',
                            'ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ç›£è¦–: ZAICOç§‘ç›®ãŒã€Œä»•æ›å“ã€ã«å¤‰æ›´ã•ã‚ŒãŸå ´åˆã‚‚è‡ªå‹•ãƒã‚§ãƒƒã‚¯',
                            'handleSubjectChangeãƒ¡ã‚½ãƒƒãƒ‰ã‚’è¿½åŠ : ç§‘ç›®å¤‰æ›´æ™‚ã®å‡¦ç†ã‚’å®Ÿè£…',
                            'ãƒ¦ãƒ¼ã‚¶ãƒ“ãƒªãƒ†ã‚£å‘ä¸Š: èª¬æ˜ãƒ†ã‚­ã‚¹ãƒˆã‚’è¿½åŠ ã—ã¦è‡ªå‹•ãƒã‚§ãƒƒã‚¯ã®ç†ç”±ã‚’æ˜ç¤º'
                        ]
                    },
                    {
                        version: '2.5.2',
                        date: '2024å¹´12æœˆ',
                        type: 'minor',
                        title: 'ğŸ“‹ ç§‘ç›®ãƒã‚§ãƒƒã‚¯æ©Ÿèƒ½å®Ÿè£…',
                        changes: [
                            'ç§‘ç›®ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã®ã‚µãƒãƒ¼ãƒˆè¿½åŠ : ZAICOç§‘ç›®ã¨ä»•è¨³ç§‘ç›®ã®ä¸€è‡´ç¢ºèª',
                            'UIæ‹¡å¼µ: ç§‘ç›®å…¥åŠ›ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã¨ç‰¹åˆ¥äº‹æƒ…ãƒã‚§ãƒƒã‚¯ãƒœãƒƒã‚¯ã‚¹ã‚’è¿½åŠ ',
                            'ãƒ‡ãƒ¼ã‚¿ãƒ‘ãƒ¼ã‚¹å¼·åŒ–: ç”Ÿãƒ‡ãƒ¼ã‚¿ã¨ç”³è«‹ãƒ‡ãƒ¼ã‚¿ã®ç§‘ç›®è‡ªå‹•è§£æ',
                            'æ¤œè¨¼æ©Ÿèƒ½è¿½åŠ : validateSubjectã€generateSubjectReasonãƒ¡ã‚½ãƒƒãƒ‰ã‚’å®Ÿè£…',
                            'ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ æ¤œè¨¼: ç§‘ç›®ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã®è‡ªå‹•ç›£è¦–ã¨çŠ¶æ…‹æ›´æ–°',
                            'ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆå‡ºåŠ›: ç§‘ç›®æƒ…å ±ã‚’å«ã‚€å‡ºåŠ›ãƒ†ã‚­ã‚¹ãƒˆç”Ÿæˆ'
                        ]
                    },
                    {
                        version: '2.5.1',
                        date: '2024å¹´12æœˆ',
                        type: 'patch',
                        title: 'ğŸ”¢ å‹ç•ªãƒã‚§ãƒƒã‚¯å‡ºåŠ›æ”¹å–„',
                        changes: [
                            'å‹ç•ªãƒã‚§ãƒƒã‚¯ã®ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆæ¸ˆã¿ãƒ†ã‚­ã‚¹ãƒˆã‚’ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã€Œå‹ç•ªã®ä¸€è‡´ç¢ºèªã€ã«å¤‰æ›´',
                            'ã€Œä»•æ§˜ä¸€è‡´ç¢ºèªæ¸ˆã¿ã€ãƒã‚§ãƒƒã‚¯æ™‚ã®ã¿ã€Œä»•æ§˜ã®ä¸€è‡´ç¢ºèªã€ã‚’è¡¨ç¤º',
                            'generateModelReasonãƒ¡ã‚½ãƒƒãƒ‰ã®ãƒ­ã‚¸ãƒƒã‚¯ã‚’æ”¹å–„'
                        ]
                    },
                    {
                        version: '2.5.0',
                        date: '2024å¹´12æœˆ',
                        type: 'minor',
                        title: 'ğŸ“Š å˜ä¾¡è¡¨ç¤ºãƒ»æ³¨æ–‡æ•°æ¤œè¨¼æ©Ÿèƒ½æ‹¡å¼µ',
                        changes: [
                            'ğŸ“‹ ç”³è«‹å˜ä¾¡ã¨è¨ˆç®—å˜ä¾¡ã®ä¸ä¸€è‡´æ™‚ã«æ³¨æ–‡å˜ä¾¡ã‚’è¡¨ç¤ºï¼ˆä¾‹ï¼šä»Šå›å˜ä¾¡ï¼šÂ¥21.60ã€€â†ï¼ˆæ³¨æ–‡å˜ä¾¡ï¼šÂ¥22.32ï¼‰ï¼‰',
                            'âœ… æ³¨æ–‡æ•°æ¤œè¨¼ã«ã€Œæ³¨æ–‡æ•°ç´„1å¹´åˆ†ã€ãƒã‚§ãƒƒã‚¯ãƒœãƒƒã‚¯ã‚¹ã‚’è¿½åŠ ',
                            'ğŸ’¬ ãƒã‚§ãƒƒã‚¯ãƒœãƒƒã‚¯ã‚¹ONæ™‚ã®å‡ºåŠ›ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ï¼šã€Œæ³¨æ–‡æ•°ã¯ç´„1å¹´åˆ†ã®ãŸã‚OKã€',
                            'ğŸ”§ extractFormDataã€performValidationChecksã€generateOrderReasonãƒ¡ã‚½ãƒƒãƒ‰ã‚’æ›´æ–°'
                        ]
                    },
                    {
                        version: '2.4.4',
                        date: '2024å¹´12æœˆ',
                        type: 'patch',
                        title: 'ğŸ”„ ãƒãƒ¼ã‚¸ãƒ§ãƒ³æ›´æ–°',
                        changes: [
                            'ğŸ“Œ ãƒãƒ¼ã‚¸ãƒ§ãƒ³ç•ªå·ã‚’ v2.4.4 ã«æ›´æ–°'
                        ]
                    },
                    {
                        version: '2.4.3',
                        date: '2024å¹´12æœˆ',
                        type: 'patch',
                        title: 'ğŸ“‹ å‡ºåŠ›è¡¨ç¤ºæ©Ÿèƒ½æ”¹å–„',
                        changes: [
                            'ğŸ¯ æ¡ä»¶åˆ†å²è¡¨ç¤º: åŠ å·¥è²»æ¯”è¼ƒONæ™‚ã¯åŠ å·¥è²»æƒ…å ±ã€OFFæ™‚ã¯å˜ä¾¡æƒ…å ±ã‚’è¡¨ç¤º',
                            'ğŸ“Š å°‚ç”¨è¡¨ç¤ºå½¢å¼: åŠ å·¥è²»æ¯”è¼ƒå°‚ç”¨ã®å‡ºåŠ›ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆå®Ÿè£…',
                            'ğŸ”§ æ–°ãƒ¡ã‚½ãƒƒãƒ‰è¿½åŠ : generateProcessingFeeDisplay()ã¨generateProcessingFeeReason()ã‚’å®Ÿè£…',
                            'ğŸ’¡ æƒ…å ±ã®æœ€é©åŒ–: é‡è¤‡ã™ã‚‹å˜ä¾¡æƒ…å ±ã‚’æ’é™¤ã—ã€é©åˆ‡ãªæ¯”è¼ƒçµæœã‚’è¡¨ç¤º',
                            'âš¡ å‡ºåŠ›ç²¾åº¦å‘ä¸Š: å‰å›æ³¨æ–‡åŠ å·¥è²»ã¨ç”³è«‹å˜ä¾¡ã®æ­£ç¢ºãªæ¯”è¼ƒçµæœã‚’å‡ºåŠ›'
                        ]
                    },
                    {
                        version: '2.4.2',
                        date: '2024å¹´12æœˆ',
                        type: 'patch',
                        title: 'ğŸ”„ ãƒ‡ãƒ¼ã‚¿ãƒãƒƒãƒ”ãƒ³ã‚°æ©Ÿèƒ½å¼·åŒ–',
                        changes: [
                            'ğŸ¯ ã‚­ãƒ¼ãƒãƒƒãƒ”ãƒ³ã‚°å®Ÿè£…: ç”Ÿãƒ‡ãƒ¼ã‚¿ã®ã€Œå‰å›ã®æ³¨æ–‡åŠ å·¥è²»ã€ã‚’åŸºæœ¬æƒ…å ±ã®ã€Œå‰å›æ³¨æ–‡åŠ å·¥è²»ã€ã«è‡ªå‹•å¤‰æ›',
                            'ğŸ“Š å¤šæ§˜ãªã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰å¯¾å¿œ: ã€ŒåŠ å·¥è²»ã€ã€ŒåŠ å·¥æ–™ã€ã€Œå·¥è³ƒã€ãªã©é–¢é€£ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ã®è‡ªå‹•èªè­˜',
                            'ğŸ” ãƒ‡ãƒ¼ã‚¿ãƒ‘ãƒ¼ã‚·ãƒ³ã‚°æ”¹å–„: åŠ å·¥è²»é–¢é€£ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã®èªè­˜ç²¾åº¦å‘ä¸Š',
                            'ğŸ› ï¸ ãƒ‡ãƒãƒƒã‚°æ©Ÿèƒ½è¿½åŠ : ã‚­ãƒ¼ãƒãƒƒãƒ”ãƒ³ã‚°éç¨‹ã®ã‚³ãƒ³ã‚½ãƒ¼ãƒ«ãƒ­ã‚°å‡ºåŠ›',
                            'âš¡ ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯å‡¦ç†æœ€é©åŒ–: æ­£ã—ã„ãƒãƒƒãƒ”ãƒ³ã‚°å¾Œãƒ‡ãƒ¼ã‚¿ã§ã®åŸºæœ¬æƒ…å ±æ§‹ç¯‰'
                        ]
                    },
                    {
                        version: '2.4.1',
                        date: '2024å¹´12æœˆ',
                        type: 'minor',
                        title: 'ğŸ”§ åŠ å·¥è²»æ¯”è¼ƒãƒ­ã‚¸ãƒƒã‚¯æœ€é©åŒ–',
                        changes: [
                            'ğŸ¯ æ¯”è¼ƒæ–¹å¼å¤‰æ›´: å‰å›æ³¨æ–‡åŠ å·¥è²» vs ç”³è«‹å˜ä¾¡ã®ç›´æ¥æ¯”è¼ƒã«ä»•æ§˜å¤‰æ›´',
                            'âš¡ æ“ä½œç°¡ç•¥åŒ–: ä»Šå›åŠ å·¥è²»ã®æ‰‹å‹•å…¥åŠ›ã‚’å‰Šé™¤ã—ã€ç”³è«‹å˜ä¾¡ã‚’è‡ªå‹•ä½¿ç”¨',
                            'ğŸ“Š UIæ”¹å–„: å‰å›æ³¨æ–‡åŠ å·¥è²»ã¨ç”³è«‹å˜ä¾¡ã®ä¸¦åˆ—è¡¨ç¤ºã§æ¯”è¼ƒçµæœã‚’æ˜ç¢ºåŒ–',
                            'ğŸ’¡ è‡ªå‹•é€£æº: ç”³è«‹å˜ä¾¡ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã¨ã®å®Œå…¨è‡ªå‹•é€£æºã‚·ã‚¹ãƒ†ãƒ ',
                            'ğŸ“ èª¬æ˜æ–‡æœ€é©åŒ–: æ–°ã—ã„æ¯”è¼ƒæ–¹å¼ã«å¯¾å¿œã—ãŸèª¬æ˜æ–‡ã¨ãƒ—ãƒ¬ãƒ¼ã‚¹ãƒ›ãƒ«ãƒ€ãƒ¼æ›´æ–°'
                        ]
                    },
                    {
                        version: '2.4.0',
                        date: '2024å¹´12æœˆ',
                        type: 'major',
                        title: 'ğŸš€ SPAS - åŠ å·¥è²»åˆ†ææ©Ÿèƒ½å¼·åŒ–ç‰ˆ',
                        changes: [
                            'ğŸ¯ ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³åç§°å¤‰æ›´: ã‚¹ãƒãƒ¼ãƒˆèª¿é”åˆ†æã‚·ã‚¹ãƒ†ãƒ ï¼ˆSPASï¼‰ã«ãƒªãƒ–ãƒ©ãƒ³ãƒ‡ã‚£ãƒ³ã‚°',
                            'ğŸ“Š é«˜åº¦åŠ å·¥è²»æ¯”è¼ƒæ©Ÿèƒ½: è©³ç´°ãªå·®é¡ãƒ»å¢—æ¸›ç‡åˆ†æã¨ãƒ“ã‚¸ãƒ¥ã‚¢ãƒ«è¡¨ç¤º',
                            'ğŸ” ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ è²»ç”¨åˆ†æ: å‰å›è²»ç”¨ã¨ã®å³åº§æ¯”è¼ƒã¨å‚¾å‘åˆ†æ',
                            'ğŸ’¡ ã‚¤ãƒ³ãƒ†ãƒªã‚¸ã‚§ãƒ³ãƒˆè­¦å‘Šã‚·ã‚¹ãƒ†ãƒ : è²»ç”¨ä¸Šæ˜‡æ™‚ã®è‡ªå‹•ã‚¢ãƒ©ãƒ¼ãƒˆã¨ç†ç”±è¨˜è¼‰ã‚¬ã‚¤ãƒ€ãƒ³ã‚¹',
                            'ğŸ¨ UI/UXå¤§å¹…æ”¹å–„: ç›´æ„Ÿçš„ãªæ“ä½œæ€§ã¨è¦–èªæ€§ã®å‘ä¸Š',
                            'âš¡ ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹æœ€é©åŒ–: æ¯”è¼ƒå‡¦ç†ã®é«˜é€ŸåŒ–ã¨ãƒ¡ãƒ¢ãƒªåŠ¹ç‡æ”¹å–„'
                        ]
                    },
                    {
                        version: '2.3.4',
                        date: '2024å¹´12æœˆ',
                        type: 'minor',
                        title: 'ğŸ”§ åŠ å·¥è²»æ¯”è¼ƒæ©Ÿèƒ½å®Ÿè£…',
                        changes: [
                            'åŠ å·¥è²»æ¯”è¼ƒãƒã‚§ãƒƒã‚¯ãƒœãƒƒã‚¯ã‚¹: ãƒã‚§ãƒƒã‚¯ã‚’ä»˜ã‘ã‚‹ã“ã¨ã§åŠ å·¥è²»ã®æ¯”è¼ƒãŒã§ãã‚‹æ©Ÿèƒ½',
                            'å‰å›åŠ å·¥è²»ã¨ã®æ¯”è¼ƒ: åŸºæœ¬æƒ…å ±ã®å‰å›æ³¨æ–‡åŠ å·¥è²»ã¨ä»Šå›ã®åŠ å·¥è²»ã‚’è‡ªå‹•æ¯”è¼ƒ',
                            'åŠ å·¥è²»ä¸Šæ˜‡æ™‚ã®ç†ç”±è¨˜è¼‰: åŠ å·¥è²»ãŒä¸Šæ˜‡ã—ãŸå ´åˆã®ç‰¹åˆ¥äº‹æƒ…å…¥åŠ›æ©Ÿèƒ½',
                            'ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ æ¤œè¨¼å¯¾å¿œ: åŠ å·¥è²»ãƒã‚§ãƒƒã‚¯çµæœã®ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ è¡¨ç¤º'
                        ]
                    },
                    {
                        version: '2.3.3',
                        date: '2024å¹´12æœˆ',
                        type: 'minor',
                        title: 'ğŸ“ å›³ç•ªãƒã‚§ãƒƒã‚¯æ©Ÿèƒ½å®Ÿè£…',
                        changes: [
                            'å›³ç•ªãƒã‚§ãƒƒã‚¯æ©Ÿèƒ½: å‹ç•ªãƒã‚§ãƒƒã‚¯ã«åŠ ãˆã¦å›³ç•ªã®æ¤œè¨¼æ©Ÿèƒ½ã‚’è¿½åŠ ',
                            'å›³ç•ªãªã—ã‚ªãƒ—ã‚·ãƒ§ãƒ³: å›³ç•ªãŒå­˜åœ¨ã—ãªã„å ´åˆã®ãƒã‚§ãƒƒã‚¯ãƒœãƒƒã‚¯ã‚¹å¯¾å¿œ',
                            'å›³ç•ªä¸ä¸€è‡´å¯¾å¿œ: å›³ç•ªãŒä¸€è‡´ã—ãªã„å ´åˆã®ç‰¹åˆ¥äº‹æƒ…è¨˜è¼‰æ©Ÿèƒ½',
                            'ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆå‡ºåŠ›æ”¹å–„: ç‰©å“åãƒ»è³¼è²·å…ˆãƒ»å‰å›åŠ å·¥è²»ã®è¡¨ç¤ºã‚’å‰Šé™¤'
                        ]
                    },
                    {
                        version: '2.3.2',
                        date: '2024å¹´12æœˆ',
                        type: 'patch',
                        title: 'âŒ¨ï¸ ã‚·ãƒ§ãƒ¼ãƒˆã‚«ãƒƒãƒˆå®Œå…¨å‰Šé™¤',
                        changes: [
                            'Ctrl+Alt+V ã‚·ãƒ§ãƒ¼ãƒˆã‚«ãƒƒãƒˆå‰Šé™¤: æ›´æ–°å±¥æ­´è¡¨ç¤ºæ©Ÿèƒ½ã‚’å‰Šé™¤',
                            'ãƒ–ãƒ©ã‚¦ã‚¶æ¨™æº–ã‚·ãƒ§ãƒ¼ãƒˆã‚«ãƒƒãƒˆã¨ã®ç«¶åˆè§£æ¶ˆ: ã™ã¹ã¦ã®ã‚«ã‚¹ã‚¿ãƒ ã‚·ãƒ§ãƒ¼ãƒˆã‚«ãƒƒãƒˆã‚’å‰Šé™¤',
                            'ã‚­ãƒ¼ãƒœãƒ¼ãƒ‰æ“ä½œã®å˜ç´”åŒ–: ESCã‚­ãƒ¼ï¼ˆãƒ¢ãƒ¼ãƒ€ãƒ«é–‰ã˜ã‚‹ï¼‰ã®ã¿ä¿æŒ',
                            'ãƒ¦ãƒ¼ã‚¶ãƒ“ãƒªãƒ†ã‚£å‘ä¸Š: ãƒ–ãƒ©ã‚¦ã‚¶æœ¬æ¥ã®æ“ä½œä½“é¨“ã‚’å„ªå…ˆ'
                        ]
                    },
                    {
                        version: '2.3.1',
                        date: '2024å¹´12æœˆ',
                        type: 'patch',
                        title: 'âŒ¨ï¸ ã‚·ãƒ§ãƒ¼ãƒˆã‚«ãƒƒãƒˆæ©Ÿèƒ½èª¿æ•´',
                        changes: [
                            'Ctrl+Shift+V ã‚·ãƒ§ãƒ¼ãƒˆã‚«ãƒƒãƒˆå‰Šé™¤: ãƒ–ãƒ©ã‚¦ã‚¶æœ¬æ¥ã®ã€Œå€¤ã§è²¼ã‚Šä»˜ã‘ã€æ©Ÿèƒ½ã‚’å¾©æ´»',
                            'ãƒãƒ¼ã‚¸ãƒ§ãƒ³æƒ…å ±è¡¨ç¤º: ç”»é¢å³ä¸Šã®ãƒœã‚¿ãƒ³ã‹ã‚‰ã®ã¿ã‚¢ã‚¯ã‚»ã‚¹å¯èƒ½ã«å¤‰æ›´',
                            'ã‚­ãƒ¼ãƒœãƒ¼ãƒ‰ã‚·ãƒ§ãƒ¼ãƒˆã‚«ãƒƒãƒˆ: ESCã‚­ãƒ¼ã«ã‚ˆã‚‹ãƒ¢ãƒ¼ãƒ€ãƒ«é–‰ã˜ã‚‹æ©Ÿèƒ½ã¯ç¶­æŒ',
                            'ãƒ¦ãƒ¼ã‚¶ãƒ“ãƒªãƒ†ã‚£å‘ä¸Š: æ¨™æº–çš„ãªãƒ–ãƒ©ã‚¦ã‚¶æ“ä½œã¨ã®æ•´åˆæ€§å‘ä¸Š'
                        ]
                    },
                    {
                        version: '2.3.0',
                        date: '2024å¹´12æœˆ',
                        type: 'minor',
                        title: 'âœï¸ åŸºæœ¬æƒ…å ±ç·¨é›†æ©Ÿèƒ½å®Ÿè£…',
                        changes: [
                            'åŸºæœ¬æƒ…å ±ã®ç›´æ¥ç·¨é›†æ©Ÿèƒ½: ç”Ÿãƒ‡ãƒ¼ã‚¿ä¸å‚™ã¸ã®æŸ”è»Ÿå¯¾å¿œ',
                            'ã‚¤ãƒ³ãƒ©ã‚¤ãƒ³ç·¨é›†UI: è¡¨ç¤ºãƒ¢ãƒ¼ãƒ‰ã¨ç·¨é›†ãƒ¢ãƒ¼ãƒ‰ã®åˆ‡ã‚Šæ›¿ãˆ',
                            'ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ æ¤œè¨¼é€£æº: ç·¨é›†å†…å®¹ã®å³åº§åæ˜ ',
                            'ãƒ‡ãƒ¼ã‚¿å“è³ªå‘ä¸Š: æ‰‹å‹•è£œæ­£ã«ã‚ˆã‚‹ç²¾åº¦å‘ä¸Š',
                            'ç·¨é›†çŠ¶æ…‹ã®è¦–è¦šçš„ãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯: è‡ªå‹•ç”Ÿæˆãƒ»ç·¨é›†æ¸ˆã¿ã®åŒºåˆ¥è¡¨ç¤º',
                            'å…¥åŠ›å€¤æ¤œè¨¼: å¿…é ˆé …ç›®ãƒ»ãƒ‡ãƒ¼ã‚¿å‹ãƒ»ç¯„å›²ãƒã‚§ãƒƒã‚¯',
                            'å…ƒãƒ‡ãƒ¼ã‚¿å¾©å…ƒæ©Ÿèƒ½: ç·¨é›†ã®ãƒªã‚»ãƒƒãƒˆãƒ»ã‚­ãƒ£ãƒ³ã‚»ãƒ«å¯¾å¿œ'
                        ]
                    },
                    {
                        version: '2.2.0',
                        date: '2024å¹´12æœˆ',
                        type: 'minor',
                        title: 'âš¡ ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ æ¤œè¨¼æ©Ÿèƒ½å®Ÿè£…',
                        changes: [
                            'ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ æ¤œè¨¼ã‚¨ãƒ³ã‚¸ãƒ³: å…¥åŠ›å€¤å¤‰æ›´æ™‚ã®å³åº§æ¤œè¨¼',
                            'ãƒ‡ãƒã‚¦ãƒ³ã‚¹æ©Ÿèƒ½: 500msé…å»¶ã§è² è·è»½æ¸›',
                            'ãƒ“ã‚¸ãƒ¥ã‚¢ãƒ«ãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯: å…¥åŠ›ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã®çŠ¶æ…‹è¡¨ç¤º',
                            'ã‚¤ãƒ³ãƒ†ãƒªã‚¸ã‚§ãƒ³ãƒˆãƒ’ãƒ³ãƒˆ: ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ æ”¹å–„ææ¡ˆ',
                            'æ¤œè¨¼ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã‚·ã‚¹ãƒ†ãƒ : ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹æœ€é©åŒ–',
                            'ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ æ©Ÿèƒ½åˆ¶å¾¡: æœ‰åŠ¹/ç„¡åŠ¹åˆ‡ã‚Šæ›¿ãˆ',
                            'ä¸€æ‹¬æ¤œè¨¼ã®å¼·åŒ–: ãƒ—ãƒ­ã‚°ãƒ¬ã‚¹è¡¨ç¤ºã¨éåŒæœŸå‡¦ç†'
                        ]
                    },
                    {
                        version: '2.1.1',
                        date: '2024å¹´12æœˆ',
                        type: 'patch',
                        title: 'ğŸ“‹ åŸºæœ¬æƒ…å ±è¡¨ç¤ºã®ä»•æ§˜å¤‰æ›´',
                        changes: [
                            'é¡Œç›®è¡¨ç¤ºãƒ«ãƒ¼ãƒ«å¤‰æ›´: å‹ç•ª â†’ ç‰©å“åã®å„ªå…ˆé †ä½',
                            'åŸºæœ¬æƒ…å ±ã®é †ç•ªå¤‰æ›´: ç‰©å“åã€å‹ç•ªã€åœ¨åº«æ•°ã€å¹´é–“ä½¿ç”¨æ•°ã€è³¼è²·å…ˆã€å‰å›æ³¨æ–‡å˜ä¾¡ã€å‰å›æ³¨æ–‡åŠ å·¥è²»',
                            'æ–°é …ç›®è¿½åŠ : åœ¨åº«æ•°ã€å‰å›æ³¨æ–‡åŠ å·¥è²»ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰',
                            'ãƒ‡ãƒ¼ã‚¿å“è³ªè©•ä¾¡åŸºæº–ã®èª¿æ•´: ã‚ˆã‚Šå³å¯†ãªè©•ä¾¡ãƒ­ã‚¸ãƒƒã‚¯',
                            'ç”³è«‹ãƒ‡ãƒ¼ã‚¿ãƒãƒƒãƒãƒ³ã‚°å„ªå…ˆé †ä½ã®æœ€é©åŒ–',
                            'ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆæ¸ˆã¿ãƒ†ã‚­ã‚¹ãƒˆã®å‡ºåŠ›é …ç›®æ‹¡å……'
                        ]
                    },
                    {
                        version: '2.1.0',
                        date: '2024å¹´12æœˆ',
                        type: 'minor',
                        title: 'ğŸ¯ ãƒ‡ãƒ¼ã‚¿è¡¨ç¤ºãƒ»è§£ææ©Ÿèƒ½å¼·åŒ–',
                        changes: [
                            'ãƒ‡ãƒ¼ã‚¿è§£æã‚¨ãƒ³ã‚¸ãƒ³ã®å®Œå…¨åˆ·æ–°: æŸ”è»ŸãªåŒºåˆ‡ã‚Šæ–‡å­—å¯¾å¿œ',
                            'ã€Œä¸æ˜ã€è¡¨ç¤ºã®æ’²æ»…: ã‚¤ãƒ³ãƒ†ãƒªã‚¸ã‚§ãƒ³ãƒˆãªãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯æ©Ÿèƒ½',
                            'ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã‚¿ã‚¤ãƒˆãƒ«ã®è‡ªå‹•ç”Ÿæˆ: è¤‡æ•°å€™è£œã‹ã‚‰ã®æœ€é©é¸æŠ',
                            'ãƒ‡ãƒ¼ã‚¿å“è³ªã‚¤ãƒ³ã‚¸ã‚±ãƒ¼ã‚¿ãƒ¼: ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ å®Œæˆåº¦è¡¨ç¤º',
                            'ç”³è«‹ãƒ‡ãƒ¼ã‚¿ãƒãƒƒãƒãƒ³ã‚°å¼·åŒ–: æ­£è¦åŒ–ãƒ»éƒ¨åˆ†ãƒãƒƒãƒãƒ³ã‚°å¯¾å¿œ',
                            'è©³ç´°ãƒ­ã‚°æ©Ÿèƒ½: ãƒ‡ãƒãƒƒã‚°ãƒ»ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°æ”¯æ´'
                        ]
                    },
                    {
                        version: '2.0.0',
                        date: '2024å¹´12æœˆ',
                        type: 'major',
                        title: 'ğŸš€ Major Update - å®Œå…¨ãƒªãƒ•ã‚¡ã‚¯ã‚¿ãƒªãƒ³ã‚°',
                        changes: [
                            'ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£æ”¹å–„: ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«åŒ–ã¨ã‚¯ãƒ©ã‚¹åŒ–ã«ã‚ˆã‚‹ä¿å®ˆæ€§å‘ä¸Š',
                            'ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°å¼·åŒ–: å …ç‰¢ãªä¾‹å¤–å‡¦ç†ã¨ãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒ•ãƒ¬ãƒ³ãƒ‰ãƒªãƒ¼ãªé€šçŸ¥',
                            'UI/UXå‘ä¸Š: ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ã€ãƒ—ãƒ­ã‚°ãƒ¬ã‚¹è¡¨ç¤ºã€ãƒ¬ã‚¹ãƒãƒ³ã‚·ãƒ–ãƒ‡ã‚¶ã‚¤ãƒ³',
                            'ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹æœ€é©åŒ–: DOMæ“ä½œåŠ¹ç‡åŒ–ã€ãƒ¡ãƒ¢ãƒªãƒªãƒ¼ã‚¯é˜²æ­¢',
                            'æ‹¡å¼µæ€§å¼·åŒ–: ãƒ—ãƒ©ã‚°ã‚¤ãƒ³å¯èƒ½ãªè¨­è¨ˆã€æ–°æ©Ÿèƒ½è¿½åŠ ã®å®¹æ˜“ã•',
                            'ç¨è¾¼/ç¨æŠœè¨ˆç®—æ©Ÿèƒ½: é«˜ç²¾åº¦ãªå˜ä¾¡è¨ˆç®—ãƒ­ã‚¸ãƒƒã‚¯'
                        ]
                    },
                    {
                        version: '1.2.1',
                        date: '2024å¹´11æœˆ',
                        type: 'patch',
                        title: 'ğŸ”§ Bug Fixes & Improvements',
                        changes: [
                            'å‹ç•ªæ¤œè¨¼ãƒ­ã‚¸ãƒƒã‚¯ã®ä¿®æ­£',
                            'ä¾¡æ ¼è¨ˆç®—ã®ç²¾åº¦å‘ä¸Š',
                            'UIãƒ¬ã‚¹ãƒãƒ³ã‚·ãƒ–å¯¾å¿œã®æ”¹å–„'
                        ]
                    },
                    {
                        version: '1.2.0',
                        date: '2024å¹´10æœˆ',
                        type: 'minor',
                        title: 'âœ¨ Feature Updates',
                        changes: [
                            'ä¸€æ‹¬æ¤œè¨¼æ©Ÿèƒ½ã®è¿½åŠ ',
                            'ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆæ¸ˆã¿ãƒ†ã‚­ã‚¹ãƒˆå‡ºåŠ›æ©Ÿèƒ½',
                            'ã‚¯ãƒªãƒƒãƒ—ãƒœãƒ¼ãƒ‰ã‚³ãƒ”ãƒ¼æ©Ÿèƒ½'
                        ]
                    },
                    {
                        version: '1.1.0',
                        date: '2024å¹´9æœˆ',
                        type: 'minor',
                        title: 'ğŸ¯ Core Features',
                        changes: [
                            'è¤‡æ•°æ¡ˆä»¶å¯¾å¿œã®å®Ÿè£…',
                            'ç”³è«‹ãƒ‡ãƒ¼ã‚¿è‡ªå‹•ãƒãƒƒãƒãƒ³ã‚°',
                            'ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ è¨ˆç®—æ©Ÿèƒ½'
                        ]
                    },
                    {
                        version: '1.0.0',
                        date: '2024å¹´8æœˆ',
                        type: 'major',
                        title: 'ğŸ‰ Initial Release',
                        changes: [
                            'åŸºæœ¬çš„ãªãƒ‡ãƒ¼ã‚¿æ•´å½¢æ©Ÿèƒ½',
                            'å˜ä¸€æ¡ˆä»¶å¯¾å¿œ',
                            'åŸºæœ¬çš„ãªæ¤œè¨¼æ©Ÿèƒ½'
                        ]
                    }
                ];
            }
            
            displayVersion() {
                const versionElement = document.getElementById('appVersion');
                if (versionElement) {
                    versionElement.textContent = `v${this.version}`;
                }
            }
            
            showVersionModal() {
                const modal = document.getElementById('versionModal');
                if (modal) {
                    modal.style.display = 'flex';
                    document.body.style.overflow = 'hidden';
                }
            }
            
            hideVersionModal() {
                const modal = document.getElementById('versionModal');
                if (modal) {
                    modal.style.display = 'none';
                    document.body.style.overflow = 'auto';
                }
            }
            
            logVersionInfo() {
                console.group(`ğŸš€ SPAS (ã‚¹ãƒãƒ¼ãƒˆèª¿é”åˆ†æã‚·ã‚¹ãƒ†ãƒ ) v${this.version}`);
                console.log(`ğŸ“… ãƒªãƒªãƒ¼ã‚¹æ—¥: ${this.releaseDate}`);
                console.log(`ğŸ”§ æŠ€è¡“ã‚¹ã‚¿ãƒƒã‚¯: Vanilla JavaScript + Tailwind CSS`);
                console.log(`ğŸ“¦ ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£: Class-based Modular Design`);
                console.log(`ğŸŒ ãƒ–ãƒ©ã‚¦ã‚¶å¯¾å¿œ: Modern Browsers (ES6+)`);
                console.log(`ğŸ’¡ æ–°æ©Ÿèƒ½: é«˜åº¦åŠ å·¥è²»åˆ†æ & ã‚¤ãƒ³ãƒ†ãƒªã‚¸ã‚§ãƒ³ãƒˆè­¦å‘Šã‚·ã‚¹ãƒ†ãƒ `);
                console.groupEnd();
                
                // ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹æƒ…å ±ã‚‚è¡¨ç¤º
                if (window.performance && window.performance.now) {
                    const loadTime = window.performance.now();
                    console.log(`âš¡ åˆæœŸåŒ–æ™‚é–“: ${loadTime.toFixed(2)}ms`);
                }
            }
            
            getCurrentVersion() {
                return {
                    version: this.version,
                    releaseDate: this.releaseDate,
                    buildNumber: this.generateBuildNumber()
                };
            }
            
            generateBuildNumber() {
                const now = new Date();
                const year = now.getFullYear().toString().slice(-2);
                const month = (now.getMonth() + 1).toString().padStart(2, '0');
                const day = now.getDate().toString().padStart(2, '0');
                const hour = now.getHours().toString().padStart(2, '0');
                const minute = now.getMinutes().toString().padStart(2, '0');
                
                return `${year}${month}${day}.${hour}${minute}`;
            }
            
            checkForUpdates() {
                // å°†æ¥çš„ãªæ©Ÿèƒ½: æ–°ã—ã„ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã®ç¢ºèª
                console.log('ğŸ”„ ã‚¢ãƒƒãƒ—ãƒ‡ãƒ¼ãƒˆã®ç¢ºèªæ©Ÿèƒ½ã¯å°†æ¥å®Ÿè£…äºˆå®šã§ã™');
            }
        }
        
        // é€šçŸ¥ç®¡ç†ã‚¯ãƒ©ã‚¹
        class NotificationManager {
            showError(message) {
                this.showNotification(message, 'error');
            }
            
            showSuccess(message) {
                this.showNotification(message, 'success');
            }
            
            showNotification(message, type) {
                const elementId = type === 'error' ? 'errorMessage' : 'successMessage';
                const textId = type === 'error' ? 'errorText' : 'successText';
                
                const notificationElement = document.getElementById(elementId);
                const textElement = document.getElementById(textId);
                
                if (notificationElement && textElement) {
                    textElement.textContent = message;
                    notificationElement.style.display = 'block';
                    
                    // 3ç§’å¾Œã«è‡ªå‹•ã§éè¡¨ç¤º
                    setTimeout(() => {
                        notificationElement.style.display = 'none';
                    }, 3000);
                }
            }
        }
        
        // ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³åˆæœŸåŒ–
        document.addEventListener('DOMContentLoaded', () => {
            const app = new DataFormatterApp();

            // ã‚°ãƒ­ãƒ¼ãƒãƒ«ã«ã‚¢ãƒ—ãƒªã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã‚’è¨­å®šï¼ˆãƒ‡ãƒãƒƒã‚°ç”¨ï¼‰
            window.DataFormatterApp = app;

            // Excelã‚¤ãƒ³ãƒãƒ¼ãƒˆæ©Ÿèƒ½ã‚’åˆæœŸåŒ–
            const excelImporter = new ExcelImporter('inputData', app.notificationManager);
            window.ExcelImporter = excelImporter;
            
            // ã‚­ãƒ¼ãƒœãƒ¼ãƒ‰ã‚·ãƒ§ãƒ¼ãƒˆã‚«ãƒƒãƒˆ
            document.addEventListener('keydown', (e) => {
                // ESCã‚­ãƒ¼ã§ãƒ¢ãƒ¼ãƒ€ãƒ«ã‚’é–‰ã˜ã‚‹
                if (e.key === 'Escape') {
                    app.versionManager.hideVersionModal();
                }
                
                // ä»–ã®ã‚·ãƒ§ãƒ¼ãƒˆã‚«ãƒƒãƒˆã¯ã™ã¹ã¦å‰Šé™¤æ¸ˆã¿
                // Ctrl+Shift+V = ãƒ–ãƒ©ã‚¦ã‚¶æ¨™æº–ã®ã€Œå€¤ã§è²¼ã‚Šä»˜ã‘ã€
                // Ctrl+Alt+V = å‰Šé™¤æ¸ˆã¿ï¼ˆãƒ–ãƒ©ã‚¦ã‚¶æ¨™æº–æ©Ÿèƒ½ã‚’å„ªå…ˆï¼‰
            });
            
            // ãƒšãƒ¼ã‚¸èª­ã¿è¾¼ã¿å®Œäº†ã‚’ã‚³ãƒ³ã‚½ãƒ¼ãƒ«ã«è¡¨ç¤º
            console.group(`ğŸ‰ SPAS v${app.version} - Smart Procurement Analysis System`);
            console.log('ğŸš€ ã‚·ã‚¹ãƒ†ãƒ åˆæœŸåŒ–å®Œäº†ï¼šæ¬¡ä¸–ä»£èª¿é”åˆ†æãƒ—ãƒ©ãƒƒãƒˆãƒ•ã‚©ãƒ¼ãƒ ');
            console.log('âš¡ ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ æ¤œè¨¼ã‚¨ãƒ³ã‚¸ãƒ³ãŒç¨¼åƒä¸­');
            console.log('âœï¸ åŸºæœ¬æƒ…å ±ç·¨é›†æ©Ÿèƒ½ãŒåˆ©ç”¨å¯èƒ½');
            console.log('ğŸ“Š ãƒ‡ãƒ¼ã‚¿å“è³ªç®¡ç†ã‚·ã‚¹ãƒ†ãƒ ãŒç¨¼åƒä¸­');
            console.log('ğŸ’° ç¨è¾¼/ç¨æŠœè‡ªå‹•è¨ˆç®—æ©Ÿèƒ½ãŒå¯¾å¿œæ¸ˆã¿');
            console.log('ğŸ”¢ å‹ç•ªãƒã‚§ãƒƒã‚¯æ©Ÿèƒ½ãŒç¨¼åƒä¸­');
            console.log('ğŸ“ å›³ç•ªãƒã‚§ãƒƒã‚¯æ©Ÿèƒ½ãŒç¨¼åƒä¸­');
            console.log('ğŸ”§ æœ€é©åŒ–æ¸ˆã¿åŠ å·¥è²»åˆ†ææ©Ÿèƒ½ãŒå®Ÿè£…æ¸ˆã¿');
            console.log('ğŸ’¡ ã‚¤ãƒ³ãƒ†ãƒªã‚¸ã‚§ãƒ³ãƒˆè­¦å‘Šã‚·ã‚¹ãƒ†ãƒ ãŒç¨¼åƒä¸­');
            console.log('âš¡ ç”³è«‹å˜ä¾¡é€£æºã«ã‚ˆã‚‹ç°¡ç•¥åŒ–æ“ä½œã‚·ã‚¹ãƒ†ãƒ ');
            console.log('ğŸ”„ è‡ªå‹•ã‚­ãƒ¼ãƒãƒƒãƒ”ãƒ³ã‚°æ©Ÿèƒ½ãŒç¨¼åƒä¸­');
            console.log('ğŸ“‹ æ¡ä»¶åˆ†å²å‹å‡ºåŠ›è¡¨ç¤ºã‚·ã‚¹ãƒ†ãƒ ');
            console.log('âŒ¨ï¸ ãƒ–ãƒ©ã‚¦ã‚¶æ¨™æº–æ“ä½œã‚’å„ªå…ˆï¼šã‚«ã‚¹ã‚¿ãƒ ã‚·ãƒ§ãƒ¼ãƒˆã‚«ãƒƒãƒˆå‰Šé™¤');
            console.log('ğŸ“ Excelã‚¤ãƒ³ãƒãƒ¼ãƒˆæ©Ÿèƒ½: ç”Ÿãƒ‡ãƒ¼ã‚¿ã‚¨ãƒªã‚¢ã«ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ãƒ‰ãƒ©ãƒƒã‚°ï¼†ãƒ‰ãƒ­ãƒƒãƒ—');
            console.log('ğŸ“± ãƒãƒ¼ã‚¸ãƒ§ãƒ³æƒ…å ±: ç”»é¢å³ä¸Šã®ãƒœã‚¿ãƒ³ã‹ã‚‰è¡¨ç¤ºå¯èƒ½');
            console.log('ğŸ”§ é–‹ç™ºè€…å‘ã‘: window.DataFormatterApp ã§ã‚¢ãƒ—ãƒªã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã«ã‚¢ã‚¯ã‚»ã‚¹å¯èƒ½');
            console.log('ğŸ“‹ å®Œå…¨ä»•æ§˜æ›¸ãƒ»æŠ€è¡“è³‡æ–™ã‚’å‚ç…§');
            console.groupEnd();
        });
    </script>
</body>
</html>
